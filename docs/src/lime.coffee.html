<!DOCTYPE html><html><head><title>lime.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../src/annotationoverlays.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotationoverlays.coffee</span></a><a href="../src/ldplugin.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">ldplugin.coffee</span></a><a href="../src/lime.coffee.html" class="source selected"><span class="base_path">src / </span><span class="file_name">lime.coffee</span></a><a href="../src/player-extension.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">player-extension.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>lime.coffee</h1><div class="filepath">src/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><h1>Linked Media Player</h1>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><ul>
<li>handles the VideoJS player instance</li>
<li>fetches the annotations from the <code>options.annotFrameworkURL</code> SPARQL endpoint</li>
<li>Instantiate Plugins</li>
</ul>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><h2>Usage</h2>

<pre><code>LimePlayer = new LIMEPlayer({
  video:[ "http://connectme.salzburgresearch.at/data/tourism_video.webm",
    "http://connectme.salzburgresearch.at/data/tourism_video.ogv",
    "https://s3-eu-west-1.amazonaws.com/yoo.120/connectme/6306_519_20120508125738_standard.mp4"],
  containerDiv:"mainwrapper",
  annotFrameworkURL:"http://labs.newmedialab.at/SKOS/",
  plugins:[TestPlugin, LDPlugin, AnnotationOverlays],
  widgetContainers:[
    {element:jQuery('#widget-container-1'), orientation:'vertical'},
    {element:jQuery('#widget-container-2'), orientation:'horizontal'}
  ],
});
</code></pre>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">LIMEPlayer</span>
  <span class="nv">constructor: </span><span class="nf">(opts) -&gt;</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Define the default options</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">options =</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>The container DOM element to use</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">containerDiv: </span><span class="s">&quot;mainwrapper&quot;</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Dimensions for the player</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">videoPlayerSize: </span><span class="p">{</span><span class="s">&quot;width&quot;</span><span class="o">:</span> <span class="mi">640</span><span class="p">,</span> <span class="s">&quot;height&quot;</span><span class="o">:</span> <span class="mi">360</span><span class="p">}</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>LMF URL</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">annotFrameworkURL: </span><span class="s">&quot;http://labs.newmedialab.at/SKOS/&quot;</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>list of allowed widgets TODO Add possibility for defining configuration</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">plugins: </span><span class="p">{</span>
        <span class="nv">TestPlugin: </span><span class="p">{}</span>
      <span class="p">},</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>autodetecting</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">platform: </span><span class="s">&quot;web&quot;</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>toggle true/false</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">fullscreen: </span><span class="kc">false</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>how big should be the annotation areas surrounding the video</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">fullscreenLayout: </span><span class="s">&quot;AnnotationNorth&quot;</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s">&quot;AnnotationWest&quot;</span><span class="o">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s">&quot;AnnotationSouth&quot;</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s">&quot;AnnotationEast&quot;</span><span class="o">:</span> <span class="mi">300</span>
      <span class="nv">widgetContainers: </span><span class="p">[{</span><span class="nv">element: </span><span class="nx">jQuery</span><span class="p">(</span><span class="s">&#39;#widget-container-1&#39;</span><span class="p">),</span> <span class="nv">orientation: </span><span class="s">&#39;vertical&#39;</span><span class="p">}]</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>space used by annotations TODO: Why is this an option? Shouldn't it be a state (simply an instance variable) [Szaby]</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">usedSpaceNWSE: </span><span class="s">&quot;north&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;west&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;south&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;east&quot;</span><span class="o">:</span> <span class="mi">0</span>
      <span class="nv">annotationsVisible : </span><span class="kc">true</span>
      <span class="nv">debug: </span><span class="kc">false</span>
      <span class="nv">preferredLanguage: </span><span class="s">&quot;en&quot;</span>
      <span class="nv">builtinPlugins:</span>
        <span class="nv">AnnotationOverlays: </span><span class="p">{}</span>
        <span class="nv">LDPlugin: </span><span class="p">{}</span>
    <span class="vi">@options = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">opts</span>

    <span class="vi">@widgetContainers = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">widgetContainers</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Run initialisation functions, depending on each other:
* Initialize the DOM for the player and set up VideoJS</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">@_initVideoPlayer</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><ul>
<li>Load basic annotation list</li>
</ul>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">@_loadAnnotations</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><ul>
<li>Initialize plugins</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">@_initPlugins</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><ul>
<li>Startup timeupdate event handler</li>
</ul>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">@_startScheduler</span><span class="p">()</span>

  <span class="nv">getLength: </span><span class="o">-&gt;</span>
    <span class="nx">@player</span><span class="p">.</span><span class="nx">duration</span><span class="p">()</span>

  <span class="nv">seek: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">if</span> <span class="nx">pos</span> <span class="o">isnt</span> <span class="kc">undefined</span>
      <span class="nx">@player</span><span class="p">.</span><span class="nx">currentTime</span> <span class="nx">pos</span>

  <span class="nv">currentTime: </span><span class="o">-&gt;</span>
    <span class="nx">@player</span><span class="p">.</span><span class="nx">currentTime</span><span class="p">()</span>
  <span class="nv">play: </span><span class="o">-&gt;</span>
    <span class="nx">@player</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>

  <span class="nv">_startScheduler: </span><span class="o">-&gt;</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><h2>handle becomeActive and becomeInactive events</h2>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">jQuery</span><span class="p">(</span><span class="nx">@</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&#39;timeupdate&#39;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
      <span class="k">for</span> <span class="nx">annotation</span> <span class="k">in</span> <span class="nx">@annotations</span>
        <span class="nv">currentTime = </span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTime</span>
        <span class="k">if</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">state</span> <span class="o">is</span> <span class="s">&#39;inactive&#39;</span> <span class="o">and</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">start</span> <span class="o">&lt;</span> <span class="nx">currentTime</span> <span class="o">and</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">end</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="nx">currentTime</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>has to be activated</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nv">annotation.state = </span><span class="s">&#39;active&#39;</span>
          <span class="nx">jQuery</span><span class="p">(</span><span class="nx">annotation</span><span class="p">).</span><span class="nx">trigger</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span> <span class="s">&quot;becomeActive&quot;</span><span class="p">,</span> <span class="nv">annotation: </span><span class="nx">annotation</span> <span class="c1">#signal to a particular annotation to become active</span>
        <span class="k">if</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">state</span> <span class="o">is</span> <span class="s">&#39;active&#39;</span> <span class="o">and</span> <span class="p">(</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">start</span> <span class="o">&gt;</span> <span class="nx">currentTime</span> <span class="o">or</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">end</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nx">currentTime</span><span class="p">)</span>
          <span class="nv">annotation.state = </span><span class="s">&#39;inactive&#39;</span>
          <span class="nx">jQuery</span><span class="p">(</span><span class="nx">annotation</span><span class="p">).</span><span class="nx">trigger</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span> <span class="s">&quot;becomeInactive&quot;</span><span class="p">,</span> <span class="nv">annotation: </span><span class="nx">annotation</span> <span class="c1">#signal to a particular annotation to become inactive</span>

  <span class="nv">_initVideoPlayer: </span><span class="nf">(cb) -&gt;</span>
    <span class="nx">displaysrc</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">video</span>
      <span class="nv">displaysrc = </span><span class="nx">displaysrc</span> <span class="o">+</span> <span class="s">&quot;&lt;source src=</span><span class="si">#{</span><span class="nx">source</span><span class="si">}</span><span class="s"> type=&#39;video/</span><span class="si">#{</span><span class="nx">source</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/.([a-z|A-Z|0-9]*)$/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">&#39; /&gt;&quot;</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>create center div with player, <video> id is 'videoplayer' - this gets passed to the VideoJS initializer</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">containerDiv</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">append</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">      &lt;div class=&#39;videowrapper&#39; id=&#39;videowrapper&#39;&gt;</span>
<span class="s">        &lt;video id=&#39;video_player&#39; class=&#39;video-js vjs-default-skin&#39; controls preload=&#39;none&#39; width=&#39;640&#39; height=&#39;360&#39; poster=&#39;img/connectme-video-poster.jpg&#39;&gt;</span>
<span class="s">          </span><span class="si">#{</span><span class="nx">displaysrc</span><span class="si">}</span><span class="s"></span>
<span class="s">        &lt;/video&gt;</span>
<span class="s">      &lt;/div&gt;</span>
<span class="s">      &lt;div class=&quot;annotation-wrapper&quot; id=&quot;annotation-wrapper&quot; style=&quot;display: none;&quot;&gt;</span>
<span class="s">      &lt;div class=&quot;north fullscreen-annotation&quot; style=&quot;height: </span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">fullscreenLayout</span><span class="p">.</span><span class="nx">AnnotationNorth</span><span class="si">}</span><span class="s">px&quot;&gt;&lt;/div&gt;</span>
<span class="s">        &lt;div class=&quot;west fullscreen-annotation&quot; style=&quot;height: </span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">fullscreenLayout</span><span class="p">.</span><span class="nx">AnnotationSouth</span><span class="si">}</span><span class="s">px&quot;&gt;&lt;/div&gt;</span>
<span class="s">        &lt;div class=&quot;east fullscreen-annotation&quot; style=&quot;height: </span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">fullscreenLayout</span><span class="p">.</span><span class="nx">AnnotationEast</span><span class="si">}</span><span class="s">px&quot;&gt;&lt;/div&gt;</span>
<span class="s">        &lt;div class=&quot;south fullscreen-annotation&quot; style=&quot;height: </span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">fullscreenLayout</span><span class="p">.</span><span class="nx">AnnotationNorth</span><span class="si">}</span><span class="s">px&quot;&gt;&lt;/div&gt;</span>
<span class="s">      &lt;/div&gt;</span>
<span class="s">    &quot;&quot;&quot;</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>width="' + options.VideoPlayerSize.width+'" height="' + options.VideoPlayerSize.height + '"</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span> <span class="o">=&gt;</span>
      <span class="vi">@player = </span><span class="nx">_V_</span> <span class="s">&#39;video_player&#39;</span><span class="p">,</span>
        <span class="nv">flash: iFrameMode: </span><span class="kc">true</span>
        <span class="nv">swf: </span><span class="s">&quot;lib/videojs/video-js.swf&quot;</span> <span class="c1"># SORIN - added to fix flash fallback bug</span>
      <span class="nx">@player</span><span class="p">.</span><span class="nx">addEvent</span> <span class="s">&quot;loadedmetadata&quot;</span><span class="p">,</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>@player.addComponent 'Annotations', player: @player</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">@_initEventListeners</span><span class="p">()</span>
        <span class="nx">cb</span><span class="p">()</span>
      <span class="nx">@player</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>SORIN - adding Sidebars component to VideoJS, as well as the annotation toggler</p>
</td><td class="code"><div class="highlight"><pre>        <span class="vi">@player.isFullScreen = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">fullscreen</span>
        <span class="vi">@_nonfullscreen_containers = </span><span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">widgetContainers</span>
        <span class="nx">@player</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="s">&quot;AnnotationsSidebars&quot;</span><span class="p">)</span>  <span class="c1"># add component to display 4 regions of annotations</span>
        <span class="nx">@player</span><span class="p">.</span><span class="nx">controlBar</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="s">&quot;AnnotationToggle&quot;</span><span class="p">)</span> <span class="c1"># add button to toggle annotations on/off in the control bar</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">@player</span><span class="p">.</span><span class="nx">isFullScreen</span><span class="p">)</span>
          <span class="nx">@player</span><span class="p">.</span><span class="nx">AnnotationsSidebars</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">_this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationsSidebars</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>END added SORIN</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">@player</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Setting up VideoJS Player&quot;</span><span class="p">,</span> <span class="nx">@player</span>

  <span class="nv">_initEventListeners: </span><span class="o">-&gt;</span>
    <span class="nx">@player</span><span class="p">.</span><span class="nx">addEvent</span> <span class="s">&#39;timeupdate&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">playerEvent</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>console.info playerEvent</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">e = </span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span> <span class="s">&quot;timeupdate&quot;</span><span class="p">,</span> <span class="nv">currentTime: </span><span class="nx">@player</span><span class="p">.</span><span class="nx">currentTime</span><span class="p">()</span>
      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">@</span><span class="p">).</span><span class="nx">trigger</span> <span class="nx">e</span>
    <span class="nx">@player</span><span class="p">.</span><span class="nx">addEvent</span> <span class="s">&#39;fullscreenchange&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">fsce = </span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span> <span class="s">&#39;fullscreenchange&#39;</span><span class="p">,</span> <span class="nv">isFullScreen: </span><span class="nx">@player</span><span class="p">.</span><span class="nx">isFullScreen</span>
      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">@player</span><span class="p">).</span><span class="nx">trigger</span> <span class="nx">fsce</span>
      <span class="nx">@_moveWidgets</span> <span class="nx">@player</span><span class="p">.</span><span class="nx">isFullScreen</span>


  <span class="nv">_loadAnnotations: </span><span class="nf">(cb) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Loading annotations from LMF&quot;</span>
    <span class="vi">@annotations = </span><span class="p">[]</span>
    <span class="nv">query = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      PREFIX oac: &lt;http://www.openannotation.org/ns/&gt;</span>
<span class="s">      PREFIX ma: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">      SELECT ?annotation ?fragment ?resource ?relation</span>
<span class="s">      WHERE { &lt;</span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">video</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">&gt;  ma:hasFragment ?f.</span>
<span class="s">         ?f ma:locator ?fragment.</span>
<span class="s">         ?annotation oac:target ?f.</span>
<span class="s">         ?annotation oac:body ?resource.</span>
<span class="s">         ?f ?relation ?resource.</span>
<span class="s">      }</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="nv">uri = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">annotFrameworkURL</span><span class="si">}</span><span class="s">sparql/select?query=</span><span class="si">#{</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span><span class="si">}</span><span class="s">&amp;output=json&quot;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span> <span class="nx">uri</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>$.getJSON "annotations.json", (data) =></p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">list = </span><span class="nx">data</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">bindings</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>list = _.filter list, (el) ->
el.annotation.value in ["http://connectme.at/annotation/f06b99c2fd576042facae4225cb9fed2", "http://connectme.at/annotation/577e5d16435dfc2a0d24223926477f82"]</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">annotation</span> <span class="k">of</span> <span class="nx">list</span>
        <span class="nx">@annotations</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">Annotation</span> <span class="nx">annotation</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Annotations loaded from&quot;</span><span class="p">,</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">@annotations</span>
      <span class="nx">cb</span><span class="p">()</span>
  <span class="nv">_moveWidgets: </span><span class="nf">(isFullscreen) -&gt;</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>added SORIN - toggle the annotations between fullscreen and normal screen</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot;fullscreen&quot;</span><span class="p">,</span> <span class="nx">isFullscreen</span><span class="p">,</span> <span class="s">&quot;, Visible &quot;</span><span class="o">+</span><span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">annotationsVisible</span><span class="p">);</span>
    <span class="k">if</span> <span class="nx">isFullscreen</span> <span class="o">and</span> <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">annotationsVisible</span>   <span class="c1"># entering fullscreen, switching to 4 fixed annotation areas</span>
      <span class="nv">LimePlayer.widgetContainers = </span><span class="p">[</span>
        <span class="p">{</span><span class="nx">element</span><span class="o">:</span><span class="nx">jQuery</span><span class="p">(</span><span class="s">&#39;.west&#39;</span><span class="p">),</span> <span class="nx">orientation</span><span class="o">:</span><span class="s">&#39;vertical&#39;</span><span class="p">}</span>
        <span class="p">{</span><span class="nx">element</span><span class="o">:</span><span class="nx">jQuery</span><span class="p">(</span><span class="s">&#39;.north&#39;</span><span class="p">),</span> <span class="nx">orientation</span><span class="o">:</span><span class="s">&#39;horizontal&#39;</span><span class="p">}</span>
        <span class="p">{</span><span class="nx">element</span><span class="o">:</span><span class="nx">jQuery</span><span class="p">(</span><span class="s">&#39;.east&#39;</span><span class="p">),</span> <span class="nx">orientation</span><span class="o">:</span><span class="s">&#39;vertical&#39;</span><span class="p">}</span>
        <span class="p">{</span><span class="nx">element</span><span class="o">:</span><span class="nx">jQuery</span><span class="p">(</span><span class="s">&#39;.south&#39;</span><span class="p">),</span> <span class="nx">orientation</span><span class="o">:</span><span class="s">&#39;horizontal&#39;</span><span class="p">}</span>
      <span class="p">]</span>
      <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationsSidebars</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span> <span class="c1"># show annotation sidebars as overlays</span>
    <span class="k">else</span> <span class="c1"># restoring non-fullscreen view, using originally declared containers</span>
      <span class="nv">LimePlayer.widgetContainers = </span><span class="nx">@_nonfullscreen_containers</span>
      <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationsSidebars</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span> <span class="c1"># hiding sidebars</span>
    <span class="k">for</span> <span class="nx">annotation</span> <span class="k">in</span> <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">annotations</span> <span class="c1"># retrigger becomeActive event on each active annotation to force plugins to redraw</span>
      <span class="k">if</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">state</span> <span class="o">is</span> <span class="s">&#39;active&#39;</span> <span class="c1"># to avoid duplicate display, we inactivate first, then reactivate them</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="nx">annotation</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s">&quot;becomeInactive&quot;</span><span class="p">,</span> <span class="nv">annotation: </span><span class="nx">annotation</span><span class="p">))</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="nx">annotation</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s">&quot;becomeActive&quot;</span><span class="p">,</span> <span class="nv">annotation: </span><span class="nx">annotation</span><span class="p">))</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>end added SORIN</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;_moveWidgets&quot;</span><span class="p">,</span> <span class="nx">isFullscreen</span>

  <span class="nv">_initPlugins: </span><span class="nf">(cb) -&gt;</span>
    <span class="vi">@plugins = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">pluginClass</span><span class="p">,</span> <span class="nx">options</span> <span class="k">of</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">builtinPlugins</span>
      <span class="nx">@plugins</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="nx">pluginClass</span><span class="p">]</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">options</span>
    <span class="k">for</span> <span class="nx">pluginClass</span><span class="p">,</span> <span class="nx">options</span> <span class="k">of</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">plugins</span>
      <span class="nx">@plugins</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="nx">pluginClass</span><span class="p">]</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">options</span>
    <span class="nx">cb</span><span class="p">()</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>options.preferredContainer can contain a widget container</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">allocateWidgetSpace: </span><span class="nf">(options) -&gt;</span> <span class="c1"># creates DOM elements for widgets</span>
    <span class="k">if</span> <span class="nx">options</span> <span class="o">and</span> <span class="nx">options</span><span class="p">.</span><span class="nx">preferredContainer</span> <span class="o">and</span> <span class="nx">@_hasFreeSpace</span> <span class="nx">options</span><span class="p">.</span><span class="nx">preferredContainer</span><span class="p">,</span> <span class="nx">options</span>
      <span class="nv">container = </span><span class="nx">options</span><span class="p">.</span><span class="nx">preferredContainer</span>
    <span class="k">else</span>
      <span class="nv">container = </span><span class="nx">_</span><span class="p">(</span><span class="nx">@widgetContainers</span><span class="p">).</span><span class="nx">detect</span> <span class="p">(</span><span class="nx">cont</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>console.log("widget container" + <em>this.</em>hasFreeSpace(cont, options));</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">@_hasFreeSpace</span> <span class="nx">cont</span><span class="p">,</span> <span class="nx">options</span>
    <span class="k">if</span> <span class="nx">container</span>
      <span class="nx">container</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">prepend</span> <span class="s">&quot;&lt;div class=&#39;lime-widget&#39;&gt;&lt;/div&gt;&quot;</span>
      <span class="nv">res = </span><span class="nx">jQuery</span> <span class="s">&quot;.lime-widget:first&quot;</span><span class="p">,</span> <span class="nx">container</span><span class="p">.</span><span class="nx">element</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&#39;widgetspace allocated&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">res</span>
    <span class="k">else</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;There&#39;s not enough space for a widget to be shown!&quot;</span>
      <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">debug</span>
        <span class="nx">debugger</span>
      <span class="k">return</span> <span class="kc">false</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">container = </span><span class="nx">_</span><span class="p">(</span><span class="nx">@widgetContainers</span><span class="p">).</span><span class="nx">detect</span> <span class="p">(</span><span class="nx">cont</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@_hasFreeSpace</span> <span class="nx">cont</span><span class="p">,</span> <span class="nx">options</span>
    <span class="k">if</span> <span class="nx">container</span>
      <span class="nx">container</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">prepend</span> <span class="s">&quot;&lt;div class=&#39;lime-widget&#39;&gt;123&lt;/div&gt;&quot;</span>
      <span class="nx">jQuery</span><span class="p">(</span><span class="s">&#39;.lime-widget:first&#39;</span><span class="p">,</span> <span class="nx">container</span><span class="p">.</span><span class="nx">element</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="kc">no</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">_hasFreeSpace: </span><span class="nf">(container, options) -&gt;</span>
    <span class="nv">currentHeight = </span><span class="nx">container</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
    <span class="nv">maxHeight = </span><span class="nb">parseInt</span> <span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s">&quot;max-height&quot;</span><span class="p">))</span></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><p>console.log(maxHeight,currentHeight, $(window).height());</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">maxHeight</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">maxHeight</span> <span class="o">is</span> <span class="kc">NaN</span><span class="p">)</span>
      <span class="nv">maxHeight = </span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">-</span> <span class="mi">300</span></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><p>if(LIMEPlayer.player.isFullScreen) maxHeight =
console.log(maxHeight,currentHeight);</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">maxHeight</span> <span class="o">-</span> <span class="nx">currentHeight</span> <span class="o">&lt;</span> <span class="mi">200</span>
      <span class="k">return</span> <span class="kc">false</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><p>console.log(container.element.children().height());</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">else</span>
      <span class="k">return</span> <span class="kc">true</span>

  <span class="nv">getAnnotationsFor: </span><span class="nf">(uri, cb) -&gt;</span>

<span class="k">class</span> <span class="nx">Annotation</span>
  <span class="nv">constructor: </span><span class="nf">(hash) -&gt;</span>
    <span class="vi">@annotation = </span><span class="nx">hash</span><span class="p">.</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">value</span></pre></div></td></tr><tr id="section-36"><td class="docs"><div class="pilwrap"><a href="#section-36" class="pilcrow">&#182;</a></div><p>default start and end</p>
</td><td class="code"><div class="highlight"><pre>    <span class="vi">@start = </span><span class="mi">0</span>
    <span class="vi">@end = </span><span class="o">-</span><span class="mi">1</span> <span class="c1"># -1 means end of movie</span>
    <span class="vi">@state = </span><span class="s">&#39;inactive&#39;</span>
    <span class="vi">@widgets = </span><span class="p">{}</span> <span class="c1">#stores what plugins use this annotation; hash of plugin: [widgets]</span>
    <span class="nx">jQuery</span><span class="p">(</span><span class="nx">@</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;mouseenter&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">for</span> <span class="nx">widgetname</span><span class="p">,</span> <span class="nx">widget</span> <span class="k">of</span> <span class="nx">@widgets</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="nx">widget</span><span class="p">).</span><span class="nx">addClass</span> <span class="s">&quot;hover&quot;</span>
    <span class="nx">jQuery</span><span class="p">(</span><span class="nx">@</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;mouseleave&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">for</span> <span class="nx">widgetname</span><span class="p">,</span> <span class="nx">widget</span> <span class="k">of</span> <span class="nx">@widgets</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="nx">widget</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s">&quot;hover&quot;</span>
    <span class="k">if</span> <span class="nv">hash.fragment.type = </span><span class="s">&#39;uri&#39;</span>
      <span class="vi">@fragment = </span><span class="k">new</span> <span class="nx">URI</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">value</span>
      <span class="nv">fragmentHash = </span><span class="nx">@fragment</span><span class="p">.</span><span class="nx">hash</span>
      <span class="nv">t = </span><span class="nx">fragmentHash</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/t=([0-9,]*)/</span>
      <span class="k">if</span> <span class="nx">t</span></pre></div></td></tr><tr id="section-37"><td class="docs"><div class="pilwrap"><a href="#section-37" class="pilcrow">&#182;</a></div><p>t= "2,5" or "2"</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">t = </span><span class="nx">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div></td></tr><tr id="section-38"><td class="docs"><div class="pilwrap"><a href="#section-38" class="pilcrow">&#182;</a></div><p>startEnd = ["2,5", "2", "5"] or ["2", "2"]</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">startEnd = </span><span class="nx">t</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/([0-9]{1,})/g</span>
        <span class="k">if</span> <span class="nx">startEnd</span>
          <span class="vi">@start = </span><span class="nb">Number</span> <span class="nx">startEnd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="vi">@end = </span><span class="nb">Number</span><span class="p">(</span><span class="nx">startEnd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="o">-</span><span class="mi">1</span>

      <span class="nv">xywh = </span><span class="nx">fragmentHash</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/xywh=([a-z0-9,:]*)/</span>
      <span class="k">if</span> <span class="nx">xywh</span>
        <span class="vi">@isPercent = </span><span class="nx">xywh</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;percent&#39;</span><span class="p">)</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span></pre></div></td></tr><tr id="section-39"><td class="docs"><div class="pilwrap"><a href="#section-39" class="pilcrow">&#182;</a></div><p>convert the matches to numbers</p>
</td><td class="code"><div class="highlight"><pre>        <span class="p">[</span><span class="nx">@x</span><span class="p">,</span><span class="nx">@y</span><span class="p">,</span><span class="nx">@w</span><span class="p">,</span><span class="nx">@h</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nx">xywh</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="sr">/([0-9]{1,})/g</span><span class="p">)).</span><span class="nx">map</span> <span class="nf">(n) -&gt;</span> <span class="nb">Number</span> <span class="nx">n</span>
    <span class="vi">@isSpacial = </span><span class="nx">@x</span> <span class="o">isnt</span> <span class="kc">undefined</span> <span class="o">or</span> <span class="p">(</span><span class="nx">@x</span> <span class="o">is</span> <span class="nx">@y</span> <span class="o">is</span> <span class="nx">@w</span> <span class="o">is</span> <span class="nx">@h</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span>

    <span class="vi">@resource = </span><span class="k">new</span> <span class="nx">URI</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">resource</span><span class="p">.</span><span class="nx">value</span>
    <span class="vi">@relation = </span><span class="k">new</span> <span class="nx">URI</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">relation</span><span class="p">.</span><span class="nx">value</span>
  <span class="nv">toString: </span><span class="o">-&gt;</span>
    <span class="nx">@resource</span><span class="p">.</span><span class="nx">value</span>

<span class="k">class</span> <span class="nx">URI</span>
  <span class="nv">constructor: </span><span class="nf">(uri) -&gt;</span>
    <span class="vi">@value = </span><span class="nb">decodeURIComponent</span> <span class="nx">uri</span>
    <span class="nv">hash = </span><span class="nx">uri</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^.*?#([a-zA-Z0-9,&amp;=:]*)$/</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">hash</span>
      <span class="vi">@hash = </span><span class="nx">hash</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="vi">@hash = </span><span class="s">&#39;&#39;</span>
    <span class="vi">@type = </span><span class="s">&#39;uri&#39;</span>
  <span class="nv">toString: </span><span class="o">-&gt;</span>
    <span class="nx">@value</span></pre></div></td></tr><tr id="section-40"><td class="docs"><div class="pilwrap"><a href="#section-40" class="pilcrow">&#182;</a></div><h2>Abstract Lime Plugin</h2>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">LimePlugin</span>
  <span class="nv">constructor: </span><span class="nf">(@lime, options) -&gt;</span>
    <span class="vi">@options = </span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">@defaults</span>
    <span class="nx">@init</span><span class="p">()</span>
  <span class="nv">defaults: </span><span class="p">{}</span></pre></div></td></tr><tr id="section-41"><td class="docs"><div class="pilwrap"><a href="#section-41" class="pilcrow">&#182;</a></div><p>The init method has to be overwritten by each plugin.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">init: </span><span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;All Lime plugins have to implement the init method!&quot;</span></pre></div></td></tr><tr id="section-42"><td class="docs"><div class="pilwrap"><a href="#section-42" class="pilcrow">&#182;</a></div><h1>Simple reference Lime plugin called TestPlugin</h1>

<p>This plugin listens for annotations becoming active and inactive and</p>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">TestPlugin</span> <span class="k">extends</span> <span class="nb">window</span><span class="p">.</span><span class="nx">LimePlugin</span></pre></div></td></tr><tr id="section-43"><td class="docs"><div class="pilwrap"><a href="#section-43" class="pilcrow">&#182;</a></div><p>The init method is called right after initialisation of the player</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">init: </span><span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Initialize TestPlugin&quot;</span>
    <span class="nx">jQuery</span><span class="p">(</span><span class="nx">@lime</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&#39;timeupdate&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="c1"># timeupdate event is triggered by the VideoJS -&gt; $(LimePlayer)</span></pre></div></td></tr><tr id="section-44"><td class="docs"><div class="pilwrap"><a href="#section-44" class="pilcrow">&#182;</a></div><p>console.info 'plugin timeupdate event', e.currentTime</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="nx">annotation</span> <span class="k">in</span> <span class="nx">@lime</span><span class="p">.</span><span class="nx">annotations</span></pre></div></td></tr><tr id="section-45"><td class="docs"><div class="pilwrap"><a href="#section-45" class="pilcrow">&#182;</a></div><p>annotation</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">annotation</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&#39;becomeActive&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span><span class="p">,</span> <span class="s">&#39;became active&#39;</span>
        <span class="nv">domEl = </span><span class="nx">@lime</span><span class="p">.</span><span class="nx">allocateWidgetSpace</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">domEl</span>
          <span class="nx">domEl</span><span class="p">.</span><span class="nx">html</span> <span class="s">&quot;&lt;a href=&#39;</span><span class="si">#{</span><span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">resource</span><span class="si">}</span><span class="s">&#39; target=&#39;_blank&#39;&gt;</span><span class="si">#{</span><span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">resource</span><span class="si">}</span><span class="s">&lt;/a&gt;&quot;</span>
          <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">ldLoaded</span>
            <span class="nx">domEl</span><span class="p">.</span><span class="nx">html</span> <span class="nx">@renderAnnotation</span> <span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span>
          <span class="k">else</span>
            <span class="nx">jQuery</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&#39;ldloaded&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e2</span><span class="p">)</span> <span class="o">=&gt;</span>
              <span class="nx">domEl</span><span class="p">.</span><span class="nx">html</span> <span class="nx">@renderAnnotation</span> <span class="nx">e2</span><span class="p">.</span><span class="nx">annotation</span>
          <span class="nv">e.annotation.widgets.TestPlugin = </span><span class="nx">domEl</span>
        <span class="k">else</span></pre></div></td></tr><tr id="section-46"><td class="docs"><div class="pilwrap"><a href="#section-46" class="pilcrow">&#182;</a></div><p>debugger</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">annotation</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;becomeInactive&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span><span class="p">,</span> <span class="s">&#39;became inactive&#39;</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">TestPlugin</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">widgets</span>
          <span class="k">delete</span> <span class="nx">e</span><span class="p">.</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">TestPlugin</span>
        <span class="k">else</span>
          <span class="nx">debugger</span></pre></div></td></tr><tr id="section-47"><td class="docs"><div class="pilwrap"><a href="#section-47" class="pilcrow">&#182;</a></div><p>TODO implement release-space / kill a widget</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">renderAnnotation: </span><span class="nf">(annotation) -&gt;</span></pre></div></td></tr><tr id="section-48"><td class="docs"><div class="pilwrap"><a href="#section-48" class="pilcrow">&#182;</a></div><p>console.info "rendering", annotation</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">props = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">entity</span><span class="p">[</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">resource</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span>
    <span class="nv">label = </span><span class="nx">_</span><span class="p">(</span><span class="nx">props</span><span class="p">[</span><span class="s">&#39;http://www.w3.org/2000/01/rdf-schema#label&#39;</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">detect</span> <span class="nf">(labelObj) -&gt;</span>
      <span class="nx">labelObj</span><span class="p">.</span><span class="nx">lang</span> <span class="o">is</span> <span class="s">&#39;en&#39;</span>
    <span class="p">.</span><span class="nx">value</span>

    <span class="nv">depiction = </span><span class="nx">props</span><span class="p">[</span><span class="s">&#39;http://xmlns.com/foaf/0.1/depiction&#39;</span><span class="p">]</span><span class="o">?</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span></pre></div></td></tr><tr id="section-49"><td class="docs"><div class="pilwrap"><a href="#section-49" class="pilcrow">&#182;</a></div><p>depiction = props['http://dbpedia.org/ontology/thumbnail']?[0].value</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">page = </span><span class="nx">props</span><span class="p">[</span><span class="s">&#39;http://xmlns.com/foaf/0.1/page&#39;</span><span class="p">]</span><span class="o">?</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span></pre></div></td></tr><tr id="section-50"><td class="docs"><div class="pilwrap"><a href="#section-50" class="pilcrow">&#182;</a></div><p>console.info label, depiction</p>
</td><td class="code"><div class="highlight"><pre>    <span class="s">&quot;&quot;&quot;</span>
<span class="s">        &lt;p&gt;</span>
<span class="s">          &lt;a href=&quot;</span><span class="si">#{</span><span class="nx">page</span><span class="si">}</span><span class="s">&quot; target=&quot;_blank&quot;&gt;</span><span class="si">#{</span><span class="nx">label</span><span class="si">}</span><span class="s">&lt;/a&gt;</span>
<span class="s">        &lt;/p&gt;</span>
<span class="s">        &lt;p&gt;</span>
<span class="s">          &lt;img src=&quot;</span><span class="si">#{</span><span class="nx">depiction</span><span class="si">}</span><span class="s">&quot; width=&quot;200&quot;/&gt;</span>
<span class="s">        &lt;/p&gt;</span>
<span class="s">    &quot;&quot;&quot;</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Wed Oct 17 2012 19:04:34 GMT+0200 (CEST)  </div></div></body></html>