<!DOCTYPE html><html><head><title>geonamesmapplugin.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../src/annotation.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotation.coffee</span></a><a href="../../src/annotationoverlays.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotationoverlays.coffee</span></a><a href="../../src/cmf.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">cmf.coffee</span></a><a href="../../src/jquery.scrollTo.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">jquery.scrollTo.coffee</span></a><a href="../../src/lime.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">lime.coffee</span></a><a href="../../src/plugin.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">plugin.coffee</span></a><a href="../../src/plugins/actorplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">actorplugin.coffee</span></a><a href="../../src/plugins/bookingplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">bookingplugin.coffee</span></a><a href="../../src/plugins/businessplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">businessplugin.coffee</span></a><a href="../../src/plugins/characterplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">characterplugin.coffee</span></a><a href="../../src/plugins/dbpediainfoplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">dbpediainfoplugin.coffee</span></a><a href="../../src/plugins/directorplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">directorplugin.coffee</span></a><a href="../../src/plugins/geonamesmapplugin.coffee.html" class="source selected"><span class="base_path">src / plugins / </span><span class="file_name">geonamesmapplugin.coffee</span></a><a href="../../src/plugins/googleweatherplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">googleweatherplugin.coffee</span></a><a href="../../src/plugins/help.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">help.coffee</span></a><a href="../../src/plugins/ldplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">ldplugin.coffee</span></a><a href="../../src/plugins/ldplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">ldplugin.coffee</span></a><a href="../../src/plugins/lsiimageplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">lsiimageplugin.coffee</span></a><a href="../../src/plugins/lsivideoplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">lsivideoplugin.coffee</span></a><a href="../../src/plugins/mediaplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">mediaplugin.coffee</span></a><a href="../../src/plugins/objectplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">objectplugin.coffee</span></a><a href="../../src/plugins/tvplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">tvplugin.coffee</span></a><a href="../../src/plugins/videoplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">videoplugin.coffee</span></a><a href="../../src/plugins/youtubeplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">youtubeplugin.coffee</span></a><a href="../../src/videojs-adapter.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">videojs-adapter.coffee</span></a><a href="../../src/widget.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">widget.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>geonamesmapplugin.coffee</h1><div class="filepath">src/plugins/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">GeoNamesMapPlugin</span> <span class="k">extends</span> <span class="nb">window</span><span class="p">.</span><span class="nx">LimePlugin</span>
  <span class="nv">init: </span><span class="o">-&gt;</span>
    <span class="vi">@name = </span><span class="s">&#39;GeoNamesMapPlugin&#39;</span>
    <span class="nv">annotation = </span><span class="kc">undefined</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Initialize GeoNamesMapPlugin&quot;</span>

    <span class="k">for</span> <span class="nx">annotation</span> <span class="k">in</span> <span class="nx">@lime</span><span class="p">.</span><span class="nx">annotations</span>
      <span class="k">if</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">resource</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;sws.geonames.org&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">relation</span><span class="p">.</span><span class="nx">value</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;http://connectme.at/ontology#explicitlyShows&#39;</span><span class="p">,</span> <span class="s">&#39;http://connectme.at/ontology#explicitlyMentions&#39;</span><span class="p">,</span> <span class="s">&#39;http://connectme.at/ontology#implicitlyShows&#39;</span> <span class="p">,</span> <span class="s">&#39;http://connectme.at/ontology#implicitlyMentions&#39;</span><span class="p">]</span> <span class="c1"># is &quot;http://connectme.at/ontology#hasKeyword&quot;</span>
        <span class="nx">@handleAnnotation</span> <span class="nx">annotation</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Putting this into a function keeps the annotation in the context</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">handleAnnotation: </span><span class="nf">(annotation) -&gt;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>console.info "The annotation #{annotation.resource} looks interesting, get the whole entity so we can show it in a widget!", annotation</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">annotation</span><span class="p">.</span><span class="nx">entityPromise</span><span class="p">.</span><span class="nx">done</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>console.info "entities for annotation #{annotation.resource} loaded, create a widget for it!", annotation</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">widget = </span><span class="nx">@lime</span><span class="p">.</span><span class="nx">allocateWidgetSpace</span> <span class="nx">@</span><span class="p">,</span>
        <span class="nv">thumbnail: </span><span class="s">&quot;img/mapIcon.png&quot;</span> <span class="c1"># should go into CSS</span>
        <span class="nv">title: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLabel</span><span class="p">()</span><span class="si">}</span><span class="s"> Map&quot;</span>
        <span class="nv">type: </span><span class="s">&quot;GeoNamesMapWidget&quot;</span>
        <span class="nv">sortBy: </span><span class="o">-&gt;</span>
          <span class="mi">10000</span> <span class="o">*</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">end</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>We're going to need the annotation for the widget's <code>activate</code> event</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">widget.annotation = </span><span class="nx">annotation</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>widget was activated, we show details now</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">widget</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&#39;activate&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">@showInModalWindow</span> <span class="nx">annotation</span><span class="p">,</span> <span class="nx">@getModalContainer</span><span class="p">()</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Hang the widget on the annotation</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">annotation</span><span class="p">.</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">@name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">widget</span>

      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">annotation</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;becomeActive&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">annotation</span><span class="p">.</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">@name</span><span class="p">].</span><span class="nx">setActive</span><span class="p">()</span>

      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">annotation</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;becomeInactive&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">annotation</span><span class="p">.</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">@name</span><span class="p">].</span><span class="nx">setInactive</span><span class="p">()</span>


      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">widget</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;leftarrow&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>@geotabsiterator += 1</p>
</td><td class="code"><div class="highlight"><pre>        <span class="vi">@geotabsiterator = </span><span class="k">if</span> <span class="nx">@geotabs</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="nx">@geotabsiterator</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">@geotabsiterator</span> <span class="o">+</span> <span class="mi">1</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>$('.geotab.selected').removeClass 'selected'</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">@geotabsiterator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoMap&quot;</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&#39;click&#39;</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>$("#geoMap").addClass 'selected'</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">@geotabsiterator</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoWeather&quot;</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&#39;click&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">@geotabsiterator</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoRout&quot;</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&#39;click&#39;</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>$("#geoRout").addClass 'selected'</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">@geotabsiterator</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoPanoramio&quot;</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&#39;click&#39;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>$("#geoPanoramio").addClass 'selected'</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">widget</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;rightarrow&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>@geotabsiterator += 1</p>
</td><td class="code"><div class="highlight"><pre>        <span class="vi">@geotabsiterator = </span><span class="k">if</span> <span class="nx">@geotabsiterator</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">@geotabs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>  <span class="k">else</span> <span class="nx">@geotabsiterator</span> <span class="o">-</span> <span class="mi">1</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>$('.geotab.selected').removeClass 'selected'</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">@geotabsiterator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoMap&quot;</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&#39;click&#39;</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>$("#geoMap").addClass 'selected'</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">@geotabsiterator</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoWeather&quot;</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&#39;click&#39;</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>$("#geoWeather").addClass 'selected'</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">@geotabsiterator</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoRout&quot;</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&#39;click&#39;</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>$("#geoRout").addClass 'selected'</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">@geotabsiterator</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoPanoramio&quot;</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&#39;click&#39;</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>$("#geoPanoramio").addClass 'selected'</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">widget</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;uparrow&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>customEvent = jQuery.Event "keydown"
customEvent.which = 107 # + key code value</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>$("#geoMap").trigger 'click'
$("#map_area").trigger customEvent</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">currentZoom = </span><span class="nx">@geomap</span><span class="p">.</span><span class="nx">getZoom</span><span class="p">()</span>
        <span class="nx">@geomap</span><span class="p">.</span><span class="nx">setZoom</span> <span class="nx">currentZoom</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="nx">jQuery</span><span class="p">(</span><span class="nx">widget</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;downarrow&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nv">currentZoom = </span><span class="nx">@geomap</span><span class="p">.</span><span class="nx">getZoom</span><span class="p">()</span>
        <span class="nx">@geomap</span><span class="p">.</span><span class="nx">setZoom</span> <span class="nx">currentZoom</span> <span class="o">-</span> <span class="mi">1</span>


  <span class="nv">showInModalWindow: </span><span class="nf">(annotation, outputElement) -&gt;</span>
    <span class="nv">modalContent = </span><span class="kc">undefined</span>
    <span class="nv">result = </span><span class="kc">undefined</span>
    <span class="nv">language = </span><span class="nx">UTILS</span><span class="p">.</span><span class="nx">getParameterByName</span><span class="p">(</span><span class="s">&quot;lang&quot;</span><span class="p">)</span>
    <span class="nv">startTime = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>fix container size</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">modalContent = </span><span class="nx">$</span><span class="p">(</span><span class="nx">outputElement</span><span class="p">)</span>
    <span class="nx">modalContent</span><span class="p">.</span><span class="nx">css</span> <span class="s">&quot;width&quot;</span><span class="p">,</span> <span class="s">&quot;600px&quot;</span>
    <span class="nx">modalContent</span><span class="p">.</span><span class="nx">css</span> <span class="s">&quot;height&quot;</span><span class="p">,</span> <span class="s">&quot;600px&quot;</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>render widget</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">language</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;en&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>result = "<div id=\"map_area\" class=\"mainWidgetContainer\" style=\"position: absolute; z-index: 900; background-image: url('img/map.png'); background-repeat: no-repeat; background-position: left top; background-size: cover; box-shadow: inset 0 0 5px #888; height: " + (widgetHeight - 116) + "px; width: 740px; left: 0px; top: 116px;\"></div>\n <div id=\"geowidgetheader\" style=\"position: absolute; z-index: 900; background-color: #9c9c9b; background-repeat: no-repeat; background-position: 0px 0px; background-size: cover; background-image: url('img/mapBckg.png'); width: 660px; height: 116px; left: 80px; top: 0;\">\n   <div id=\"location_bar\" style=\"background-color: #45c048; width: 100%; position: relative; left: 0px; top: 0px; height: 38px; visibility: hidden; visibility: hidden;\">\n  </div>\n   <div id=\"weather_bar\" style=\"height: 38px; width: 100%; background-color: #f8cb86; visibility: hidden;\"></div>\n   <div id=\"close\" style=\"position: absolute; background-color: #070606; width: 0px; height: 100%; left: 616px; top: 0px;\">\n</div>\n   <p id=\"elevation\" style=\"bottom: 1px; float: none; display: inline; position: absolute; z-index: 900; font-family: Arial,Helvetica,sans-serif; font-size: 22px; text-align: right; line-height: normal; font-weight: bold; color: #ffffff; vertical-align: baseline; text-decoration: none; font-style: normal; text-indent: 0; margin-top: 0px; margin-bottom: 0px; margin-right: 1em; right: 48px;\"> &nbsp; </p>\n   <div id=\"rout_bar\" style=\"width: 100%; height: 40px; background-color: #fc8466; visibility: hidden;\"></div>\n </div>\n <div id=\"menu_bar\" style=\"border: none; position: absolute; z-index: 900; background-color: transparent; width: 77px; height: 113px; left: 3px; top: 0;\">\n <div id=\"menu_button_container\" style=\"position: relative; top: 0px; display: block; right: 0px; z-index: 900; float: right; width: 80px; height: 117px; left: 0px;\">\n<div id=\"geoMap\" style=\"position: relative; background-position: center center; background-image: url('img/mapIcon.png'); background-size: contain; float: none; height: 38px; width: 86px;\"></div>\n<div id=\"geoWeather\" style=\"position: relative; background-position: center center; background-image: url('img/weather.png'); background-size: contain; float: none; width: 86px; height: 38px;\"></div>\n<div id=\"geoRout\" style=\"background-position: center center; background-size: contain; background-image: url('img/directionIcon.png'); float: none; width: 86px; height: 40px;\"></div>\n</div>\n </div>\n </body>"</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">result = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">               &lt;div id=&quot;ifoWidgetExpanded&quot; style=&quot;border: 1px dotted lightgray; position: absolute; top: 0; z-index: 100; width: 600px; right: 0; height: 600px;&quot;&gt;</span>
<span class="s">               &lt;div id=&quot;map_area&quot; style=&quot;left: 0px; top: 0px; width: 600px; height: 600px; position: relative;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;div id=&quot;mapMenu&quot; style=&quot;position: absolute; z-index: 900; width: auto; right: 1px; bottom: 0px; height: 41px;&quot;&gt;</span>
<span class="s">               &lt;div id=&quot;geoMap&quot; class=&quot;geotab&quot; style=&quot;position: relative; background-position: center center; background-image: url(&#39;img/mapIcon.png&#39;); background-size: contain; float: right; height: 40px; width: 86px;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;div id=&quot;geoWeather&quot; class=&quot;geotab&quot; style=&quot;position: relative; background-position: center center; background-image: url(&#39;img/weather.png&#39;); background-size: contain; float: right; width: 86px; height: 40px;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;div id=&quot;geoRout&quot; class=&quot;geotab&quot; style=&quot;background-position: center center; background-size: contain; background-image: url(&#39;img/directionIcon.png&#39;); float: right; width: 86px; height: 40px;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;div id=&quot;geoPanoramio&quot; class=&quot;geotab disabled&quot; style=&quot;display: none; background-position: center center; background-size: contain; background-image: url(&#39;img/directionIcon.png&#39;); float: right; width: 86px; height: 40px;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;/div&gt;</span>
<span class="s">              &lt;!-- &lt;div id=&quot;closingButton&quot; style=&quot;position: absolute; z-index: 900; width: 87px; height: 38px; background-color: </span><span class="err">#</span><span class="s">414040; left: 513px; top: 408px;&quot;&gt;&lt;span data-dojo-type=&quot;shapes.Text&quot; style=&quot;font-size: 14px; position: absolute; z-index: 900; color: </span><span class="err">#</span><span class="s">ffffff; left: 41px; top: 8.5px;&quot;&gt;X&lt;/span&gt;&lt;/div&gt; --&gt;</span>
<span class="s">               &lt;/div&gt;</span>
<span class="s">               &quot;&quot;&quot;</span>
    <span class="k">else</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>result = "<div id=\"map_area\" class=\"mainWidgetContainer\" style=\"position: absolute; z-index: 900; background-image: url('img/map.png'); background-repeat: no-repeat; background-position: left top; background-size: cover; box-shadow: inset 0 0 5px #888; height: " + (widgetHeight - 116) + "px; width: 740px; left: 0px; top: 116px;\"></div>\n <div id=\"geowidgetheader\" style=\"position: absolute; z-index: 900; background-color: #9c9c9b; background-repeat: no-repeat; background-position: 0px 0px; background-size: cover; background-image: url('img/mapBckg.png'); width: 660px; height: 116px; left: 80px; top: 0;\">\n   <div id=\"location_bar\" style=\"background-color: #45c048; width: 617px; position: relative; left: 0px; top: 0px; height: 38px;\">\n  </div>\n   <div id=\"weather_bar\" style=\"height: 38px; width: 617px; background-color: #f8cb86;\"></div>\n   <div id=\"close\" style=\"position: absolute; background-color: #070606; width: 48px; height: 100%; left: 616px; top: 0px;\">\n</div>\n   <p id=\"elevation\" style=\"bottom: 1px; float: none; display: inline; position: absolute; z-index: 900; font-family: Arial,Helvetica,sans-serif; font-size: 22px; text-align: right; line-height: normal; font-weight: bold; color: #ffffff; vertical-align: baseline; text-decoration: none; font-style: normal; text-indent: 0; margin-top: 0px; margin-bottom: 0px; margin-right: 1em; right: 48px;\"> &nbsp; </p>\n   <div id=\"rout_bar\" style=\"width: 617px; height: 40px; background-color: #fc8466;\"></div>\n </div>\n <div id=\"menu_bar\" style=\"border: none; border-radius: 6px; -moz-border-radius: 6px; border-top-left-radius: 6px; border-top-right-radius: 6px; border-bottom-right-radius: 6px; border-bottom-left-radius: 6px; position: absolute; z-index: 900; background-color: transparent; width: 77px; height: 113px; left: 0px; top: 0;\">\n <div id=\"menu_button_container\" style=\"position: relative; top: 0px; display: block; right: 0px; z-index: 900; float: right; width: 80px; height: 117px; left: 0px;\">\n<div id=\"geoMap\" style=\"position: relative; background-position: center center; background-image: url('img/mapIcon.png'); background-size: contain; float: none; height: 38px; width: 86px;\"></div>\n<div id=\"geoWeather\" style=\"position: relative; background-position: center center; background-image: url('img/weather.png'); background-size: contain; float: none; width: 86px; height: 38px;\"></div>\n<div id=\"geoRout\" style=\"background-position: center center; background-size: contain; background-image: url('img/directionIcon.png'); float: none; width: 86px; height: 40px;\"></div>\n</div>\n </div>\n </body>"  if language.indexOf("de") >= 0</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">result = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">               &lt;div id=&quot;ifoWidgetExpanded&quot; style=&quot;border: 1px dotted lightgray; position: absolute; top: 0; z-index: 100; width: 600px; right: 0; height: 600px;&quot;&gt;</span>
<span class="s">               &lt;div id=&quot;map_area&quot; style=&quot;left: 0px; top: 0px; width: 600px; height: 600px; position: relative;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;div id=&quot;mapMenu&quot; style=&quot;position: absolute; z-index: 900; width: auto; right: 1px; bottom: 0px; height: 41px;&quot;&gt;</span>
<span class="s">               &lt;div id=&quot;geoMap&quot; class=&quot;geotab&quot; style=&quot;position: relative; background-position: center center; background-image: url(&#39;img/mapIcon.png&#39;); background-size: contain; float: right; height: 40px; width: 86px;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;div id=&quot;geoWeather&quot; class=&quot;geotab&quot; style=&quot;position: relative; background-position: center center; background-image: url(&#39;img/weather.png&#39;); background-size: contain; float: right; width: 86px; height: 40px;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;div id=&quot;geoRout&quot; class=&quot;geotab&quot; style=&quot;background-position: center center; background-size: contain; background-image: url(&#39;img/directionIcon.png&#39;); float: right; width: 86px; height: 40px;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;div id=&quot;geoPanoramio&quot; class=&quot;geotab disabled&quot; style=&quot;display: none; background-position: center center; background-size: contain; background-image: url(&#39;img/directionIcon.png&#39;); float: right; width: 86px; height: 40px;&quot;&gt;&lt;/div&gt;</span>
<span class="s">               &lt;/div&gt;</span>
<span class="s">               &lt;!-- &lt;div id=&quot;closingButton&quot; style=&quot;position: absolute; z-index: 900; width: 87px; height: 38px; background-color: </span><span class="err">#</span><span class="s">414040; left: 513px; top: 408px;&quot;&gt;&lt;span data-dojo-type=&quot;shapes.Text&quot; style=&quot;font-size: 14px; position: absolute; z-index: 900; color: </span><span class="err">#</span><span class="s">ffffff; left: 41px; top: 8.5px;&quot;&gt;X&lt;/span&gt;&lt;/div&gt; --&gt;</span>
<span class="s">               &lt;/div&gt;</span>
<span class="s">               &quot;&quot;&quot;</span>
    <span class="nx">modalContent</span><span class="p">.</span><span class="nx">append</span> <span class="nx">result</span>
    <span class="vi">@geotabs = </span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;.geotab:not(.disabled)&#39;</span><span class="p">)</span>
    <span class="vi">@geotabsiterator = </span><span class="mi">0</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>control widget</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.close&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">endTime = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
      <span class="nv">timeSpent = </span><span class="nx">endTime</span> <span class="o">-</span> <span class="nx">startTime</span>
      <span class="nv">eventLabel = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">@</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;: </span><span class="si">#{</span><span class="nx">eventLabel</span><span class="si">}</span><span class="s"> was viewed </span><span class="si">#{</span><span class="nx">timeSpent</span><span class="si">}</span><span class="s"> msec.&quot;</span>

    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#mask&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">endTime = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
      <span class="nv">timeSpent = </span><span class="nx">endTime</span> <span class="o">-</span> <span class="nx">startTime</span>
      <span class="nv">eventLabel = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">@</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;: </span><span class="si">#{</span><span class="nx">eventLabel</span><span class="si">}</span><span class="s"> was viewed </span><span class="si">#{</span><span class="nx">timeSpent</span><span class="si">}</span><span class="s"> msec.&quot;</span>

    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoMap&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.geotab.selected&#39;</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s">&#39;selected&#39;</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>menu handling</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">location_bar&quot;</span><span class="p">).</span><span class="nx">css</span> <span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">weather_bar&quot;</span><span class="p">).</span><span class="nx">css</span> <span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">rout_bar&quot;</span><span class="p">).</span><span class="nx">css</span> <span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">map_area&quot;</span><span class="p">).</span><span class="nx">empty</span><span class="p">()</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>cartography handling</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">i = </span><span class="kc">undefined</span>
      <span class="nv">latitude = </span><span class="kc">undefined</span>
      <span class="nv">latlng = </span><span class="kc">undefined</span>
      <span class="nv">locationName = </span><span class="kc">undefined</span>
      <span class="nv">longitude = </span><span class="kc">undefined</span>
      <span class="nv">map = </span><span class="kc">undefined</span>
      <span class="nv">myOptions = </span><span class="kc">undefined</span>
      <span class="nv">output = </span><span class="kc">undefined</span>
      <span class="nv">x = </span><span class="kc">undefined</span>
      <span class="nv">xmlDoc = </span><span class="kc">undefined</span>
      <span class="nv">xmlhttp = </span><span class="kc">undefined</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>      <span class="k">try</span>
        <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span>
          <span class="nv">xmlhttp = </span><span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nv">xmlhttp = </span><span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s">&quot;Microsoft.XMLHTTP&quot;</span><span class="p">)</span>
        <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span> <span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">resource</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s">&quot;/about.rdf&quot;</span><span class="p">,</span> <span class="kc">false</span>
        <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
        <span class="nv">xmlDoc = </span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseXML</span>
        <span class="nv">x = </span><span class="nx">xmlDoc</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;Feature&quot;</span><span class="p">)</span>
        <span class="nv">i = </span><span class="mi">0</span>
        <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span>
          <span class="nv">locationName = </span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span>
          <span class="nv">latitude = </span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;lat&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span>
          <span class="nv">longitude = </span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;long&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span>
          <span class="nx">i</span><span class="o">++</span>
        <span class="nv">output = </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s">&quot;map_area&quot;</span><span class="p">)</span>
        <span class="nv">latlng = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="nx">latitude</span><span class="p">,</span> <span class="nx">longitude</span><span class="p">)</span>
        <span class="nv">myOptions =</span>
          <span class="nv">zoom: </span><span class="mi">13</span>
          <span class="nv">center: </span><span class="nx">latlng</span>
          <span class="nv">mapTypeId: </span><span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">MapTypeId</span><span class="p">.</span><span class="nx">ROADMAP</span>

        <span class="nv">map = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span> <span class="nx">myOptions</span><span class="p">)</span>
        <span class="vi">@geomap = </span><span class="nx">map</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="nx">@geomap</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>google.maps.event.addListener(output, 'keydown', console.info 'map catched the keydown event');</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">locationName = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLabel</span><span class="p">()</span>
      <span class="nv">latitude = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLatitude</span><span class="p">()</span>
      <span class="nv">longitude = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLongitude</span><span class="p">()</span>

      <span class="nv">output = </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s">&quot;map_area&quot;</span><span class="p">)</span>
      <span class="nv">latlng = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="nx">latitude</span><span class="p">,</span> <span class="nx">longitude</span><span class="p">)</span>
      <span class="nv">myOptions =</span>
        <span class="nv">zoom: </span><span class="mi">13</span>
        <span class="nv">center: </span><span class="nx">latlng</span>
        <span class="nv">mapTypeId: </span><span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">MapTypeId</span><span class="p">.</span><span class="nx">ROADMAP</span>

      <span class="nv">map = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span> <span class="nx">myOptions</span><span class="p">)</span>
      <span class="vi">@geomap = </span><span class="nx">map</span>


      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoMap&quot;</span><span class="p">).</span><span class="nx">addClass</span> <span class="s">&#39;selected&#39;</span>

    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoWeather&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.geotab.selected&#39;</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s">&#39;selected&#39;</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>menu handling</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">location_bar&quot;</span><span class="p">).</span><span class="nx">css</span> <span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">weather_bar&quot;</span><span class="p">).</span><span class="nx">css</span> <span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">rout_bar&quot;</span><span class="p">).</span><span class="nx">css</span> <span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">map_area&quot;</span><span class="p">).</span><span class="nx">empty</span><span class="p">()</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>cartography handling</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">i = </span><span class="kc">undefined</span>
      <span class="nv">latitude = </span><span class="kc">undefined</span>
      <span class="nv">latlng = </span><span class="kc">undefined</span>
      <span class="nv">locationName = </span><span class="kc">undefined</span>
      <span class="nv">longitude = </span><span class="kc">undefined</span>
      <span class="nv">map = </span><span class="kc">undefined</span>
      <span class="nv">myOptions = </span><span class="kc">undefined</span>
      <span class="nv">output = </span><span class="kc">undefined</span>
      <span class="nv">weatherLayer = </span><span class="kc">undefined</span>
      <span class="nv">x = </span><span class="kc">undefined</span>
      <span class="nv">xmlDoc = </span><span class="kc">undefined</span>
      <span class="nv">xmlhttp = </span><span class="kc">undefined</span></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>      <span class="k">try</span>
        <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span>
          <span class="nv">xmlhttp = </span><span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nv">xmlhttp = </span><span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s">&quot;Microsoft.XMLHTTP&quot;</span><span class="p">)</span>
        <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span> <span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">resource</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s">&quot;/about.rdf&quot;</span><span class="p">,</span> <span class="kc">false</span>
        <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
        <span class="nv">xmlDoc = </span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseXML</span>
        <span class="nv">x = </span><span class="nx">xmlDoc</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;Feature&quot;</span><span class="p">)</span>
        <span class="nv">i = </span><span class="mi">0</span>
        <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span>
          <span class="nv">locationName = </span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span>
          <span class="nv">latitude = </span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;lat&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span>
          <span class="nv">longitude = </span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;long&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span>
          <span class="nx">i</span><span class="o">++</span></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">locationName = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLabel</span><span class="p">()</span>
      <span class="nv">latitude = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLatitude</span><span class="p">()</span>
      <span class="nv">longitude = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLongitude</span><span class="p">()</span>

      <span class="nv">output = </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s">&quot;map_area&quot;</span><span class="p">)</span>
      <span class="nv">latlng = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="nx">latitude</span><span class="p">,</span> <span class="nx">longitude</span><span class="p">)</span>
      <span class="nv">myOptions =</span>
        <span class="nv">zoom: </span><span class="mi">11</span>
        <span class="nv">center: </span><span class="nx">latlng</span>
        <span class="nv">mapTypeId: </span><span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">MapTypeId</span><span class="p">.</span><span class="nx">ROADMAP</span>

      <span class="nv">map = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span> <span class="nx">myOptions</span><span class="p">)</span>
      <span class="nv">weatherLayer = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">weather</span><span class="p">.</span><span class="nx">WeatherLayer</span><span class="p">(</span><span class="nv">temperatureUnits: </span><span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">weather</span><span class="p">.</span><span class="nx">TemperatureUnit</span><span class="p">.</span><span class="nx">CELSIUS</span><span class="p">)</span>
      <span class="nx">weatherLayer</span><span class="p">.</span><span class="nx">setMap</span> <span class="nx">map</span>
      <span class="vi">@geomap = </span><span class="nx">map</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoWeather&quot;</span><span class="p">).</span><span class="nx">addClass</span> <span class="s">&#39;selected&#39;</span>

    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoRout&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.geotab.selected&#39;</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s">&#39;selected&#39;</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><p>menu handling</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">location_bar&quot;</span><span class="p">).</span><span class="nx">css</span> <span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">weather_bar&quot;</span><span class="p">).</span><span class="nx">css</span> <span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">rout_bar&quot;</span><span class="p">).</span><span class="nx">css</span> <span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">map_area&quot;</span><span class="p">).</span><span class="nx">empty</span><span class="p">()</span></pre></div></td></tr><tr id="section-36"><td class="docs"><div class="pilwrap"><a href="#section-36" class="pilcrow">&#182;</a></div><p>cartography handling</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">if</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span>
        <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span> <span class="p">(</span><span class="nf">(position) -&gt;</span>
          <span class="nv">i = </span><span class="kc">undefined</span>
          <span class="nv">latitude = </span><span class="kc">undefined</span>
          <span class="nv">locationName = </span><span class="kc">undefined</span>
          <span class="nv">longitude = </span><span class="kc">undefined</span>
          <span class="nv">map = </span><span class="kc">undefined</span>
          <span class="nv">myOptions = </span><span class="kc">undefined</span>
          <span class="nv">output = </span><span class="kc">undefined</span>
          <span class="nv">x = </span><span class="kc">undefined</span>
          <span class="nv">xmlDoc = </span><span class="kc">undefined</span>
          <span class="nv">xmlhttp = </span><span class="kc">undefined</span>
          <span class="nv">start = </span><span class="kc">undefined</span>
          <span class="nv">destination = </span><span class="kc">undefined</span>
          <span class="nv">directionDisplay = </span><span class="kc">undefined</span>
          <span class="nv">directionsService = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">DirectionsService</span><span class="p">()</span></pre></div></td></tr><tr id="section-37"><td class="docs"><div class="pilwrap"><a href="#section-37" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>          <span class="k">try</span>
            <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span>
              <span class="nv">xmlhttp = </span><span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
            <span class="k">else</span>
              <span class="nv">xmlhttp = </span><span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s">&quot;Microsoft.XMLHTTP&quot;</span><span class="p">)</span>
            <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span> <span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">resource</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s">&quot;/about.rdf&quot;</span><span class="p">,</span> <span class="kc">false</span>
            <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
            <span class="nv">xmlDoc = </span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseXML</span>
            <span class="nv">x = </span><span class="nx">xmlDoc</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;Feature&quot;</span><span class="p">)</span>
            <span class="nv">i = </span><span class="mi">0</span>
            <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span>
              <span class="nv">locationName = </span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span>
              <span class="nv">latitude = </span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;lat&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span>
              <span class="nv">longitude = </span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;long&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span>
              <span class="nx">i</span><span class="o">++</span></pre></div></td></tr><tr id="section-38"><td class="docs"><div class="pilwrap"><a href="#section-38" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>          <span class="nv">locationName = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLabel</span><span class="p">()</span>
          <span class="nv">latitude = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLatitude</span><span class="p">()</span>
          <span class="nv">longitude = </span><span class="nx">annotation</span><span class="p">.</span><span class="nx">getLongitude</span><span class="p">()</span>

          <span class="nv">output = </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s">&quot;map_area&quot;</span><span class="p">)</span>
          <span class="nv">directionsDisplay = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">DirectionsRenderer</span><span class="p">()</span>
          <span class="nv">destination = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="nx">latitude</span><span class="p">,</span> <span class="nx">longitude</span><span class="p">)</span>
          <span class="nv">mapOptions =</span>
            <span class="nv">zoom: </span><span class="mi">7</span>
            <span class="nv">mapTypeId: </span><span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">MapTypeId</span><span class="p">.</span><span class="nx">ROADMAP</span>
            <span class="nv">center: </span><span class="nx">destination</span>

          <span class="nv">map = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span> <span class="nx">mapOptions</span><span class="p">)</span>
          <span class="nv">start = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span> <span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">)</span></pre></div></td></tr><tr id="section-39"><td class="docs"><div class="pilwrap"><a href="#section-39" class="pilcrow">&#182;</a></div><p>set direction map
alert(start);</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">directionsDisplay</span><span class="p">.</span><span class="nx">setMap</span> <span class="nx">map</span>
          <span class="vi">@geomap = </span><span class="nx">map</span>
          <span class="nv">request =</span>
            <span class="nv">origin: </span><span class="nx">start</span>
            <span class="nv">destination: </span><span class="nx">destination</span>
            <span class="nv">travelMode: </span><span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">TravelMode</span><span class="p">.</span><span class="nx">DRIVING</span>

          <span class="nx">directionsService</span><span class="p">.</span><span class="nx">route</span> <span class="nx">request</span><span class="p">,</span> <span class="nf">(result, status) -&gt;</span>
            <span class="nx">directionsDisplay</span><span class="p">.</span><span class="nx">setDirections</span> <span class="nx">result</span>  <span class="k">if</span> <span class="nx">status</span> <span class="o">is</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">DirectionsStatus</span><span class="p">.</span><span class="nx">OK</span></pre></div></td></tr><tr id="section-40"><td class="docs"><div class="pilwrap"><a href="#section-40" class="pilcrow">&#182;</a></div><p>next function is the error callback</p>
</td><td class="code"><div class="highlight"><pre>        <span class="p">),</span>
        <span class="nf">(error) -&gt;</span>
          <span class="k">switch</span> <span class="nx">error</span><span class="p">.</span><span class="nx">code</span>
            <span class="k">when</span> <span class="nx">error</span><span class="p">.</span><span class="nx">TIMEOUT</span>
              <span class="nx">alert</span> <span class="s">&quot;Timeout&quot;</span>
            <span class="k">when</span> <span class="nx">error</span><span class="p">.</span><span class="nx">POSITION_UNAVAILABLE</span>
              <span class="nx">alert</span> <span class="s">&quot;Position unavailable&quot;</span>
            <span class="k">when</span> <span class="nx">error</span><span class="p">.</span><span class="nx">PERMISSION_DENIED</span>
              <span class="nx">alert</span> <span class="s">&quot;Permission denied&quot;</span>
            <span class="k">when</span> <span class="nx">error</span><span class="p">.</span><span class="nx">UNKNOWN_ERROR</span>
              <span class="nx">alert</span> <span class="s">&quot;Unknown error&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoRout&quot;</span><span class="p">).</span><span class="nx">addClass</span> <span class="s">&#39;selected&#39;</span>

    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoPanoramio&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.geotab.selected&#39;</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s">&#39;selected&#39;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoPanoramio&quot;</span><span class="p">).</span><span class="nx">addClass</span> <span class="s">&#39;selected&#39;</span></pre></div></td></tr><tr id="section-41"><td class="docs"><div class="pilwrap"><a href="#section-41" class="pilcrow">&#182;</a></div><p>default selection</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoMap&quot;</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&quot;click&quot;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">geoMap&quot;</span><span class="p">).</span><span class="nx">addClass</span> <span class="s">&#39;selected&#39;</span>
    <span class="k">return</span><span class="p">;</span>

</pre></div></td></tr></tbody></table><div id="projectname"><a href="../../index.html">LIME - Linked Media Player</a></div></div></body></html>