<!DOCTYPE html><html><head><title>cmf.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../src/annotation.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotation.coffee</span></a><a href="../src/annotationoverlays.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotationoverlays.coffee</span></a><a href="../src/cmf.coffee.html" class="source selected"><span class="base_path">src / </span><span class="file_name">cmf.coffee</span></a><a href="../src/jquery.scrollTo.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">jquery.scrollTo.coffee</span></a><a href="../src/lime.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">lime.coffee</span></a><a href="../src/plugin.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">plugin.coffee</span></a><a href="../src/plugins/bookingplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">bookingplugin.coffee</span></a><a href="../src/plugins/businessplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">businessplugin.coffee</span></a><a href="../src/plugins/dbpediainfofortv.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">dbpediainfofortv.coffee</span></a><a href="../src/plugins/dbpediainfoplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">dbpediainfoplugin.coffee</span></a><a href="../src/plugins/geonamesfortvplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">geonamesfortvplugin.coffee</span></a><a href="../src/plugins/geonamesmapplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">geonamesmapplugin.coffee</span></a><a href="../src/plugins/googleweatherplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">googleweatherplugin.coffee</span></a><a href="../src/plugins/help.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">help.coffee</span></a><a href="../src/plugins/ldplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">ldplugin.coffee</span></a><a href="../src/plugins/lsiimageplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">lsiimageplugin.coffee</span></a><a href="../src/plugins/lsivideoplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">lsivideoplugin.coffee</span></a><a href="../src/plugins/mediaplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">mediaplugin.coffee</span></a><a href="../src/plugins/objectplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">objectplugin.coffee</span></a><a href="../src/plugins/tvplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">tvplugin.coffee</span></a><a href="../src/plugins/videoplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">videoplugin.coffee</span></a><a href="../src/plugins/youtubeplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">youtubeplugin.coffee</span></a><a href="../src/settings/admin.coffee.html" class="source "><span class="base_path">src / settings / </span><span class="file_name">admin.coffee</span></a><a href="../src/settings/statistics.coffee.html" class="source "><span class="base_path">src / settings / </span><span class="file_name">statistics.coffee</span></a><a href="../src/settings/usersettings.coffee.html" class="source "><span class="base_path">src / settings / </span><span class="file_name">usersettings.coffee</span></a><a href="../src/videojs-adapter.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">videojs-adapter.coffee</span></a><a href="../src/widget.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">widget.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>cmf.coffee</h1><div class="filepath">src/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><p>The CMF module communicates to the ConnectMe Media Framework (CMF) back-end</p>

<p>Usage of all methods:
var cmf = new CMF("http://connectme.salzburgresearch.at/CMF");
cmf.getVideos(function(err, videos){ // The callback gets always two parameters: err, result.
  if(err){
    console.error("Error getting video list from the back-end", cmf.url);
    return;
  }
  console.info("Videos succesfully loaded:", videos);
});</p>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">CMF</span>
  <span class="nv">constructor: </span><span class="nf">(@url) -&gt;</span>
    <span class="vi">@url = </span><span class="nx">@url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/$/</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Get the list of all videos stored on the CMF server</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getVideos: </span><span class="nf">(resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">query = </span><span class="nx">@_videosQuery</span>
    <span class="nx">@_runSPARQL</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">resCB</span><span class="p">)</span>
  <span class="nv">_videosQuery: </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      PREFIX mao: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">      PREFIX oac: &lt;http://www.openannotation.org/ns/&gt;</span>
<span class="s">      PREFIX yoovis: &lt;http://yoovis.at/ontology/08/2012/&gt;</span>
<span class="s">      SELECT DISTINCT ?instance ?title ?thumbnail</span>
<span class="s">      WHERE {</span>
<span class="s">        ?instance a mao:MediaResource.</span>
<span class="s">        OPTIONAL {?instance mao:title ?title.}</span>
<span class="s">        ?instance yoovis:hasThumbnail ?thumbnail.</span>
<span class="s">      }</span>
<span class="s">      ORDER BY ?instance&quot;&quot;&quot;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Get the list of all annotated videos stored on the CMF server</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getAnnotatedVideos: </span><span class="nf">(resCB) -&gt;</span>
    <span class="nv">query = </span><span class="nx">@_annotatedVideosQuery</span>
    <span class="k">return</span> <span class="nx">@_runSPARQL</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">resCB</span><span class="p">)</span>
  <span class="nv">_annotatedVideosQuery: </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    PREFIX mao: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    PREFIX oac: &lt;http://www.openannotation.org/ns/&gt;</span>
<span class="s">    PREFIX yoovis: &lt;http://yoovis.at/ontology/08/2012/&gt;</span>
<span class="s">    SELECT DISTINCT ?instance ?title ?thumbnail</span>
<span class="s">    WHERE {</span>
<span class="s">      ?instance a mao:MediaResource.</span>
<span class="s">      OPTIONAL {?instance mao:title ?title.}</span>
<span class="s">      ?instance mao:hasFragment ?fragment.</span>
<span class="s">      OPTIONAL {?instance yoovis:hasThumbnail ?thumbnail.}</span>
<span class="s">      ?annotation a oac:Annotation.</span>
<span class="s">      ?annotation oac:hasTarget ?fragment.</span>
<span class="s">      ?annotation oac:hasBody ?body</span>
<span class="s">    }</span>
<span class="s">    ORDER BY ASC(?title)&quot;&quot;&quot;</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Wrapper for both <code>getAnnotationsForLocator</code> and <code>getAnnotationsForVideo</code></p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getAnnotationsForVideoOrLocator: </span><span class="nf">(url, resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">waitfor = </span><span class="mi">2</span>
    <span class="nv">cb = </span><span class="nf">(err, annotations) -&gt;</span>
      <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span>
        <span class="nx">resCB</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span>
        <span class="k">return</span>
      <span class="nv">res = </span><span class="nx">res</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">annotations</span>
      <span class="nx">waitfor</span><span class="o">--</span>
      <span class="k">if</span> <span class="nx">waitfor</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nx">resCB</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">res</span>

    <span class="nx">@getAnnotationsForLocator</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">cb</span>
    <span class="nx">@getAnnotationsForVideo</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">cb</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Wrapper for both <code>getVideoLocators</code> and <code>getAllVideoLocators</code></p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getLocatorsForVideoOrLocator: </span><span class="nf">(url, resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">waitfor = </span><span class="mi">2</span>
    <span class="nv">cb = </span><span class="nf">(err, annotations) -&gt;</span>
      <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span>
        <span class="nx">resCB</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span>
        <span class="k">return</span>
      <span class="nv">res = </span><span class="nx">res</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">annotations</span>
      <span class="nx">waitfor</span><span class="o">--</span>
      <span class="k">if</span> <span class="nx">waitfor</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nx">resCB</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">res</span>

    <span class="nx">@getVideoLocators</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">cb</span>
    <span class="nx">@getAllVideoLocators</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">cb</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>The use of the rest of the methods is not necessary because all functionalities are
covered and generalized by the more convenient methods above</p>

<hr />
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Get annotations for a video's CMF resource uri</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getAnnotationsForVideo: </span><span class="nf">(resource, resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">query = </span><span class="nx">@_annotationsForVideo</span><span class="p">(</span><span class="nx">resource</span><span class="p">)</span>
    <span class="nx">@_runSPARQL</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">resCB</span><span class="p">)</span>
  <span class="nv">_annotationsForVideo: </span><span class="nf">(resource) -&gt;</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    PREFIX oac: &lt;http://www.openannotation.org/ns/&gt;</span>
<span class="s">    PREFIX mao: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    PREFIX cma: &lt;http://connectme.at/ontology</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    PREFIX geo: &lt;http://www.w3.org/2003/01/geo/wgs84_pos</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    SELECT DISTINCT ?annotation ?fragment ?resource ?relation ?type ?prefLabel ?latitude ?longitude</span>
<span class="s">    WHERE {</span>
<span class="s">    &lt;</span><span class="si">#{</span><span class="nx">resource</span><span class="si">}</span><span class="s">&gt;  mao:hasFragment ?f.</span>
<span class="s">    ?f mao:locator ?fragment.</span>
<span class="s">    ?annotation oac:hasTarget ?f.</span>
<span class="s">    ?annotation a ?type.</span>
<span class="s">    OPTIONAL{?annotation cma:preferredLabel ?prefLabel.}</span>
<span class="s">    OPTIONAL{?resource geo:lat ?latitude.}</span>
<span class="s">    OPTIONAL{?resource geo:long ?longitude.}</span>
<span class="s">    ?annotation oac:hasBody ?resource.</span>
<span class="s">    ?f ?relation ?resource.</span>
<span class="s">    }</span>
<span class="s">  &quot;&quot;&quot;</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Get annotations for a video's locator uri</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getAnnotationsForLocator: </span><span class="nf">(locator, resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">query = </span><span class="nx">@_annotationsForLocator</span><span class="p">(</span><span class="nx">locator</span><span class="p">)</span>
    <span class="nx">@_runSPARQL</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">resCB</span><span class="p">)</span>
  <span class="nv">_annotationsForLocator: </span><span class="nf">(locator) -&gt;</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    PREFIX oac: &lt;http://www.openannotation.org/ns/&gt;</span>
<span class="s">    PREFIX mao: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    PREFIX cma: &lt;http://connectme.at/ontology</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    SELECT DISTINCT ?annotation ?fragment ?resource ?relation ?type ?prefLabel</span>
<span class="s">    WHERE {</span>
<span class="s">      ?videoresource mao:locator &lt;</span><span class="si">#{</span><span class="nx">locator</span><span class="si">}</span><span class="s">&gt;.</span>
<span class="s">      ?videoresource mao:hasFragment ?f.</span>
<span class="s">      ?f mao:locator ?fragment.</span>
<span class="s">      ?annotation oac:hasTarget ?f.</span>
<span class="s">      ?annotation oac:hasBody ?resource.</span>
<span class="s">      ?annotation a ?type.</span>
<span class="s">      OPTIONAL{?annotation cma:preferredLabel ?prefLabel.}</span>
<span class="s">      ?f ?relation ?resource.</span>
<span class="s">    }&quot;&quot;&quot;</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Get video locators for a video's CMF resource uri</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getVideoLocators: </span><span class="nf">(resource, resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">query = </span><span class="nx">@_getVideoLocators</span><span class="p">(</span><span class="nx">resource</span><span class="p">)</span>
    <span class="nx">@_runSPARQL</span> <span class="nx">query</span><span class="p">,</span> <span class="nf">(err, res) -&gt;</span>
      <span class="nx">unless</span> <span class="nx">err</span>
        <span class="nv">typeRegexp = </span><span class="k">new</span> <span class="nb">RegExp</span> <span class="o">/</span><span class="err">\</span><span class="p">.(.{</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">})</span><span class="nx">$</span><span class="o">/</span>
        <span class="nv">locators = </span><span class="nx">_</span><span class="p">(</span><span class="nx">res</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(l) -&gt;</span>
          <span class="k">if</span> <span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;&lt;crid&quot;</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">0</span>
            <span class="nv">type = </span><span class="nx">l</span><span class="p">.</span><span class="nx">type</span><span class="o">?</span><span class="p">.</span><span class="nx">value</span> <span class="o">or</span> <span class="s">&quot;video/</span><span class="si">#{</span> <span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">typeRegexp</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="si">}</span><span class="s">&quot;</span>
            <span class="k">return</span> <span class="nv">source: </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nv">type: </span><span class="nx">type</span>

      <span class="nx">resCB</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">locators</span>
  <span class="nv">_getVideoLocators: </span><span class="nf">(resource) -&gt;</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    PREFIX oac: &lt;http://www.openannotation.org/ns/&gt;</span>
<span class="s">    PREFIX mao: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    SELECT DISTINCT ?source ?type</span>
<span class="s">    WHERE {</span>
<span class="s">      &lt;</span><span class="si">#{</span><span class="nx">resource</span><span class="si">}</span><span class="s">&gt;  mao:locator ?source.</span>
<span class="s">      OPTIONAL {?source mao:hasFormat ?type}</span>
<span class="s">      FILTER regex(str(?source), &quot;(http|https)&quot;)</span>
<span class="s">    }</span>
<span class="s">    ORDER BY ?source&quot;&quot;&quot;</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Get all video locators for any of a video's locators</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getAllVideoLocators: </span><span class="nf">(locator, resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">query = </span><span class="nx">@_getAllVideoLocators</span> <span class="nx">locator</span>
    <span class="nx">@_runSPARQL</span> <span class="nx">query</span><span class="p">,</span> <span class="nf">(err, res) -&gt;</span>
      <span class="nx">unless</span> <span class="nx">err</span>
        <span class="nv">typeRegexp = </span><span class="k">new</span> <span class="nb">RegExp</span> <span class="o">/</span><span class="err">\</span><span class="p">.(.{</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">})</span><span class="nx">$</span><span class="o">/</span>
        <span class="nv">locators = </span><span class="nx">_</span><span class="p">(</span><span class="nx">res</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(l) -&gt;</span>
          <span class="k">if</span> <span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;crid&quot;</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">0</span>
            <span class="nv">type = </span><span class="nx">l</span><span class="p">.</span><span class="nx">type</span><span class="o">?</span><span class="p">.</span><span class="nx">value</span> <span class="o">or</span> <span class="s">&quot;video/</span><span class="si">#{</span> <span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">typeRegexp</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="si">}</span><span class="s">&quot;</span>
            <span class="k">return</span> <span class="nv">source: </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nv">type: </span><span class="nx">type</span>
      <span class="nx">resCB</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">locators</span>
  <span class="nv">_getAllVideoLocators: </span><span class="nf">(locator) -&gt;</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    PREFIX oac: &lt;http://www.openannotation.org/ns/&gt;</span>
<span class="s">    PREFIX mao: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    SELECT DISTINCT ?source ?type</span>
<span class="s">    WHERE {</span>
<span class="s">      ?resource mao:locator &lt;</span><span class="si">#{</span><span class="nx">locator</span><span class="si">}</span><span class="s">&gt;.</span>
<span class="s">      ?resource  mao:locator ?source.</span>
<span class="s">      OPTIONAL {?source mao:hasFormat ?type}</span>
<span class="s">      FILTER regex(str(?source), &quot;(http|https)&quot;)</span>
<span class="s">    }</span>
<span class="s">    ORDER BY ?source&quot;&quot;&quot;</span>

  <span class="nv">getLSIVideosForTerm: </span><span class="nf">(keywordUri, resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">query = </span><span class="nx">@_getLSIVideosForTerm</span> <span class="nx">keywordUri</span>
    <span class="nx">@_runSPARQL</span> <span class="nx">query</span><span class="p">,</span> <span class="nf">(err, res) -&gt;</span>
      <span class="nx">resCB</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span>

  <span class="nv">_getLSIVideosForTerm: </span><span class="nf">(keywordUri) -&gt;</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    PREFIX mao: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;</span>
<span class="s">    SELECT DISTINCT ?video ?duration ?description ?locator ?title ?img</span>
<span class="s">    WHERE {</span>
<span class="s">      ?video mao:hasKeyword &lt;</span><span class="si">#{</span><span class="nx">keywordUri</span><span class="si">}</span><span class="s">&gt; .</span>
<span class="s">      ?video a &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">VideoTrack&gt; .</span>
<span class="s">      OPTIONAL {?video mao:description ?description}.</span>
<span class="s">      ?video mao:locator ?locator .</span>
<span class="s">      OPTIONAL {?video mao:duration ?duration}.</span>
<span class="s">      ?video mao:title ?title .</span>
<span class="s">      OPTIONAL {?video foaf:img ?img}.</span>
<span class="s">    }</span>
<span class="s">    ORDER BY ?video &quot;&quot;&quot;</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">_getLSIVideosForTerm: </span><span class="nf">(keywordUri) -&gt;</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    PREFIX mao: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;</span>
<span class="s">    SELECT DISTINCT ?video ?duration ?description ?locator ?title ?img</span>
<span class="s">    WHERE {</span>
<span class="s">      ?s &lt;http://connectme.at/ontology</span><span class="err">#</span><span class="s">hasRelatedVideo&gt; ?video .</span>
<span class="s">      ?s &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">hasKeyword&gt; &lt;</span><span class="si">#{</span><span class="nx">keywordUri</span><span class="si">}</span><span class="s">&gt; .</span>
<span class="s">      OPTIONAL {?video mao:description ?description}.</span>
<span class="s">      ?video mao:locator ?locator .</span>
<span class="s">      ?video mao:duration ?duration.</span>
<span class="s">      ?video mao:title ?title .</span>
<span class="s">      OPTIONAL {?video foaf:img ?img}.</span>
<span class="s">    }</span>
<span class="s">    ORDER BY ?video  &quot;&quot;&quot;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><h1>#</h1>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getLSIImagesForTerm: </span><span class="nf">(keywordUri, resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">query = </span><span class="nx">@_getLSIImagesForTerm</span> <span class="nx">keywordUri</span>
    <span class="nx">@_runSPARQL</span> <span class="nx">query</span><span class="p">,</span> <span class="nf">(err, res) -&gt;</span>
      <span class="nx">resCB</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span>

  <span class="nv">_getLSIImagesForTerm: </span><span class="nf">(keywordUri) -&gt;</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    PREFIX mao: &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">    SELECT DISTINCT ?image</span>
<span class="s">    WHERE {</span>
<span class="s">      ?image a &lt;http://www.w3.org/ns/ma-ont</span><span class="err">#</span><span class="s">Image&gt; .</span>
<span class="s">      ?image mao:hasKeyword &lt;</span><span class="si">#{</span><span class="nx">keywordUri</span><span class="si">}</span><span class="s">&gt; .</span>
<span class="s">    }</span>
<span class="s">    ORDER BY ?image &quot;&quot;&quot;</span>

  <span class="nv">getGRDataForTerm: </span><span class="nf">(keywordUri, resCB) -&gt;</span>
    <span class="nv">res = </span><span class="p">[]</span>
    <span class="nv">query = </span><span class="nx">@_getGRDataForTerm</span> <span class="nx">keywordUri</span>
    <span class="nx">@_runSPARQL</span> <span class="nx">query</span><span class="p">,</span> <span class="nf">(err, res) -&gt;</span>
      <span class="nx">resCB</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span>

  <span class="nv">_getGRDataForTerm: </span><span class="nf">(keywordUri) -&gt;</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">                                        PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">                                        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">                                        PREFIX gr: &lt;http://purl.org/goodrelations/v1</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">                                        PREFIX vCard: &lt;http://www.w3.org/2001/vcard-rdf/3.0</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">                                        PREFIX geo: &lt;http://www.w3.org/2003/01/geo/wgs84_pos</span><span class="err">#</span><span class="s">&gt;</span>
<span class="s">                                        SELECT DISTINCT ?name ?street ?pcode ?city ?country ?telephone ?email ?description ?geoLat ?geoLong ?pricevalue ?pricecurrency ?product</span>
<span class="s">                                        WHERE {</span>
<span class="s">                                        &lt;</span><span class="si">#{</span><span class="nx">keywordUri</span><span class="si">}</span><span class="s">&gt; gr:legalName ?name.</span>
<span class="s">                                        &lt;</span><span class="si">#{</span><span class="nx">keywordUri</span><span class="si">}</span><span class="s">&gt; vCard:ADR ?address.</span>
<span class="s">                                        ?address vCard:Street ?street.</span>
<span class="s">                                        ?address vCard:Pcode ?pcode.</span>
<span class="s">                                        ?address vCard:City ?city.</span>
<span class="s">                                        ?address vCard:Country ?country.</span>
<span class="s">                                        ?address vCard:TEL ?tel.</span>
<span class="s">                                        &lt;</span><span class="si">#{</span><span class="nx">keywordUri</span><span class="si">}</span><span class="s">&gt; geo:lat ?geoLat.</span>
<span class="s">                                        &lt;</span><span class="si">#{</span><span class="nx">keywordUri</span><span class="si">}</span><span class="s">&gt; geo:long ?geoLong.</span>
<span class="s">                                        ?tel rdf:value ?telephone.</span>
<span class="s">                                        ?address vCard:EMAIL ?em.</span>
<span class="s">                                        ?em rdf:value ?email.</span>
<span class="s">                                        &lt;</span><span class="si">#{</span><span class="nx">keywordUri</span><span class="si">}</span><span class="s">&gt; gr:offers ?offer.</span>
<span class="s">                                        ?offer rdfs:comment ?description.</span>
<span class="s">                                        ?offer gr:hasPriceSpecification ?price.</span>
<span class="s">                                        ?price gr:hasCurrencyValue ?pricevalue.</span>
<span class="s">                                        ?price gr:hasCurrency ?pricecurrency.</span>
<span class="s">                                        ?price rdfs:comment ?product.</span>
<span class="s">                                        }</span>
<span class="s">                                        &quot;&quot;&quot;</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>running SPARQL query</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">_runSPARQL: </span><span class="nf">(query, resCB) -&gt;</span>
    <span class="nv">uri = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@url</span><span class="si">}</span><span class="s">sparql/select?query=</span><span class="si">#{</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span><span class="si">}</span><span class="s">&amp;output=json&quot;</span>
    <span class="nv">xhr = </span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">getJSON</span> <span class="nx">uri</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">res = </span><span class="p">[]</span>
      <span class="nv">list = </span><span class="nx">data</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">bindings</span>
      <span class="k">if</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">_</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">uniq</span><span class="p">().</span><span class="nx">length</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s">&#39;CMF DISTINCT is being ignored!&#39;</span><span class="p">,</span> <span class="nx">list</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span>
        <span class="nv">list = </span><span class="nx">_</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">uniq</span><span class="p">()</span>
      <span class="nx">resCB</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">list</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">error</span> <span class="nx">resCB</span>
    <span class="nx">xhr</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Testing all the methods above. See results in the console</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">test: </span><span class="o">-&gt;</span>
    <span class="nx">@getVideos</span> <span class="nf">(err, res) -&gt;</span>
      <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getVideos error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span>
        <span class="k">return</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getVideos result&quot;</span><span class="p">,</span> <span class="nx">res</span>

    <span class="nx">@getAnnotatedVideos</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getAnnotatedVideos error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span>
        <span class="k">return</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getAnnotatedVideos result&quot;</span><span class="p">,</span> <span class="nx">res</span>

      <span class="nv">firstVideo = </span><span class="nx">res</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">instance</span><span class="p">.</span><span class="nx">value</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Getting locators for&quot;</span><span class="p">,</span> <span class="nx">firstVideo</span>
      <span class="nx">@getVideoLocators</span> <span class="nx">firstVideo</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">err</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getVideoLocators error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span>
          <span class="k">return</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getVideoLocators result&quot;</span><span class="p">,</span> <span class="nx">res</span>
        <span class="nv">videolocator = </span><span class="nx">res</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">source</span>
        <span class="nx">@getAllVideoLocators</span> <span class="nx">videolocator</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="nx">err</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getAllVideoLocators error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span>
            <span class="k">return</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getAllVideoLocators result&quot;</span><span class="p">,</span> <span class="nx">res</span>
        <span class="nx">@getAnnotationsForLocator</span> <span class="nx">videolocator</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="nx">err</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getAnnotationsForLocator error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span>
            <span class="k">return</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getAnnotationsForLocator result&quot;</span><span class="p">,</span> <span class="nx">annotations</span>

        <span class="nx">@getLocatorsForVideoOrLocator</span> <span class="nx">firstVideo</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="nx">err</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getLocatorsForVideoOrLocator error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span>
            <span class="k">return</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getLocatorsForVideoOrLocator result&quot;</span><span class="p">,</span> <span class="nx">firstVideo</span><span class="p">,</span> <span class="nx">res</span>

        <span class="nx">@getLocatorsForVideoOrLocator</span> <span class="nx">videolocator</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="nx">err</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getLocatorsForVideoOrLocator error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span>
            <span class="k">return</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getLocatorsForVideoOrLocator result&quot;</span><span class="p">,</span> <span class="nx">videolocator</span><span class="p">,</span> <span class="nx">res</span>

        <span class="nx">@getAnnotationsForVideoOrLocator</span> <span class="nx">firstVideo</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="nx">err</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getAnnotationsForVideoOrLocator error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span>
            <span class="k">return</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getAnnotationsForVideoOrLocator result&quot;</span><span class="p">,</span> <span class="nx">firstVideo</span><span class="p">,</span> <span class="nx">annotations</span>

        <span class="nx">@getAnnotationsForVideoOrLocator</span> <span class="nx">videolocator</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="nx">err</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getAnnotationsForVideoOrLocator error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span>
            <span class="k">return</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getAnnotationsForVideoOrLocator result&quot;</span><span class="p">,</span> <span class="nx">videolocator</span><span class="p">,</span> <span class="nx">annotations</span>

      <span class="nx">@getAnnotationsForVideo</span> <span class="nx">firstVideo</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">err</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;getAnnotationsForVideo error&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">annotations</span>
          <span class="k">return</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;getAnnotationsForVideo result&quot;</span><span class="p">,</span> <span class="nx">annotations</span>

</pre></div></td></tr></tbody></table><div id="projectname"><a href="../index.html">LIME - Linked Media Player</a></div></div></body></html>