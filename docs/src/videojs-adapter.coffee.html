<!DOCTYPE html><html><head><title>videojs-adapter.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../src/annotation.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotation.coffee</span></a><a href="../src/annotationoverlays.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotationoverlays.coffee</span></a><a href="../src/cmf.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">cmf.coffee</span></a><a href="../src/jquery.scrollTo.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">jquery.scrollTo.coffee</span></a><a href="../src/lime.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">lime.coffee</span></a><a href="../src/plugin.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">plugin.coffee</span></a><a href="../src/plugins/actorplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">actorplugin.coffee</span></a><a href="../src/plugins/businessplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">businessplugin.coffee</span></a><a href="../src/plugins/characterplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">characterplugin.coffee</span></a><a href="../src/plugins/dbpediainfoplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">dbpediainfoplugin.coffee</span></a><a href="../src/plugins/directorplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">directorplugin.coffee</span></a><a href="../src/plugins/geonamesmapplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">geonamesmapplugin.coffee</span></a><a href="../src/plugins/googleweatherplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">googleweatherplugin.coffee</span></a><a href="../src/plugins/ldplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">ldplugin.coffee</span></a><a href="../src/plugins/ldplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">ldplugin.coffee</span></a><a href="../src/plugins/lsiimageplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">lsiimageplugin.coffee</span></a><a href="../src/plugins/lsivideoplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">lsivideoplugin.coffee</span></a><a href="../src/plugins/objectplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">objectplugin.coffee</span></a><a href="../src/plugins/tvplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">tvplugin.coffee</span></a><a href="../src/plugins/videoplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">videoplugin.coffee</span></a><a href="../src/plugins/youtubeplugin.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">youtubeplugin.coffee</span></a><a href="../src/videojs-adapter.coffee.html" class="source selected"><span class="base_path">src / </span><span class="file_name">videojs-adapter.coffee</span></a><a href="../src/widget.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">widget.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>videojs-adapter.coffee</h1><div class="filepath">src/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><p>When the Lime player gets instantiated, it calls the VideoPlayerInit method with the three parameters (domElement,
optionsHash, callback) and waits for the callback to be called with the instantiated video player.
The form of call is</p>

<pre><code> window.LIMEPlayer.VideoPlayerInit(domElement, optionsHash, function(err, playerObj){
   if(err){
     console.error('Error initializing player', err);
   } else {
     USE PLAYER OBJECT HERE.
   }
 })
</code></pre>
</td><td class="code"><div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">LIMEPlayer.VideoPlayerInit = </span><span class="nf">(el, options, cb) -&gt;</span>
  <span class="nx">unless</span> <span class="nx">_V_</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;VideoJS not loaded!&quot;</span>
    <span class="nx">cb</span> <span class="s">&quot;VideoJS not loaded&quot;</span>
    <span class="k">return</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Defer makes the instantiation asynchron and makes sure the previous rendering activities are finished.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span> <span class="o">=&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;1. Player initialisation&quot;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>We create the</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">player =</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>The player instance is the (could be even) hidden player instance that we wrap.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">instance: </span><span class="nx">_V_</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="p">{</span>
        <span class="nv">flash: iFrameMode: </span><span class="kc">true</span>
        <span class="nv">swf: </span><span class="s">&quot;lib/videojs/video-js.swf&quot;</span> <span class="c1"># SORIN - added to fix flash fallback bug</span>
      <span class="p">})</span>
      <span class="nv">isFullscreen: </span><span class="o">-&gt;</span>
        <span class="nx">@instance</span><span class="p">.</span><span class="nx">isFullScreen</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><h1>Methods:</h1>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>play()</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">play: </span><span class="o">-&gt;</span>
        <span class="nx">@instance</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>pause()</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">pause: </span><span class="o">-&gt;</span>
        <span class="nx">@instance</span><span class="p">.</span><span class="nx">pause</span><span class="p">()</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>getLength()</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">getLength: </span><span class="o">-&gt;</span>
        <span class="nx">@instance</span><span class="p">.</span><span class="nx">duration</span><span class="p">()</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>seek(pos)</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">seek: </span><span class="nf">(pos) -&gt;</span>
        <span class="k">if</span> <span class="nx">pos</span> <span class="o">isnt</span> <span class="kc">undefined</span>
          <span class="nx">@instance</span><span class="p">.</span><span class="nx">currentTime</span> <span class="nx">pos</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>currentTime()</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">currentTime: </span><span class="o">-&gt;</span>
        <span class="nx">@instance</span><span class="p">.</span><span class="nx">currentTime</span><span class="p">()</span>

      <span class="nv">currentSource: </span><span class="o">-&gt;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">currentSrc</span> <span class="o">or</span> <span class="nx">@instance</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">src</span> <span class="o">or</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s">&#39;source&#39;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">tag</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;src&#39;</span><span class="p">)</span>

      <span class="nv">paused: </span><span class="o">-&gt;</span>
        <span class="nx">@instance</span><span class="p">.</span><span class="nx">paused</span><span class="p">()</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>@player.addComponent 'Annotations', player: @player</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Listen to error event</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">addEvent</span> <span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">cb</span> <span class="nx">e</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Setting up the player instance</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">addEvent</span> <span class="s">&quot;loadedmetadata&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;3. Player.loadedmetadata&quot;</span>
      <span class="nv">player.instance.isFullScreen = </span><span class="nx">options</span><span class="p">.</span><span class="nx">fullscreen</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>player.videoOverlay is the DOM element over the entire video element</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">videoOverlay = </span><span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="s">&quot;VideoOverlay&quot;</span><span class="p">)</span>  <span class="c1"># add component to display 4 regions of annotations</span>
      <span class="nv">player.videoOverlay = </span><span class="nx">jQuery</span> <span class="nx">videoOverlay</span><span class="p">.</span><span class="nx">el</span>
      <span class="nx">player</span><span class="p">.</span><span class="nx">videoOverlay</span><span class="p">.</span><span class="nx">css</span>
        <span class="nv">height: </span><span class="s">&#39;100%&#39;</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>player.timelineOverlay is the DOM element over the timeline</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">timelineOverlay = </span><span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">controlBar</span><span class="p">.</span><span class="nx">progressControl</span><span class="p">.</span><span class="nx">addComponent</span> <span class="s">&quot;VideoOverlay&quot;</span>
      <span class="nv">player.timelineOverlay = </span><span class="nx">jQuery</span> <span class="nx">timelineOverlay</span><span class="p">.</span><span class="nx">el</span>
      <span class="nx">player</span><span class="p">.</span><span class="nx">timelineOverlay</span><span class="p">.</span><span class="nx">css</span>
        <span class="nv">position: </span><span class="s">&#39;absolute&#39;</span>
        <span class="nv">top: </span><span class="mi">0</span>
        <span class="nv">right: </span><span class="mi">0</span>
        <span class="nv">left: </span><span class="mi">0</span>
        <span class="nv">height: </span><span class="s">&#39;100%&#39;</span>
        <span class="nv">padding: </span><span class="mi">0</span>
        <span class="nv">margin: </span><span class="mi">0</span>
        <span class="nv">background: </span><span class="s">&#39;transparent&#39;</span>
        <span class="s">&#39;pointer-events&#39;</span><span class="o">:</span> <span class="s">&#39;none&#39;</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>player.buttonContainer is the DOM element in the button bar that can accomodate switch elements (eg show/hide annotations)</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">player.buttonContainer = </span><span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">controlBar</span><span class="p">.</span><span class="nx">el</span>
      <span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">controlBar</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="s">&quot;AnnotationToggle&quot;</span><span class="p">).</span><span class="nx">el</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><h1>Events</h1>

<p>timeupdate event</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">addEvent</span> <span class="s">&quot;timeupdate&quot;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
        <span class="nv">limeevent = </span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span> <span class="s">&quot;timeupdate&quot;</span><span class="p">,</span> <span class="nv">currentTime: </span><span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">currentTime</span><span class="p">()</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="nx">player</span><span class="p">).</span><span class="nx">trigger</span> <span class="nx">limeevent</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>fullscreenchange event</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">addEvent</span> <span class="s">&#39;fullscreenchange&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nv">fsce = </span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span> <span class="s">&#39;fullscreenchange&#39;</span><span class="p">,</span> <span class="nv">isFullScreen: </span><span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">isFullScreen</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="nx">player</span><span class="p">).</span><span class="nx">trigger</span> <span class="nx">fsce</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>play event</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">addEvent</span> <span class="s">&#39;play&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nv">playevent = </span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span> <span class="s">&#39;play&#39;</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="nx">player</span><span class="p">).</span><span class="nx">trigger</span> <span class="nx">playevent</span>

      <span class="nx">player</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
      <span class="nx">cb</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">player</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;2. Player instantiated.&quot;</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Prepare Components for video overlay, button</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">_V_.VideoOverlay = </span><span class="nx">_V_</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span> <span class="c1">#for  annotations on the sidebars</span>
    <span class="nv">options:</span>
      <span class="nv">loadEvent: </span><span class="s">&quot;play&quot;</span>

    <span class="nv">init: </span><span class="nf">(player, options) -&gt;</span>
      <span class="nx">@_super</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">options</span>

    <span class="nv">createElement: </span><span class="o">-&gt;</span>
      <span class="nv">el = </span><span class="nx">_V_</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&quot;div&quot;</span><span class="p">,</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>className: "spacial-annotation-overlays-wrapper"</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">className: </span><span class="s">&quot;lime-overlay&quot;</span>
        <span class="nv">style: </span><span class="s">&#39;border: 2px red solid&#39;</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>el.innerHTML = "&nbsp;"</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">el</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>ConnectME annotation toggler button that shows/hides the annotations on Fullscreen</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">_V_.AnnotationToggle = </span><span class="nx">_V_</span><span class="p">.</span><span class="nx">Button</span><span class="p">.</span><span class="nx">extend</span>
    <span class="nv">buttonText: </span><span class="s">&quot;Annotations On/Off&quot;</span>
    <span class="nv">buildCSSClass: </span><span class="o">-&gt;</span>
      <span class="s">&quot;vjs-annotationstoggler &quot;</span> <span class="o">+</span> <span class="nx">@_super</span><span class="p">()</span>

    <span class="nv">onClick: </span><span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">annotationsVisible</span> <span class="o">is</span> <span class="kc">false</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.vjs-annotationstoggler&quot;</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s">&quot;annotationstoggler-off&quot;</span>
        <span class="nv">LimePlayer.options.annotationsVisible = </span><span class="kc">true</span>
        <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationOverlaysComponent</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationOverlaysComponent</span>
        <span class="k">if</span> <span class="nx">@player</span><span class="p">.</span><span class="nx">isFullScreen</span> <span class="c1">#show Annotations sidebars</span>
          <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationsSidebars</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
        <span class="k">else</span> <span class="c1">#only show in fullscreen</span>
          <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationsSidebars</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
      <span class="k">else</span> <span class="c1">#toggle off Annotation overlays</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.vjs-annotationstoggler&quot;</span><span class="p">).</span><span class="nx">addClass</span> <span class="s">&quot;annotationstoggler-off&quot;</span>
        <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationsSidebars</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
        <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationOverlaysComponent</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">AnnotationOverlaysComponent</span>
        <span class="nv">LimePlayer.options.annotationsVisible = </span><span class="kc">false</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;fullscreen &quot;</span> <span class="o">+</span> <span class="nx">@player</span><span class="p">.</span><span class="nx">isFullScreen</span><span class="p">,</span> <span class="s">&quot;visible &quot;</span> <span class="o">+</span> <span class="nx">LimePlayer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">annotationsVisible</span>

</pre></div></td></tr></tbody></table><div id="projectname"><a href="../index.html">LIME - Linked Media Player</a></div></div></body></html>