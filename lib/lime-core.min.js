/* Lime Player 2.1.0 - Linked Media Player
by Szaby Gruenwald, Cristian Bara and the ConnectMe Project.
Available under the Apache License, Version 2.0
See http://connectme.sti2.org/ for more information.
*/function Utils(){}!function(){window.LIMEPlayer=function(){function a(a){var b,c,d=this;return b=new CMF("http://connectme.salzburgresearch.at/CMF"),c={containerDiv:"mainwrapper",videoPlayerSize:{width:640,height:360},preferredLanguage:"en",annotations:[],annotFrameworkURL:"http://connectme.salzburgresearch.at/CMF/",plugins:{TestPlugin:{}},pauseOnWidgetopen:!0,activeWidgetTypes:null,fullscreen:!1,widgetVisibility:"scrolling-list",hidingDelay:2e3,widgetContainers:[{element:jQuery("#widget-container-1"),options:null}],annotationsVisible:!0,debug:!1,local:!1,builtinPlugins:{AnnotationOverlays:{},LDPlugin:{}},widget:{}},this.options=jQuery.extend(c,a),this.el="string"==typeof this.options.containerDiv?jQuery("#"+this.options.containerDiv):jQuery(this.options.containerDiv),1!==this.el.length?(console.error("LIMEPlayer options.containerDiv has to be a DOM element or the ID of a DOM element.",this.options.containerDiv),void 0):(this.widgets=[],this.widgetContainers=this.options.widgetContainers,this.cmf=new CMF(this.options.annotFrameworkURL),this._initVideoPlayer(function(){return d._loadAnnotations(function(){return d._initPlugins(function(){return d._startScheduler()})})}),void 0)}return a.prototype._startScheduler=function(){var a=this;return jQuery(this).bind("timeupdate",function(b){var c,d,e,f,g,h,i;for(e=b.currentTime||a.player.currentTime(),d=a.player.currentSource(),h=a.annotations,i=[],f=0,g=h.length;g>f;f++)c=h[f],-1!==d.indexOf(a._getFilename(c.fragment.value))?("inactive"===c.state&&c.start<=e&&c.end+1>e&&(c.state="active",jQuery(c).trigger(jQuery.Event("becomeActive",{annotation:c}))),"active"===c.state&&(c.start>e||c.end+1<e)?(c.state="inactive",i.push(jQuery(c).trigger(jQuery.Event("becomeInactive",{annotation:c})))):i.push(void 0)):i.push(void 0);return i})},a.prototype._initVideoPlayer=function(a){var b,c,d,e,f,g,h=this;for(b="",g=this.options.video,c=e=0,f=g.length;f>e;c=++e)d=g[c],b+="<source src='"+d.source+"' type='"+d.type+"' />";return this.el.append("<div class='videowrapper' id='videowrapper'>\n  <video id='video_player' class='video-js vjs-default-skin' controls preload='metadata' width='"+this.options.videoPlayerSize.width+"' height='"+this.options.videoPlayerSize.height+"' poster='img/connectme-video-poster.jpg'>\n    "+b+"\n  </video>\n</div>"),this.videoEl=jQuery("video",this.el),console.info("Initializing the player"),window.LIMEPlayer.VideoPlayerInit(this.videoEl[0],{},function(b,c){return b?(console.info(b),void 0):(console.info("Player initialized"),h.player=c,h._initEventListeners(),h.fullscreenWidgetContainer=jQuery("<div class='fullscreen-annotation-wrapper'></div>"),h.player.videoOverlay.append(h.fullscreenWidgetContainer),a())})},a.prototype._initEventListeners=function(){var a=this;return jQuery(this.player).bind("timeupdate",function(){var b;return b=jQuery.Event("timeupdate",{currentTime:a.player.currentTime()}),jQuery(a).trigger(b)}),jQuery(this.player).bind("fullscreenchange",function(b){return a._moveWidgets(b.isFullScreen)}),this.initKeyEventsHandlers()},a.prototype.filterVisibleWidgets=function(a){var b,c,d,e,f,g;for(this.options.activeWidgetTypes=a,f=this.plugins,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(function(){var a,d,e,f;for(e=b.widgets,f=[],a=0,d=e.length;d>a;a++)c=e[a],c.isActive?f.push(this.options.widgetVisibility()):f.push(void 0);return f}.call(this));return g},a.prototype.getHiddenWidgetTypes=function(){return JSON.parse(localStorage.getItem("hiddenWidgetTypes"))||[]},a.prototype.updateDeactivatedWidgetStates=function(a){var b,c,d,e,f,g;for(f=this.widgets,g=[],d=0,e=f.length;e>d;d++)b=f[d],c=b.options.type,-1!==a.indexOf(c)?g.push(b.element.removeClass("deactivated")):g.push(b.element.addClass("deactivated"));return g},a.prototype.updateWidgetsList=_.throttle(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(g=_.sortBy(this.widgets,function(a){return a.options.sortBy()}),l=this.widgetContainers,m=[],h=0,j=l.length;j>h;h++){if(a=l[h],!jQuery(a).data().sorted){for(f=jQuery(a).find(".lime-widget"),g=_.sortBy(this.widgets,function(a){var b;return null!=(b=jQuery(a).data().widget)?b.options.sortBy():void 0}),i=0,k=g.length;k>i;i++)b=g[i],jQuery(a).prepend(b);jQuery(a).data("sorted",!0)}"scrolling-list"===this.options.widgetVisibility?(c=_.detect(jQuery(a.element).children(),function(a){var b;return b=jQuery(a).data().widget,null!=b?b.isActive():void 0}),c?(jQuery(c).parent().scrollTo(c),jQuery(".nav-selected").removeClass("nav-selected"),m.push(jQuery(c).addClass("nav-selected"))):m.push(void 0)):m.push(function(){var b,c,f,g;for(f=jQuery(a.element).children(),g=[],b=0,c=f.length;c>b;b++)e=f[b],d=jQuery(e).data().widget,d.isActive()?g.push(void 0):g.push(d.hide());return g}())}return m},100),a.prototype.initKeyEventsHandlers=function(){var a=this;return jQuery(window).keydown(function(b){var c,d;if(a.activeWidget){switch(c=null,b.keyCode){case 37:c=jQuery.Event("leftarrow");break;case 38:c=jQuery.Event("uparrow");break;case 39:c=jQuery.Event("rightarrow");break;case 40:c=jQuery.Event("downarrow");break;case 13:c=jQuery.Event("select");break;case 178:c=jQuery.Event("stop");break;case 179:case 32:c=jQuery.Event("playpause")}if(c&&jQuery(a.activeWidget).trigger(c),jQuery(a.activeWidget).trigger(b),27===b.keyCode&&(null!=(d=a.modalContainer)?d.is(":visible"):void 0))return history.pushState?history.back():a.modalContainer.trigger(jQuery.Event("close"))}}),this.claimKeyEvents(this),jQuery(window).bind("popstate",function(){var b;return(null!=(b=a.modalContainer)?b.is(":visible"):void 0)?a.modalContainer.trigger(jQuery.Event("close")):void 0}),jQuery(this).bind("downarrow",function(){var b,c,d,e,f;return console.info("lime is the active widget and down arrow was pressed"),c=jQuery(".lime-widget:not(.inactive)"),b=c.filter(".nav-selected"),f=c.length,d=c.index(b),e=f===d+1?0:d+1,b=jQuery(c[e]),a.navActivateWidget(b)}),jQuery(this).bind("uparrow",function(){var b,c,d,e,f;return console.info("lime is the active widget and up arrow was pressed",jQuery(".lime-widget:not(.inactive)")),c=jQuery(".lime-widget:not(.inactive)"),b=c.filter(".nav-selected"),f=c.length,d=c.index(b),e=0===d?f-1:d-1,b=jQuery(c[e]),a.navActivateWidget(b)}),jQuery(this).bind("select",function(){var a,b;return console.info("lime is the active widget and select was pressed",jQuery(".lime-widget:not(.inactive)")),b=jQuery(".lime-widget:not(.inactive)"),a=b.filter(".nav-selected"),a.trigger("click")}),jQuery(this).bind("playpause",function(){return a.player.paused()?a.player.play():a.player.pause()}),jQuery(this).bind("rightarrow",function(){var b,c,d;return b=a.player.currentTime(),d=_(a.annotations).filter(function(a){return a.start>b}),c=_(d).min(function(a){return a.start}),a.player.seek(c.start),jQuery(a.player).trigger("timeupdate")}),jQuery(this).bind("leftarrow",function(){var b,c,d;return b=a.player.currentTime(),d=_(a.annotations).filter(function(a){return a.start<b}),d.length?(c=_(d).max(function(a){return a.start}),a.player.seek(c.start)):a.player.seek(0),jQuery(a.player).trigger("timeupdate")})},a.prototype.claimKeyEvents=function(a){return this.activeWidget=a},a.prototype.navActivateWidget=function(a){return jQuery(".nav-selected").removeClass("nav-selected"),a.addClass("nav-selected")},a.prototype._isWidgetToBeShown=function(a){if(this.options.activeWidgetTypes&&!_(this.options.activeWidgetTypes).contains(a.options.type))return!1;switch(this.options.widgetVisibility){case"scrolling-list":return!0;case"active-only":case"delayed-hide":return a.isActive?!0:!1}},a.prototype._loadAnnotations=function(a){var b,c=this;return console.info("Loading annotations from LMF"),b=this.player.currentSource(),this.annotations=this.options.annotations,this.annotations=_.filter(this.options.annotations,function(a){return-1!==b.indexOf(c._getFilename(a.fragment.value))}),this.annotations=_.uniq(this.annotations,!1,function(a){return[a.hash.resource.value,a.hash.fragment.value,a.hash.annotation.value].join("")}),console.info("Relevant annotations:",this.annotations),a()},a.prototype._moveWidgets=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(console.log("fullscreen",a,", Visible "+LimePlayer.options.annotationsVisible),a&&LimePlayer.options.annotationsVisible)for(p=this.widgetContainers,f=0,j=p.length;j>f;f++){for(c=p[f],e=[],q=c.element.find(".lime-widget"),g=0,k=q.length;k>g;g++)d=q[g],e.push(d),this.fullscreenWidgetContainer.append(d);c.widgetList=e}else for(r=this.widgetContainers,h=0,l=r.length;l>h;h++){for(c=r[h],c.element.html(""),s=c.widgetList,i=0,m=s.length;m>i;i++)d=s[i],c.element.append(d);c.element.append("&nbsp;"),jQuery(c).data("widgetList",null)}for(t=LimePlayer.annotations,u=[],o=0,n=t.length;n>o;o++)b=t[o],"active"===b.state?u.push(jQuery(b).trigger(jQuery.Event("becomeActive",{annotation:b}))):u.push(void 0);return u},a.prototype._initPlugins=function(a){var b,c,d,e,f;this.plugins=[],e=this.options.builtinPlugins;for(d in e){c=e[d];try{this.plugins.push(new window[d](this,this.options[d]||{}))}catch(g){b=g,console.error("Error initializing "+d+" plugin",b)}}f=this.options.plugins;for(d in f){c=f[d];try{this.plugins.push(new window[d](this,c))}catch(g){b=g,console.error("Error initializing "+d+" plugin",b)}}return a()},a.prototype.allocateWidgetSpace=function(a,b){var c,d,e,f,g,h=this;return a instanceof window.LimePlugin||console.error("allocateWidgetSpace needs the first parameter to be the plugin itself requesting for the widget."),d=[],d=b&&a.options.preferredContainer&&this._hasFreeSpace(a.options.preferredContainer,b)?[a.options.preferredContainer]:_(this.widgetContainers).filter(function(a){return h._hasFreeSpace(a,b)}),d.length||(d=this.widgetContainers),d=_.sortBy(d,function(a){return a.element.children().length}),c=d[0],c.element&&(c=c.element),c.prepend("<div class='lime-widget'></div>"),e=jQuery(".lime-widget:first",c),f=_(this.options.widget).extend(b),g=new LimeWidget(a,e,f),"scrolling-list"===this.options.widgetVisibility&&this._isWidgetToBeShown(g)&&(g.render(),this.widgets.push(g),g.show(),g.setInactive(),-1!==this.getHiddenWidgetTypes().indexOf(b.type)&&g.element.addClass("deactivated"),this.updateWidgetsList()),g},a.prototype._hasFreeSpace=function(a){var b;return b=a.element.height(),b>0?!0:!1},a.prototype.play=function(){return this.player.play()},a.prototype.pause=function(){return this.player.pause()},a.prototype.seek=function(a){return this.player.seek(a)},a.prototype._getFilename=function(a){var b,c;return b=new RegExp(/\/([^\/#]*)(#.*)?$/),null!=(c=a.match(b))?c[1]:void 0},a}(),function(a){return a.fn.goTo=function(){return a(this).parent().scrollTo(this),this}}(jQuery)}.call(this),function(){var a;window.Annotation=function(){function b(b){var c,d,e,f,g,h,i,j,k,l=this;this.hash=b,b=this.hash,this._res=this.hash.resource.value,this._prefLabel=null!=(g=this.hash.prefLabel)?g.value:void 0,b.fragment.value=b.fragment.value.replace("?","#"),b.fragment.type="uri",this.annotation=b.annotation.value,this.start=0,this.end=-1,this.state="inactive",this.widgets={},jQuery(this).bind("mouseenter",function(){var a,b,c,d;c=l.widgets,d=[];for(b in c)a=c[b],d.push(jQuery(a).addClass("hover"));return d}),jQuery(this).bind("mouseleave",function(){var a,b,c,d;c=l.widgets,d=[];for(b in c)a=c[b],d.push(jQuery(a).removeClass("hover"));return d}),(b.fragment.type="uri")&&(this.fragment=new a(b.fragment.value),c=this.fragment.hash,e=c.match(/t=([0-9,]*)/),e&&(e=e[1],d=e.match(/([0-9]{1,})/g),d&&(this.start=Number(d[0]),this.end=Number(d[1])||-1)),f=c.match(/xywh=([a-z0-9,:]*)/),f&&(this.isPercent=-1!==f[1].indexOf("percent"),h=_(f[1].match(/([0-9]{1,})/g)).map(function(a){return Number(a)}),this.x=h[0],this.y=h[1],this.w=h[2],this.h=h[3])),this.isSpacial=void 0!==this.x||this.x===(k=this.y)&&k===(j=this.w)&&j===(i=this.h)&&0===i,this.resource=new a(b.resource.value),this.relation=new a(b.relation.value)}return b.prototype.toString=function(){return this.resource.value},b.prototype.isBookmark=function(){return"http://www.w3.org/ns/openannotation/extensions/Bookmark"===this.hash.type.value},b}(),a=function(){function a(a){var b;this.value=decodeURIComponent(a),b=a.match(/^.*?#([a-zA-Z0-9,&=:]*)$/),this.hash=b?b[1]:"",this.type="uri"}return a.prototype.toString=function(){return this.value},a}()}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};window.LimePlugin=function(){function a(a,b){this.lime=a,this.options=jQuery.extend({},this.defaults,b),this.init()}return a.prototype.defaults={preferredContainer:null},a.prototype.widgets=[],a.prototype.init=function(){return console.error("All Lime plugins have to implement the init method!")},a.prototype.getModalContainer=function(){var a,b,c,d,e,f,g=this;return d=this.lime.modalContainer,a=this.lime.modalMask,d||(this.lime.player.isFullscreen()?(this.lime.player.videoOverlay.append('<!-- Mask to cover the whole screen --><div id="mask"></div>'),this.lime.modalMask=jQuery("#mask"),this.lime.player.videoOverlay.append('<div class="modal-container"></div>'),this.lime.modalContainer=jQuery(".modal-container",this.lime.player.videoOverlay)):(jQuery("body").append('<!-- Mask to cover the whole screen --><div id="mask"></div>'),this.lime.modalMask=jQuery("#mask"),jQuery("body").append('<div class="modal-container"></div>'),this.lime.modalContainer=jQuery("body .modal-container")),d=this.lime.modalContainer,a=this.lime.modalMask,jQuery(d).bind("close",function(){return a.hide(),d.hide(),d.empty(),g.lime.claimKeyEvents(g.lime)}),a.click(function(){return a.hide(),d.hide(),d.empty(),g.lime.claimKeyEvents(g.lime)}),jQuery(this.lime.player).bind("fullscreenchange",function(b){return b.isFullScreen?(g.lime.player.videoOverlay.append(a),g.lime.player.videoOverlay.append(d)):(jQuery("body").append(a),jQuery("body").append(d))})),a=jQuery("#mask"),d.empty(),d.show(),a.show(),d.append('<div style="height: 22px; width: 100%; position: relative; margin: 0 auto; background: black;"> <a href="#" class="close" role="button"><img src="img/close-icon.png" style="width: 22px; height: 22px;"/></a></div>'),d.append('<div class="modalContent" style="height: 98%; width: 100%; position: relative; margin: 0 auto;">'),d.append("</div>"),b=jQuery(window).height(),c=jQuery(window).width(),a.css({width:c,height:b}),a.fadeIn(100),a.fadeTo("fast",.8),e=jQuery(window).height(),f=jQuery(window).width(),d.css("top",jQuery("#header").height()),d.css("right",jQuery("#widget-container-2").width()),d.fadeIn(100),jQuery(".close",d).click(function(b){return b.preventDefault(),a.hide(),d.hide(),d.empty(),g.lime.claimKeyEvents(g.lime)}),jQuery(window).resize(function(){return b=jQuery(document).height(),c=jQuery(document).width(),a.css({width:c,height:b}),e=jQuery(window).height(),f=jQuery(window).width(),d.css("top",jQuery("#header").height()),d.css("right",jQuery("#widget-container-2").width()),d.css("width","auto"),d.css("height","auto")}),jQuery(".modalContent",d)},a}(),window.TestPlugin=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.init=function(){var a,b,c,d,e;for(this.name="TestPlugin",console.info("Initialize "+this.name),d=this.lime.annotations,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.handleAnnotation(a));return e},d.prototype.handleAnnotation=function(a){var b=this;return a.entityPromise.done(function(){var c;return c=b.lime.allocateWidgetSpace(b,{thumbnail:"img/info.png",title:""+a.getLabel()+" Info",type:"TestWidget",sortBy:function(){return 1e4*a.start+a.end}}),c.annotation=a,jQuery(c).bind("activate",function(){return b.getModalContainer().html(b.renderAnnotation(a))}),a.widgets[b.name]=c,jQuery(a).bind("becomeActive",function(){return a.widgets[b.name].setActive()}),jQuery(a).bind("becomeInactive",function(){return a.widgets[b.name].setInactive()})})},d.prototype.renderAnnotation=function(a){var b,c,d,e;return e=a.entity,c=a.getLabel(),b=a.getDepiction(),d=a.getPage(),'<p>\n<a href="'+d+'" target="_blank">'+c+'</a>\n</p>\n<p>\n<img src="'+b+'" width="200"/>\n</p>'},d}(window.LimePlugin)}.call(this),function(){window.LimeWidget=function(){function a(a,b,c){var d;this.plugin=a,this.element=b,this.lime=this.plugin.lime,d={type:"defaultwidget"},this.options=_(d).extend(this.options,c),this._init()}return a.prototype.render=function(){var a,b,c,d,e,f=this;for(this.element.html('<div class="'+this.options.type+'">\n  <table style="margin:0 auto; width: 100%;">\n    <tr>\n      <td style="width: 45px; background-color: rgb(0, 0, 0);"><img class="utility-icon" src="'+this.options.thumbnail+'" style="width: 45px; height: 27px;" ></td>\n      <td><span class="utility-text">'+this.options.title+"</span></td>\n    </tr>\n  </table>\n</div>"),jQuery(this.element).parent().data("sorted",!1),jQuery(this.element).data("widget",this),jQuery(this.element).data("plugin",this.plugin),jQuery(this.element).click(function(a){var b,c,d,e;return d=jQuery(a.currentTarget).data().widget,b=jQuery(a.currentTarget).data().plugin,d.isActive()?(f.lime.options.pauseOnWidgetopen&&f.plugin.lime.pause(),jQuery(f).trigger("activate",{plugin:b,widget:d}),c=f.lime.player.currentTime(),"function"==typeof history.pushState&&history.pushState({annotation:null!=(e=d.annotation)?e.hash.annotation.value:void 0,widgetType:d.options.type,time:c},"state123","#time="+c+"&widgetType="+d.options.type),f.lime.claimKeyEvents(d)):(b.lime.player.seek(d.annotation.start),f.lime.options.pauseOnWidgetopen&&b.lime.player.play()),b.lime.navActivateWidget(d.element)}),a=function(a,b){return f[b]=function(){return a[b].call(a,arguments)}},e=["addClass","html","removeClass"],c=0,d=e.length;d>c;c++)b=e[c],a(this.element,b);return this.isRendered=!0},a.prototype.html=function(a){return this.element.html(a)},a.prototype.options={showSpeed:500,label:"Default label"},a.prototype._init=function(){return this.state="hidden"},a.prototype.show=function(){return this.element.slideDown(this.options.showSpeed),this.state="visible"},a.prototype.hide=function(){return this.element.slideUp(this.options.showSpeed)},a.prototype.setActive=function(){return this.isRendered||this.render(),this.show(),this.state="active",this.element.find(".utility-icon").attr("src",this.options.thumbnail),this.element.removeClass("inactive"),this.element.parent().prepend(this.element),this.lime.updateWidgetsList()},a.prototype.setInactive=function(){var a;return this.state="inactive",a=this.options.thumbnail.replace(".png",""),this.element.find(".utility-icon").attr("src",a+"_gr.png"),this.element.addClass("inactive"),this.lime.updateWidgetsList()},a.prototype.isActive=function(){return"active"===this.state},a}()}.call(this),function(){window.LIMEPlayer.VideoPlayerInit=function(a,b,c){return _V_?(_.defer(function(){var d;return console.info("1. Player initialisation"),d={instance:_V_(a,{flash:{iFrameMode:!0},swf:"lib/videojs/video-js.swf"}),isFullscreen:function(){return this.instance.isFullScreen},play:function(){return this.instance.play()},pause:function(){return this.instance.pause()},getLength:function(){return this.instance.duration()},seek:function(a){return void 0!==a?this.instance.currentTime(a):void 0},currentTime:function(){return this.instance.currentTime()},currentSource:function(){return this.instance.tag.currentSrc||this.instance.tag.src||jQuery("source",this.instance.tag).attr("src")},paused:function(){return this.instance.paused()}},d.instance.addEvent("error",function(a){return c(a)}),d.instance.addEvent("loadedmetadata",function(){var a,e;return console.info("3. Player.loadedmetadata"),d.instance.isFullScreen=b.fullscreen,e=d.instance.addComponent("VideoOverlay"),d.videoOverlay=jQuery(e.el),d.videoOverlay.css({height:"100%"}),a=d.instance.controlBar.progressControl.addComponent("VideoOverlay"),d.timelineOverlay=jQuery(a.el),d.timelineOverlay.css({position:"absolute",top:0,right:0,left:0,height:"100%",padding:0,margin:0,background:"transparent","pointer-events":"none"}),d.buttonContainer=d.instance.controlBar.el,d.instance.controlBar.addComponent("AnnotationToggle").el,d.instance.addEvent("timeupdate",function(){var a;return a=jQuery.Event("timeupdate",{currentTime:d.instance.currentTime()}),jQuery(d).trigger(a)}),d.instance.addEvent("fullscreenchange",function(){var a;return a=jQuery.Event("fullscreenchange",{isFullScreen:d.instance.isFullScreen}),jQuery(d).trigger(a)}),d.instance.addEvent("play",function(){var a;return a=jQuery.Event("play"),jQuery(d).trigger(a)}),d.instance.play(),c(null,d)}),console.info("2. Player instantiated.")}),_V_.VideoOverlay=_V_.Component.extend({options:{loadEvent:"play"},init:function(a,b){return this._super(a,b)},createElement:function(){return a=_V_.createElement("div",{className:"lime-overlay"})}}),_V_.AnnotationToggle=_V_.Button.extend({buttonText:"Annotations On/Off",buildCSSClass:function(){return"vjs-annotationstoggler "+this._super()},onClick:function(){return LimePlayer.options.annotationsVisible===!1?(jQuery(".vjs-annotationstoggler").removeClass("annotationstoggler-off"),LimePlayer.options.annotationsVisible=!0,LimePlayer.player.AnnotationOverlaysComponent&&LimePlayer.player.AnnotationOverlaysComponent.show(),this.player.isFullScreen?LimePlayer.player.AnnotationsSidebars.show():LimePlayer.player.AnnotationsSidebars.hide()):(jQuery(".vjs-annotationstoggler").addClass("annotationstoggler-off"),LimePlayer.player.AnnotationsSidebars.hide(),LimePlayer.player.AnnotationOverlaysComponent&&LimePlayer.player.AnnotationOverlaysComponent.hide(),LimePlayer.options.annotationsVisible=!1),console.log("fullscreen "+this.player.isFullScreen,"visible "+LimePlayer.options.annotationsVisible)}})):(console.error("VideoJS not loaded!"),c("VideoJS not loaded"),void 0)}}.call(this),function(){window.CMF=function(){function a(a){this.url=a,this.url=this.url.replace(/\/$/,"")+"/"}return a.prototype.getVideos=function(a){var b,c;return c=[],b=this._videosQuery,this._runSPARQL(b,a)},a.prototype._videosQuery="PREFIX mao: <http://www.w3.org/ns/ma-ont#>\nPREFIX oac: <http://www.openannotation.org/ns/>\nPREFIX yoovis: <http://yoovis.at/ontology/08/2012/>\nSELECT DISTINCT ?instance ?title ?thumbnail\nWHERE {\n  ?instance a mao:MediaResource.\n  OPTIONAL {?instance mao:title ?title.}\n  ?instance yoovis:hasThumbnail ?thumbnail.\n}\nORDER BY ?instance",a.prototype.getAnnotatedVideos=function(a){var b;return b=this._annotatedVideosQuery,this._runSPARQL(b,a)},a.prototype._annotatedVideosQuery="PREFIX mao: <http://www.w3.org/ns/ma-ont#>\nPREFIX oac: <http://www.openannotation.org/ns/>\nPREFIX yoovis: <http://yoovis.at/ontology/08/2012/>\nSELECT DISTINCT ?instance ?title ?thumbnail\nWHERE {\n  ?instance a mao:MediaResource.\n  OPTIONAL {?instance mao:title ?title.}\n  ?instance mao:hasFragment ?fragment.\n  OPTIONAL {?instance yoovis:hasThumbnail ?thumbnail.}\n  ?annotation a oac:Annotation.\n  ?annotation oac:hasTarget ?fragment.\n  ?annotation oac:hasBody ?body\n}\nORDER BY ASC(?title)",a.prototype.getAnnotationsForVideoOrLocator=function(a,b){var c,d,e;return d=[],e=2,c=function(a,c){return a?(console.error(a,c),b(a,c),void 0):(d=d.concat(c),e--,0===e?b(null,d):void 0)},this.getAnnotationsForLocator(a,c),this.getAnnotationsForVideo(a,c)},a.prototype.getLocatorsForVideoOrLocator=function(a,b){var c,d,e;return d=[],e=2,c=function(a,c){return a?(console.error(a,c),b(a,c),void 0):(d=d.concat(c),e--,0===e?b(null,d):void 0)},this.getVideoLocators(a,c),this.getAllVideoLocators(a,c)},a.prototype.getAnnotationsForVideo=function(a,b){var c,d;return d=[],c=this._annotationsForVideo(a),this._runSPARQL(c,b)},a.prototype._annotationsForVideo=function(a){return"PREFIX oac: <http://www.openannotation.org/ns/>\nPREFIX mao: <http://www.w3.org/ns/ma-ont#>\nPREFIX cma: <http://connectme.at/ontology#>\nPREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>\nSELECT DISTINCT ?annotation ?fragment ?resource ?relation ?type ?prefLabel ?latitude ?longitude\nWHERE {\n<"+a+">  mao:hasFragment ?f.\n?f mao:locator ?fragment.\n?annotation oac:hasTarget ?f.\n?annotation a ?type.\nOPTIONAL{?annotation cma:preferredLabel ?prefLabel.}\nOPTIONAL{?resource geo:lat ?latitude.}\nOPTIONAL{?resource geo:long ?longitude.}\n?annotation oac:hasBody ?resource.\n?f ?relation ?resource.\n}"},a.prototype.getAnnotationsForLocator=function(a,b){var c,d;return d=[],c=this._annotationsForLocator(a),this._runSPARQL(c,b)},a.prototype._annotationsForLocator=function(a){return"PREFIX oac: <http://www.openannotation.org/ns/>\nPREFIX mao: <http://www.w3.org/ns/ma-ont#>\nPREFIX cma: <http://connectme.at/ontology#>\nSELECT DISTINCT ?annotation ?fragment ?resource ?relation ?type ?prefLabel\nWHERE {\n  ?videoresource mao:locator <"+a+">.\n  ?videoresource mao:hasFragment ?f.\n  ?f mao:locator ?fragment.\n  ?annotation oac:hasTarget ?f.\n  ?annotation oac:hasBody ?resource.\n  ?annotation a ?type.\n  OPTIONAL{?annotation cma:preferredLabel ?prefLabel.}\n  ?f ?relation ?resource.\n}"},a.prototype.getVideoLocators=function(a,b){var c,d;return d=[],c=this._getVideoLocators(a),this._runSPARQL(c,function(a,c){var d,e;return a||(e=new RegExp(/\.(.{3,4})$/),d=_(c).map(function(a){var b,c;return a.source.value.indexOf("<crid")<0?(b=(null!=(c=a.type)?c.value:void 0)||"video/"+a.source.value.match(e)[1],{source:a.source.value,type:b}):void 0})),b(a,d)})},a.prototype._getVideoLocators=function(a){return"PREFIX oac: <http://www.openannotation.org/ns/>\nPREFIX mao: <http://www.w3.org/ns/ma-ont#>\nSELECT DISTINCT ?source ?type\nWHERE {\n  <"+a+'>  mao:locator ?source.\n  OPTIONAL {?source mao:hasFormat ?type}\n  FILTER regex(str(?source), "(http|https)")\n}\nORDER BY ?source'},a.prototype.getAllVideoLocators=function(a,b){var c,d;return d=[],c=this._getAllVideoLocators(a),this._runSPARQL(c,function(a,c){var d,e;return a||(e=new RegExp(/\.(.{3,4})$/),d=_(c).map(function(a){var b,c;return a.source.value.indexOf("crid")<0?(b=(null!=(c=a.type)?c.value:void 0)||"video/"+a.source.value.match(e)[1],{source:a.source.value,type:b}):void 0})),b(a,d)})},a.prototype._getAllVideoLocators=function(a){return"PREFIX oac: <http://www.openannotation.org/ns/>\nPREFIX mao: <http://www.w3.org/ns/ma-ont#>\nSELECT DISTINCT ?source ?type\nWHERE {\n  ?resource mao:locator <"+a+'>.\n  ?resource  mao:locator ?source.\n  OPTIONAL {?source mao:hasFormat ?type}\n  FILTER regex(str(?source), "(http|https)")\n}\nORDER BY ?source'},a.prototype.getLSIVideosForTerm=function(a,b){var c,d;return d=[],c=this._getLSIVideosForTerm(a),this._runSPARQL(c,function(a,c){return b(a,c)})},a.prototype._getLSIVideosForTerm=function(a){return"PREFIX mao: <http://www.w3.org/ns/ma-ont#>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nSELECT DISTINCT ?video ?duration ?description ?locator ?title ?img\nWHERE {\n  ?video mao:hasKeyword <"+a+"> .\n  ?video a <http://www.w3.org/ns/ma-ont#VideoTrack> .\n  OPTIONAL {?video mao:description ?description}.\n  ?video mao:locator ?locator .\n  OPTIONAL {?video mao:duration ?duration}.\n  ?video mao:title ?title .\n  OPTIONAL {?video foaf:img ?img}.\n}\nORDER BY ?video "},a.prototype.getLSIImagesForTerm=function(a,b){var c,d;return d=[],c=this._getLSIImagesForTerm(a),this._runSPARQL(c,function(a,c){return b(a,c)})},a.prototype._getLSIImagesForTerm=function(a){return"PREFIX mao: <http://www.w3.org/ns/ma-ont#>\nSELECT DISTINCT ?image\nWHERE {\n  ?image a <http://www.w3.org/ns/ma-ont#Image> .\n  ?image mao:hasKeyword <"+a+"> .\n}\nORDER BY ?image "},a.prototype.getGRDataForTerm=function(a,b){var c,d;return d=[],c=this._getGRDataForTerm(a),this._runSPARQL(c,function(a,c){return b(a,c)})},a.prototype._getGRDataForTerm=function(a){return"PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX gr: <http://purl.org/goodrelations/v1#>\nPREFIX vCard: <http://www.w3.org/2001/vcard-rdf/3.0#>\nPREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>\nSELECT DISTINCT ?name ?street ?pcode ?city ?country ?telephone ?email ?description ?geoLat ?geoLong ?pricevalue ?pricecurrency ?product\nWHERE {\n<"+a+"> gr:legalName ?name.\n<"+a+"> vCard:ADR ?address.\n?address vCard:Street ?street.\n?address vCard:Pcode ?pcode.\n?address vCard:City ?city.\n?address vCard:Country ?country.\n?address vCard:TEL ?tel.\n<"+a+"> geo:lat ?geoLat.\n<"+a+"> geo:long ?geoLong.\n?tel rdf:value ?telephone.\n?address vCard:EMAIL ?em.\n?em rdf:value ?email.\n<"+a+"> gr:offers ?offer.\n?offer rdfs:comment ?description.\n?offer gr:hasPriceSpecification ?price.\n?price gr:hasCurrencyValue ?pricevalue.\n?price gr:hasCurrency ?pricecurrency.\n?price rdfs:comment ?product.\n}"},a.prototype._runSPARQL=function(a,b){var c,d;return c=""+this.url+"sparql/select?query="+encodeURIComponent(a)+"&output=json",d=jQuery.getJSON(c,function(c){var d,e;return e=[],d=c.results.bindings,d.length!==_(d).uniq().length&&(console.warn("CMF DISTINCT is being ignored!",d,a),d=_(d).uniq()),b(null,d)}),d.error(b),d},a.prototype.test=function(){var a=this;return this.getVideos(function(a,b){return a?(console.error("getVideos error",a,b),void 0):console.info("getVideos result",b)}),this.getAnnotatedVideos(function(b,c){var d;return b?(console.error("getAnnotatedVideos error",b,c),void 0):(console.info("getAnnotatedVideos result",c),d=c[0].instance.value,console.info("Getting locators for",d),a.getVideoLocators(d,function(b,c){var e;return b?(console.error("getVideoLocators error",b,c),void 0):(console.info("getVideoLocators result",c),e=c[0].source,a.getAllVideoLocators(e,function(a,b){return a?(console.error("getAllVideoLocators error",a,b),void 0):console.info("getAllVideoLocators result",b)}),a.getAnnotationsForLocator(e,function(a,b){return a?(console.error("getAnnotationsForLocator error",a,b),void 0):console.info("getAnnotationsForLocator result",b)}),a.getLocatorsForVideoOrLocator(d,function(a,b){return a?(console.error("getLocatorsForVideoOrLocator error",a,b),void 0):console.info("getLocatorsForVideoOrLocator result",d,b)}),a.getLocatorsForVideoOrLocator(e,function(a,b){return a?(console.error("getLocatorsForVideoOrLocator error",a,b),void 0):console.info("getLocatorsForVideoOrLocator result",e,b)}),a.getAnnotationsForVideoOrLocator(d,function(a,b){return a?(console.error("getAnnotationsForVideoOrLocator error",a,b),void 0):console.info("getAnnotationsForVideoOrLocator result",d,b)}),a.getAnnotationsForVideoOrLocator(e,function(a,b){return a?(console.error("getAnnotationsForVideoOrLocator error",a,b),void 0):console.info("getAnnotationsForVideoOrLocator result",e,b)}))}),a.getAnnotationsForVideo(d,function(a,b){return a?(console.error("getAnnotationsForVideo error",a,b),void 0):console.info("getAnnotationsForVideo result",b)}))})},a}()}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};window.AnnotationOverlays=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.init=function(){return this.initSpacialAnnotations(),this.initTimeAnnotations(),this.initConceptOverlay()},d.prototype.initSpacialAnnotations=function(){var a,b,c,d,e,f,g,h=this;for(console.info("Initialize SpacialAnnotationOverlays"),this.spacialAnnotationOverlay=jQuery("<div class='spacial-annotation-overlays-wrapper'></div>"),this.lime.player.videoOverlay.append(this.spacialAnnotationOverlay),b=jQuery(".spacial-annotation-overlays-wrapper",this.lime.player.el),c=this.lime,jQuery(this.lime.player).bind("timeupdate",function(){}),g=this.lime.annotations,e=0,f=g.length;f>e;e++)a=g[e],jQuery(a).bind("becomeActive",function(d){var e;return a=d.annotation,a.isSpacial&&a.w>0&&a.h>0?(b.prepend(h.renderAnnotation(a)),e=jQuery(".spatial_annotation:first",b),jQuery(e).data("annotation",a),e.mouseenter(function(b){var c;return a=jQuery(b.target).data().annotation,c=jQuery.Event("mouseenter"),jQuery(a).trigger(c,["test"]),jQuery(b.target).fadeOut(50),jQuery(b.target).fadeIn(50)
}),e.mouseleave(function(){var b;return b=jQuery.Event("mouseleave"),jQuery(a).trigger(b,["test"])}),e.click(function(){var b,d,e;c.player.pause(),e=[];for(b in a.widgets)"AnnotationOverlays"!==b?(d=a.widgets[b],e.push(d.addClass("highlighted").delay(2e3).queue(function(a){return jQuery(this).removeClass("highlighted"),a()}))):e.push(void 0);return e}),a.widgets.AnnotationOverlays=e,e):void 0}),jQuery(a).bind("becomeInactive",function(b){return a=b.annotation,a.isSpacial&&a.w>0&&a.h>0?(a.widgets.AnnotationOverlays.remove(),delete a.widgets.AnnotationOverlays):!1});return d=function(){var a,b,c;return b=jQuery("video",h.lime.element),a=b.width(),b.css({width:"auto"}),c=b.width(),console.info("video width",a,c,h.spacialAnnotationOverlay[0]),b.css("width",""),h.spacialAnnotationOverlay.css({left:Math.floor((a-c)/2),right:(a-c)/2,position:"absolute",height:"100%","pointer-events":"none"})},jQuery(window).resize(d),d()},d.prototype.initTimeAnnotations=function(){var a,b,c,d,e,f,g,h,i,j=this;for(console.info("Initialize TimeAnnotationOverlays"),b=this.lime.player.timelineOverlay,d=this.lime.player.getLength(),console.info("length",d),h=this.lime.annotations,i=[],f=0,g=h.length;g>f;f++)a=h[f],e=100*(a.start/d),b.prepend("<div class='time-annotation' style='left:"+e+"%;'>&nbsp;</div>"),c=jQuery(".time-annotation:first",b),jQuery(c).data("annotation",a),c.click(function(b){return a=jQuery(b.target).data().annotation,j.lime.player.seek(a.start),j.lime.player.play()}),c.bind("mouseenter",function(b){var c;return a=jQuery(b.target).data().annotation,c=jQuery.Event("mouseenter"),jQuery(a).trigger(c,["test"]),j.fillConceptOverlay(j.renderConceptOverlay(a)),j.showConceptOverlay()}),i.push(c.mouseleave(function(b){var c;return a=jQuery(b.target).data().annotation,c=jQuery.Event("mouseleave"),jQuery(a).trigger(c,["test"]),j.hideConceptOverlay()}));return i},d.prototype.initConceptOverlay=function(){var a=this;return this.conceptOverlayEl=jQuery("<div class='concept-overlay concept-list-overlay'></div>"),this.lime.player.videoOverlay.append(this.conceptOverlayEl),this.conceptOverlayEl.hide(),jQuery(this.conceptOverlayEl).mouseenter(function(){return a.showConceptOverlay()}),jQuery(this.conceptOverlayEl).mouseleave(function(){return a.hideConceptOverlay()})},d.prototype.showConceptOverlay=function(){return this.hideTimeoutHandle&&(clearTimeout(this.hideTimeoutHandle),this.hideTimeoutHandle=void 0),this.conceptOverlayEl.show()},d.prototype.hideConceptOverlay=function(){var a=this;return this.hideTimeoutHandle=setTimeout(function(){return a.conceptOverlayEl.hide(),a.hideTimeoutHandle},2e3)},d.prototype.fillConceptOverlay=function(a){return jQuery(this.conceptOverlayEl).html("").append(a)},d.prototype.renderConceptOverlay=function(a){var b,c,d,e,f,g,h,i,j,k=this;for(g=function(a){var b,c;return b=new RegExp(/\/([^\/#]*)(#.*)?$/),null!=(c=a.match(b))?c[1]:void 0},e=a.start,d=this.lime.player.currentSource(),b=_.filter(this.lime.annotations,function(a){return a.start<=e&&a.end>e&&-1!==d.indexOf(g(a.fragment.value))}),b=_(b).sortBy(function(a){return[0-a.start,a.hash.relation.value,a.hash.fragment.value]}),b=_.uniq(b,function(a){return a.hash.annotation.value}),h="",i=0,j=b.length;j>i;i++)c=b[i],f="function"==typeof c.getDepiction?c.getDepiction({without:"thumb"}):void 0,h+="<tr><td class='icon'>",f&&(h+="<img src='"+f+"' style='height:20px;' />"),h+="</td>\n<td class='timeframe'>\n  "+this.timeformat(c.start)+" - "+this.timeformat(c.end)+"\n</td>\n<td class='label'>",h+=c.getPage?"<a href='"+c.getPage()+"' target='_blank' title='"+c.hash.fragment.value+"'>"+c.getLabel()+"</a>":"<span>"+(("function"==typeof c.getLabel?c.getLabel():void 0)||c)+"</span>",h+="</td></tr>";return h=jQuery('<table class="navlist">'+h+"</table>"),jQuery("li:first",h).addClass("active"),jQuery("a[target=_blank]",h).click(function(){return k.lime.player.pause()}),h},d.prototype.timeformat=function(a){var b,c,d,e;return e=a,a=e%60,e=(e-a)/60,c=e%60,b=(e-c)/60,d="",b>0&&10>b&&(b="0"+b),10>c&&(c="0"+c),10>a&&(a="0"+a),b&&(d+=""+b+":"),d+=""+c+":"+a},d.prototype.renderAnnotation=function(a){var b,c,d,e=this;return a.ldLoaded&&(c=a.entity[a.resource.value],b=_(c["http://www.w3.org/2000/01/rdf-schema#label"]).detect(function(a){return a.lang===e.lime.options.preferredLanguage}).value),void 0===b&&(b=""),d=a.isPercent?"%":"px","<div class='spatial_annotation' style='position: absolute; width: "+a.w+d+"; height: "+a.h+d+"; left: "+a.x+d+"; top: "+a.y+d+"'>"+b+"</div>"},d}(window.LimePlugin)}.call(this),function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};window.LDPlugin=function(a){function d(){return this.recursiveFetch=c(this.recursiveFetch,this),b=d.__super__.constructor.apply(this,arguments)}return e(d,a),d.prototype.init=function(){var a,b,c,d,e,f,g,h=this;for(this.vie=this.lime.options.vie||this.options.vie,this.promises={},this.vie||(this.lime.options.local&&jQuery.noop(),this.vie=new VIE,this.vie.use(new this.vie.StanbolService({url:this.options.stanbolUrl}))),b=this.lime.player.paused(),_.defer(function(){return h.lime.player.pause(),console.info("Loading entities first... Player paused...")}),c=this.lime.annotations.length,f=this.lime.annotations,g=[],d=0,e=f.length;e>d;d++)a=f[d],a.lime=this.lime,a.vie=this.vie,g.push(this.loadAnnotation(a,function(){c--,console.info("still waiting for so many annotations...",c),0===c&&(console.info("Loading entities finished."),b||(console.info("Playing again."),h.lime.player.play())),0>c&&console.error("This should not ever happen!")}));return g},d.prototype.defaults={stanbolUrl:"http://dev.iks-project.eu/stanbolfull",followRedirects:["dbpedia:wikiPageRedirects","rdfs:seeAlso","owl:sameAs",function(a){var b;return b=VIE.Util.getPreferredLangForPreferredProperty(a,["rdfs:label","geonames:alternateName"],["en"]),b?"http://dbpedia.org/resource/"+b.replace(/\s/g,"_"):void 0}]},d.prototype.loadAnnotation=function(a,b){var c,d;return d=a.resource.value,a.isBookmark()?(a.getLabel=a.getName=function(){return a.hash.prefLabel?a.hash.prefLabel.value:void 0},b()):this.promises[d]?(a.entityPromise=this.promises[d],a.entityPromise.annotations.push(a),b(),void 0):(a.entityPromise=this.promises[d]=jQuery.Deferred(),a.entityPromise.annotations=[a],c="",d===c&&this.lime.player.pause(),this.recursiveFetch(d,this.options.followRedirects,2,function(e){var f,g,h;for(e=_(e).uniq(function(a){return a.getSubject()}),console.info("LDPlugin loaded",e),d===c&&this.lime.player.pause(),h=a.entityPromise.annotations,f=0,g=h.length;g>f;f++)a=h[f],a.entities=e||[],a._detectPropertyLanguageOnEntity=function(a,b,c){var d,e,f,g,h;for(h=this.entities,f=0,g=h.length;g>f;f++)if(d=h[f],e=VIE.Util.getPreferredLangForPreferredProperty(d,a,b),"n/a"!==e)return e;return c},a._detectProperty=function(a){var b,c,d,e,f;for(f=this.entities,d=0,e=f.length;e>d;d++){if(b=f[d],c=b.get(a))return c;this.entities[0].fromReference(b.getSubject())}},a.getLabel=a.getName=function(){return a.hash.prefLabel?a.hash.prefLabel.value:this._detectPropertyLanguageOnEntity(["rdfs:label","geonames:alternateName"],[this.lime.options.preferredLanguage,"en"],"No label found.")},a.getDescription=function(){return this._detectPropertyLanguageOnEntity(["dbpedia:abstract","rdfs:comment"],[this.lime.options.preferredLanguage,"en"],"No description found.")},a.getDepiction=function(a){var b,c,d,f,g,h,i;for(i=this.entities,g=0,h=i.length;h>g;g++)if(c=i[g],d="",b=c.get("foaf:depiction"),b&&(_.isArray(b)?(f=_.detect(b,function(b){return e=!0,(null!=a?a["with"]:void 0)&&(e=e&&-1!==b.indexOf(null!=a?a["with"]:void 0)),(null!=a?a.without:void 0)&&(e=e&&-1===b.indexOf(null!=a?a.without:void 0)),e}),f||(f=b[0])):f=b,d=c.fromReference(f)),d)return d;return null},a.getPage=function(){var a,b,c,d,e,f,g;if(b=this._detectProperty(this.entities,"foaf:homepage"),!b){for(g=this.entities,e=0,f=g.length;f>e;e++){if(a=g[e],-1!==a.getSubject().indexOf("dbpedia"))return c=VIE.Util.getPreferredLangForPreferredProperty(a,["rdfs:label"],[this.lime.options.preferredLanguage]),"http://"+this.lime.options.preferredLanguage+".wikipedia.org/wiki/"+c;if(d=a.get("foaf:homepage"))return d}return this.entities.length?this.entities[0].fromReference(a.getSubject()):this.resource.value}return b},a.getType=function(){var a,b,c,d,e,f;for(f=this.entities,d=0,e=f.length;e>d;d++)a=f[d],c=a.get("@type"),b=_.isArray(c)?c:[c];return b},a.getStarring=function(){var a,b,c,d,e,f;if(b=this._detectProperty(this.entities,"dbpedia-owl:knownFor"),!b)for(f=this.entities,d=0,e=f.length;e>d;d++)a=f[d],c=a.get("dbpedia-owl:knownFor"),b=_.isArray(c)?c:[c];return console.log("===== LDPlugin - getStarring result: ",b),b},a.getLatitude=function(){var b,c,d,e,f;if(a.hash.latitude)return console.info("annotation.hash.latitude:",a.hash,a.hash.latitude),a.hash.latitude.value;for(c=0,f=this.entities,d=0,e=f.length;e>d;d++)b=f[d],-1!==b.getSubject().indexOf("geonames")&&(c=b.attributes["<http://www.w3.org/2003/01/geo/wgs84_pos#lat>"]);return console.log("Latitude = ",c),c},a.getLongitude=function(){var b,c,d,e,f;if(a.hash.longitude)return a.hash.longitude.value;for(c=0,f=this.entities,d=0,e=f.length;e>d;d++)b=f[d],-1!==b.getSubject().indexOf("geonames")&&(c=b.attributes["<http://www.w3.org/2003/01/geo/wgs84_pos#long>"]);return console.log("Latitude = ",c),c};return a.entityPromise.resolve(a.entities),b()}))},d.prototype.recursiveFetch=function(a,b,c,d){var e,f,g,h,i,j=this;return g=[],i=0,f=function(){return asdf},e=function(b){return i--,console.error("Couldn't load entity "+a,b),i>0?void 0:d([])},h=function(e){var f,h,k,l,m,n,o,p,q,r;if(f=_.detect(e,function(b){return b.fromReference(b.getSubject())===b.fromReference(a)}),f&&g.push(f),0===c)return d(_.flatten(g));if(m=[],f)for(n=0,p=b.length;p>n;n++)h=b[n],_.isString(h)&&(k=f.get(h),(null!=k?k.isEntity:void 0)||m.push(k)),_.isFunction(h)&&m.push(h(f));if(m=_.flatten(m),m=_.uniq(m),m=_.compact(m),i=m.length){for(r=[],o=0,q=m.length;q>o;o++)l=m[o],r.push(j.recursiveFetch(l,b,c-1,function(a){return g.push(a),i--,0>=i?d(_(g).flatten()):void 0}));return r}return d(_(g).flatten())},this.vie.load({entity:a}).using("stanbol").execute().fail(e).success(h)},d}(window.LimePlugin),a=function(){function a(){}return a}()}.call(this),function(){!function(a){var b,c;return c=function(a){return"object"==typeof a?a:{top:a,left:a}},b=a.scrollTo=function(b,c,d){return a(window).scrollTo(b,c,d)},b.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1,limit:!0},b.window=function(){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b,c,d;return c=this,(d=!c.nodeName||-1!==a.inArray(c.nodeName.toLowerCase(),["iframe","#document","html","body"]))?(b=(c.contentWindow||c).document||c.ownerDocument||c,/webkit/i.test(navigator.userAgent)||"BackCompat"===b.compatMode?b.body:b.documentElement):c})},a.fn.scrollTo=function(d,e,f){return"object"==typeof e&&(f=e,e=0),"function"==typeof f&&(f={onAfter:f}),"max"===d&&(d=9e9),f=a.extend({},b.defaults,f),e=e||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=c(f.offset),f.over=c(f.over),this._scrollable().each(function(){var g,h,i,j,k,l,m;if(h=function(a){return g.animate(i,e,f.easing,a&&function(){return a.call(this,d,f)})},null!=d){switch(j=this,g=a(j),k=d,l=void 0,i={},m=g.is("html,body"),typeof k){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(k)){k=c(k);break}if(k=a(k,this),!k.length)return;break;case"object":(k.is||k.style)&&(l=(k=a(k)).offset())}return a.each(f.axis.split(""),function(a,c){var d,e,n,o,p,q;return d="x"===c?"Left":"Top",p=d.toLowerCase(),e="scroll"+d,o=j[e],n=b.max(j,c),l?(i[e]=l[p]+(m?0:o-g.offset()[p]),f.margin&&(i[e]-=parseInt(k.css("margin"+d))||0,i[e]-=parseInt(k.css("border"+d+"Width"))||0),i[e]+=f.offset[p]||0,f.over[p]&&(i[e]+=k["x"===c?"width":"height"]()*f.over[p])):(q=k[p],i[e]=q.slice&&"%"===q.slice(-1)?parseFloat(q)/100*n:q),f.limit&&/^\d+$/.test(i[e])&&(i[e]=i[e]<=0?0:Math.min(i[e],n)),!a&&f.queue?(o!==i[e]&&h(f.onAfterFirst),delete i[e]):void 0}),h(f.onAfter)}}).end()},b.max=function(b,c){var d,e,f,g,h;return d="x"===c?"Width":"Height",g="scroll"+d,a(b).is("html,body")?(h="client"+d,f=b.ownerDocument.documentElement,e=b.ownerDocument.body,Math.max(f[g],e[g])-Math.min(f[h],e[h])):b[g]-a(b)[d.toLowerCase()]()}}(jQuery)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};window.UserSettingsPlugin=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.init=function(){var a,b,c,d=this;return this.name="UserSettingsPlugin",a=void 0,console.info("Initialize UserSettingsPlugin"),$("div .usersettings").click(function(){return d.lime.options.pauseOnWidgetopen&&d.lime.player.pause(),d.renderUserSettingsInModalWindow()}),b=$("<div class='vjs-control usersettings' title='User settings' alt='User settings'><div></div></div>"),b.click(function(){return d.lime.options.pauseOnWidgetopen&&d.lime.player.pause(),d.renderUserSettingsInModalWindow()}),$(this.lime.player.buttonContainer).append(b),this.options.permanentWidget?(console.info("Permanent widgets are on."),c=this.lime.allocateWidgetSpace(this,{thumbnail:"img/settingsWidget.png",title:"User settings",type:"UserSettingsWidget",sortBy:function(){return 1e8}}),jQuery(c).bind("activate",function(){return d.lime.options.pauseOnWidgetopen&&d.lime.player.pause(),d.renderUserSettingsInModalWindow()}),_.defer(function(){return c.setActive()})):void 0},d.prototype.defaults={unhidable:[],permanentWidget:!1},d.prototype.getAllWidgetTypes=function(){var a;return a=_(this.lime.widgets).chain().map(function(a){return a.options.type}).uniq().sort().difference(this.defaults.unhidable,"UserSettingsWidget").value()},d.prototype.getHiddenWidgetTypes=function(){return JSON.parse(localStorage.getItem("hiddenWidgetTypes"))||[]},d.prototype.setHiddenWidgetTypes=function(a){var b;return localStorage.setItem("hiddenWidgetTypes",JSON.stringify(a)),b=_(this.getAllWidgetTypes()).difference(a).concat(this.defaults.unhidable),this.lime.updateDeactivatedWidgetStates(b)},d.prototype.hideWidgetType=function(a){var b;return b=this.getHiddenWidgetTypes(),b.push(a),b=_(b).uniq(),this.setHiddenWidgetTypes(b)},d.prototype.unhideWidgetType=function(a){var b,c;return b=this.getHiddenWidgetTypes(),c=b.indexOf(a),b.splice(c,1),this.setHiddenWidgetTypes(b)},d.prototype.renderUserSettingsInModalWindow=function(){var a,b,c,d,e,f,g,h,i=this;for(b=this.getModalContainer(),b.css("width","600px"),b.css("height","auto"),b.css("overflow","auto"),console.info("widget types:",this.getAllWidgetTypes()),b.append('<div class="settingscontent" style="color: white; width: 100%; height: auto; margin-top: 0; background: rgba(0,0,0,0.6);">'),c=$(".settingscontent",b),c.append('<span class="settingstitle" style="font-size: 20px; margin-left: 10px;">LIME player settings </span>'),$(".annotationspatialoverlay",d).click(function(){}),$(".annotationtimelineoverlay",d).click(function(){}),c.append('<p class="settingssection" style="font-size: 16px; margin-left: 10px;"> Widgets </p>\n<form style="margin: 0 auto; text-align: left; font-size: 14px; width: 75%;" >\n  <div class="settingssection widget-types" style="margin: 0 auto;"></div>\n</form>\n<br/>'),d=$("div.settingssection.widget-types",c),h=this.getAllWidgetTypes(),f=0,g=h.length;g>f;f++)e=h[f],a=-1===this.getHiddenWidgetTypes().indexOf(e)?"checked":"",d.append("<div><label><input type='checkbox' name='"+e+"' class='"+e+" setting' "+a+" > Show '"+e+"' widgets</label></div>");return $(".setting",d).click(function(a){var b,c;return b=a.target.name,c=a.target.checked,c?i.unhideWidgetType(b):i.hideWidgetType(b)})},d}(window.LimePlugin)}.call(this),this.UTILS=this.UTILS||new Utils,UTILS.getParameterByName=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.search);return null==d?"":decodeURIComponent(d[1].replace(/\+/g," "))};