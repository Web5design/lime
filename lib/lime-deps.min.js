/* Lime Player 2.1.0 - Linked Media Player
by Szaby Gruenwald, Cristian Bara and the ConnectMe Project.
Available under the Apache License, Version 2.0
See http://connectme.sti2.org/ for more information.
*/!function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?(this._wrapped=a,void 0):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.4.4";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?null:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;d.computed>g&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(b||x.identity);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;e>c.call(d,a[h])?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(i.apply(d,arguments))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=Array(b),d=0;b>d;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);d>e;)f[e++]=a,a+=c;return f},x.bind=function(a,b){if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));var c=h.call(arguments,2);return function(){return a.apply(b,c.concat(h.call(arguments)))}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);return 0===b.length&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},x.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return 0>=a?b():function(){return 1>--a?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var E=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==b+"";case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=E(a[g],b[g],c,d)););}else{var i=a.constructor,k=b.constructor;if(i!==k&&!(x.isFunction(i)&&i instanceof i&&x.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(x.has(a,l)&&(g++,!(h=x.has(b,l)&&E(a[l],b[l],c,d))))break;if(h){for(l in b)if(x.has(b,l)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return E(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=x.invert(F.escape);var G={escape:RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(G[a],function(b){return F[a][b]})}}),x.result=function(a,b){if(null==a)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),L.call(this,c.apply(x,a))}})};var H=0;x.uniqueId=function(a){var b=++H+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=RegExp([(c.escape||I).source,(c.interpolate||I).source,(c.evaluate||I).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(K,function(a){return"\\"+J[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var L=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],L.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return L.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var a,b=this,c=b.Backbone,d=[],e=d.push,f=d.slice,g=d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.0.0";var h=b._;h||"undefined"==typeof require||(h=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var i=a.Events={on:function(a,b,c){if(!k(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,j=g.length;j>i;i++)if(a=g[i],f=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=f.length;m>l;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=f.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){for(var f=c.split(j),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=h.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(a,i);var n=a.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),b.trigger("sync",b,d,a),void 0):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,!(!d||c&&c.wait||this.set(d,c)))return!1;if(c=h.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);return c.wait&&(b=h.extend(d||{},b)),h.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),i.trigger("sync",i,a,c),void 0)},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=a.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,d,f,i,j,k=b.at,l=this.comparator&&null==k&&b.sort!==!1,m=h.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;d>c;c++)(f=this._prepareModel(a[c],b))&&((i=this.get(f))?(b.remove&&(p[i.cid]=!0),b.merge&&(i.set(f.attributes,b),l&&!j&&i.hasChanged(m)&&(j=!0))):b.add&&(n.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)));if(b.remove){for(c=0,d=this.length;d>c;++c)p[(f=this.models[c]).cid]||o.push(f);o.length&&this.remove(o,b)}if(n.length&&(l&&(j=!0),this.length+=n.length,null!=k?g.apply(this.models,[k,0].concat(n)):e.apply(this.models,n)),j&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;d>c;c++)(f=n[c]).trigger("add",f,this,b);return j&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=a.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(h.isFunction(c)||(c=this[a[b]]),c){var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var b=h.extend({},h.result(this,"attributes"));this.id&&(b.id=h.result(this,"id")),this.className&&(b["class"]=h.result(this,"className"));var c=a.$("<"+h.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=y[b];h.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=h.result(c,"url")||K()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||d.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(h.extend(f,d));return c.trigger("request",c,i,d),i};var y={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var z=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(b,c,d){h.isRegExp(b)||(b=this._routeToRegExp(b)),h.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=a.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(b){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=H.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(G,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!E.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new E;var J=function(a,b){var c,d=this;c=a&&h.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},h.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&h.extend(c.prototype,a),c.__super__=d.prototype,c};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')
},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),function(a){var b={},c=/^(([a-z][\-a-z0-9+\.]*):)?(\/\/([^\/?#]+))?([^?#]*)?(\?([^#]*))?(#(.*))?$/i,d=function(a){var b=a.match(c);if(null===b)throw"Malformed URI: "+a;return{scheme:b[1]?b[2].toLowerCase():void 0,authority:b[3]?b[4]:void 0,path:b[5]||"",query:b[6]?b[7]:void 0,fragment:b[8]?b[9]:void 0}},e=function(a){var b="",c=[];if(/\./.test(a)){for(;void 0!==a&&""!==a;)"."===a||".."===a?a="":/^\.\.\//.test(a)?a=a.substring(3):/^\.\//.test(a)?a=a.substring(2):/^\/\.(\/|$)/.test(a)?a="/"+a.substring(3):/^\/\.\.(\/|$)/.test(a)?(a="/"+a.substring(4),b=b.replace(/\/?[^\/]+$/,"")):(c=a.match(/^(\/?[^\/]*)(\/.*)?$/),a=c[2],b+=c[1]);return b}return a},f=function(a,b){return""===a.authority||void 0!==a.path&&""!==a.path?a.path.replace(/[^\/]+$/,"")+b:"/"+b};a.uri=function(c,d){var e;return c=c||"",b[c]?b[c]:(d=d||a.uri.base(),"string"==typeof d&&(d=a.uri.absolute(d)),e=new a.uri.fn.init(c,d),b[e]?b[e]:(b[e]=e,e))},a.uri.fn=a.uri.prototype={scheme:void 0,authority:void 0,path:void 0,query:void 0,fragment:void 0,init:function(b,c){if(c=c||{},a.extend(this,d(b)),void 0===this.scheme&&(this.scheme=c.scheme,void 0!==this.authority?this.path=e(this.path):(this.authority=c.authority,""===this.path?(this.path=c.path,void 0===this.query&&(this.query=c.query)):(/^\//.test(this.path)||(this.path=f(c,this.path)),this.path=e(this.path)))),void 0===this.scheme)throw"Malformed URI: URI is not an absolute URI and no base supplied: "+b;return this},resolve:function(b){return a.uri(b,this)},relative:function(b){var c,d,e,f=0,g=[],h="";if("string"==typeof b&&(b=a.uri(b,{})),b.scheme!==this.scheme||b.authority!==this.authority)return b.toString();if(b.path!==this.path){if(c=b.path.split("/"),d=this.path.split("/"),c[1]!==d[1])h=b.path;else{for(;c[f]===d[f];)f+=1;for(e=f;f<d.length-1;f+=1)g.push("..");for(;e<c.length;e+=1)g.push(c[e]);h=g.join("/")}return h=void 0===b.query?h:h+"?"+b.query,h=void 0===b.fragment?h:h+"#"+b.fragment}return void 0!==b.query&&b.query!==this.query?"?"+b.query+(void 0===b.fragment?"":"#"+b.fragment):void 0!==b.fragment&&b.fragment!==this.fragment?"#"+b.fragment:""},toString:function(){var a="";return this._string?this._string:(a=void 0===this.scheme?a:a+this.scheme+":",a=void 0===this.authority?a:a+"//"+this.authority,a+=this.path,a=void 0===this.query?a:a+"?"+this.query,a=void 0===this.fragment?a:a+"#"+this.fragment,this._string=a,a)}},a.uri.fn.init.prototype=a.uri.fn,a.uri.absolute=function(b){return a.uri(b,{})},a.uri.resolve=function(b,c){return a.uri(b,c)},a.uri.relative=function(b,c){return a.uri(c,{}).relative(b)},a.uri.base=function(){return a(document).base()},a.fn.base=function(){var b=a(this).parents().andSelf().find("base").attr("href"),c=a(this)[0].ownerDocument||document,d=a.uri.absolute(null===c.location?document.location.href:c.location.href);return void 0===b?d:a.uri(b,d)}}(jQuery),function(a){var b="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2000/xmlns/",d=/\sxmlns(?::([^ =]+))?\s*=\s*(?:"([^"]*)"|'([^']*)')/g,e="[-A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�က0-F.0-9·̀-ͯ‿-⁀]",f="[A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣一-龥〇〡-〩_]",g=new RegExp("^"+f+e+"*$");a.fn.xmlns=function(e,f,h){var i,j,k,l,m,n=this.eq(0),o=n.data("xmlns"),p=n[0],q=e?"xmlns:"+e:"xmlns",r=!1;if(void 0===f){if(void 0===e){if(!o){if(o={},p.attributes&&p.attributes.getNamedItemNS)for(k=0;k<p.attributes.length;k+=1)i=p.attributes[k],/^xmlns(:(.+))?$/.test(i.nodeName)&&(e=/^xmlns(:(.+))?$/.exec(i.nodeName)[2]||"",l=i.nodeValue,(""===e||""!==l&&l!==b&&l!==c&&g.test(e)&&"xml"!==e&&"xmlns"!==e)&&(o[e]=a.uri(i.nodeValue),r=!0));else{for(m=/<[^>]+>/.exec(p.outerHTML),i=d.exec(m);null!==i;)e=i[1]||"",l=i[2]||i[3],(""===e||""!==l&&l!==b&&l!==c&&g.test(e)&&"xml"!==e&&"xmlns"!==e)&&(o[e]=a.uri(i[2]||i[3]),r=!0),i=d.exec(m);d.lastIndex=0}h=h||(1===p.parentNode.nodeType?n.parent().xmlns():{}),o=r?a.extend({},h,o):h,n.data("xmlns",o)}return o}if("object"==typeof e){for(j in e)"string"==typeof e[j]&&g.test(j)&&this.xmlns(j,e[j]);return this.find("*").andSelf().removeData("xmlns"),this}return o||(o=n.xmlns()),o[e]}return this.find("*").andSelf().removeData("xmlns"),this.attr(q,f)},a.fn.removeXmlns=function(a){var b,c,d;if("object"==typeof a)if(void 0===a.length)for(c in a)"string"==typeof a[c]&&this.removeXmlns(c);else for(d=0;d<a.length;d+=1)this.removeXmlns(a[d]);else b=a?"xmlns:"+a:"xmlns",this.removeAttr(b);return this.find("*").andSelf().removeData("xmlns"),this},a.fn.qname=function(a){var b,c,d;if(void 0===a&&(a=void 0===this[0].outerHTML?this[0].nodeName.toLowerCase():/<([^ >]+)/.exec(this[0].outerHTML)[1].toLowerCase()),"?xml:namespace"===a)throw"XMLinHTML: Unable to get the prefix to resolve the name of this element";if(b=/^(([^:]+):)?([^:]+)$/.exec(a),c=b[2]||"",d=this.xmlns(c),void 0===d&&""!==c)throw"MalformedQName: The prefix "+c+" is not declared";return{namespace:d,localPart:b[3],prefix:c,name:a}}}(jQuery),function(a){var b=function(a){return a.replace(/[ \t\n\r]+/," ").replace(/^ +/,"").replace(/ +$/,"")};a.typedValue=function(b,c){return a.typedValue.fn.init(b,c)},a.typedValue.fn=a.typedValue.prototype={representation:void 0,value:void 0,datatype:void 0,init:function(c,d){var e=a.typedValue.types[d];return this.representation=c,this.datatype=d,this.value=void 0===e?b(c):e.value(e.strip?b(c):c),this}},a.typedValue.fn.init.prototype=a.typedValue.fn,a.typedValue.types={},a.typedValue.types["http://www.w3.org/2001/XMLSchema#string"]={regex:/^.*$/,strip:!1,value:function(a){return a}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#token"]={regex:/^.*$/,strip:!0,value:function(a){return b(a)}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#NCName"]={regex:/^[a-z_][-\.a-z0-9]+$/i,strip:!0,value:function(a){return b(a)}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#boolean"]={regex:/^(?:true|false|1|0)$/,strip:!0,value:function(a){return"true"===a||"1"===a}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#decimal"]={regex:/^[\-\+]?(?:[0-9]+\.[0-9]*|\.[0-9]+|[0-9]+)$/,strip:!0,value:function(a){return a=a.replace(/^0+/,"").replace(/0+$/,""),""===a&&(a="0.0"),"."===a.substring(0,1)&&(a="0"+a),/\.$/.test(a)?a+="0":/\./.test(a)||(a+=".0"),a}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#integer"]={regex:/^[\-\+]?[0-9]+$/,strip:!0,value:function(a){return parseInt(a,10)}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#int"]={regex:/^[\-\+]?[0-9]+$/,strip:!0,value:function(a){return parseInt(a,10)}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#float"]={regex:/^(?:[\-\+]?(?:[0-9]+\.[0-9]*|\.[0-9]+|[0-9]+)(?:[eE][\-\+]?[0-9]+)?|[\-\+]?INF|NaN)$/,strip:!0,value:function(a){return"-INF"===a?-1/0:"INF"===a||"+INF"===a?1/0:parseFloat(a)}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#double"]={regex:a.typedValue.types["http://www.w3.org/2001/XMLSchema#float"].regex,strip:!0,value:a.typedValue.types["http://www.w3.org/2001/XMLSchema#float"].value},a.typedValue.types["http://www.w3.org/2001/XMLSchema#duration"]={regex:/^([\-\+])?P(?:([0-9]+)Y)?(?:([0-9]+)M)?(?:([0-9]+)D)?(?:T(?:([0-9]+)H)?(?:([0-9]+)M)?(?:([0-9]+(?:\.[0-9]+)?)?S)?)$/,validate:function(a){var b=this.regex.exec(a);return b[2]||b[3]||b[4]||b[5]||b[6]||b[7]},strip:!0,value:function(a){return a}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#yearMonthDuration"]={regex:/^([\-\+])?P(?:([0-9]+)Y)?(?:([0-9]+)M)?$/,validate:function(a){var b=this.regex.exec(a);return b[2]||b[3]},strip:!0,value:function(a){var b=this.regex.exec(a),c=b[2]||0,d=b[3]||0;return d+=12*c,"-"===b[1]?-1*d:d}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#dateTime"]={regex:/^(-?[0-9]{4,})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):(([0-9]{2})(\.([0-9]+))?)((?:[\-\+]([0-9]{2}):([0-9]{2}))|Z)?$/,validate:function(a){var b,c=this.regex.exec(a),d=parseInt(c[1],10),e=void 0===c[10]||"Z"===c[10]?"+0000":c[10].replace(/:/,"");if(0===d||parseInt(e,10)<-1400||parseInt(e,10)>1400)return!1;try{if(d=100>d?Math.abs(d)+1e3:d,month=parseInt(c[2],10),day=parseInt(c[3],10),day>31)return!1;if(day>30&&1!==month&&3!==month&&5!==month&&7!==month&&8!==month&&10!==month&&12!==month)return!1;if(2===month){if(day>29)return!1;if(29===day&&(0!==d%4||0===d%100&&0!==d%400))return!1}return b=""+d+"/"+c[2]+"/"+c[3]+" "+c[4]+":"+c[5]+":"+c[7]+" "+e,b=new Date(b),!0}catch(f){return!1}},strip:!0,value:function(a){return a}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#date"]={regex:/^(-?[0-9]{4,})-([0-9]{2})-([0-9]{2})((?:[\-\+]([0-9]{2}):([0-9]{2}))|Z)?$/,validate:function(a){var b=this.regex.exec(a),c=parseInt(b[1],10),d=parseInt(b[2],10),e=parseInt(b[3],10),f=void 0===b[10]||"Z"===b[10]?"+0000":b[10].replace(/:/,"");return 0===c||d>12||e>31||parseInt(f,10)<-1400||parseInt(f,10)>1400?!1:!0},strip:!0,value:function(a){return a}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#gYear"]={regex:/^-?([0-9]{4,})$/,validate:function(a){var b=parseInt(a,10);return 0!==b},strip:!0,value:function(a){return parseInt(a,10)}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#gMonthDay"]={regex:/^--([0-9]{2})-([0-9]{2})((?:[\-\+]([0-9]{2}):([0-9]{2}))|Z)?$/,validate:function(a){var b=this.regex.exec(a),c=parseInt(b[1],10),d=parseInt(b[2],10),e=void 0===b[3]||"Z"===b[3]?"+0000":b[3].replace(/:/,"");return c>12||d>31||parseInt(e,10)<-1400||parseInt(e,10)>1400?!1:2===c&&d>29?!1:(4===c||6===c||9===c||11===c)&&d>30?!1:!0},strip:!0,value:function(a){return a}},a.typedValue.types["http://www.w3.org/2001/XMLSchema#anyURI"]={regex:/^.*$/,strip:!0,value:function(b,c){var d=a.extend({},a.typedValue.defaults,c);return a.uri.resolve(b,d.base)}},a.typedValue.defaults={base:a.uri.base(),namespaces:{}},a.typedValue.valid=function(c,d){var e=a.typedValue.types[d];return void 0===e?!0:(c=e.strip?b(c):c,e.regex.test(c)?void 0===e.validate?!0:e.validate(c):!1)}}(jQuery),function(a){a.curie=function(b,c){var d=a.extend({},a.curie.defaults,c||{}),e=/^(([^:]*):)?(.+)$/.exec(b),f=e[2],g=e[3],h=d.namespaces[f];if(/^:.+/.test(b)){if(void 0===d.reservedNamespace||null===d.reservedNamespace)throw"Malformed CURIE: No prefix and no default namespace for unprefixed CURIE "+b;h=d.reservedNamespace}else if(f){if(void 0===h)throw"Malformed CURIE: No namespace binding for "+f+" in CURIE "+b}else if("lower"===d.charcase?b=b.toLowerCase():"upper"===d.charcase&&(b=b.toUpperCase()),d.reserved.length&&a.inArray(b,d.reserved)>=0)h=d.reservedNamespace,g=b;else{if(void 0===d.defaultNamespace||null===d.defaultNamespace)throw"Malformed CURIE: No prefix and no default namespace for unprefixed CURIE "+b;h=d.defaultNamespace}return a.uri(h+g)},a.curie.defaults={namespaces:{},reserved:[],reservedNamespace:void 0,defaultNamespace:void 0,charcase:"preserve"},a.safeCurie=function(b,c){var d=/^\[([^\]]+)\]$/.exec(b);return d?a.curie(d[1],c):a.uri(b)},a.createCurie=function(b,c){var d,e=a.extend({},a.curie.defaults,c||{}),f=e.namespaces;if(b=a.uri(b).toString(),void 0!==e.reservedNamespace&&b.substring(0,e.reservedNamespace.toString().length)===e.reservedNamespace.toString()?(d=b.substring(e.reservedNamespace.toString().length),-1===a.inArray(d,e.reserved)&&(d=":"+d)):a.each(f,function(a,c){return b.substring(0,c.toString().length)===c.toString()?(d=a+":"+b.substring(c.toString().length),null):void 0}),void 0===d)throw"No Namespace Binding: There's no appropriate namespace binding for generating a CURIE from "+b;return d},a.fn.curie=function(b,c){var d=a.extend({},a.fn.curie.defaults,{namespaces:this.xmlns()},c||{});return a.curie(b,d)},a.fn.safeCurie=function(b,c){var d=a.extend({},a.fn.curie.defaults,{namespaces:this.xmlns()},c||{});return a.safeCurie(b,d)},a.fn.createCurie=function(b,c){var d=a.extend({},a.fn.curie.defaults,{namespaces:this.xmlns()},c||{});return a.createCurie(b,d)},a.fn.curie.defaults={reserved:["alternate","appendix","bookmark","cite","chapter","contents","copyright","first","glossary","help","icon","index","last","license","meta","next","p3pv1","prev","role","section","stylesheet","subsection","start","top","up"],reservedNamespace:"http://www.w3.org/1999/xhtml/vocab#",defaultNamespace:void 0,charcase:"lower"}}(jQuery),function(a){var b={},c={},d={},e={},f={},g="http://www.w3.org/2001/XMLSchema#",h="http://www.w3.org/1999/02/22-rdf-syntax-ns#",i="http://www.w3.org/2000/01/rdf-schema#",j=/^<(([^>]|\\>)*)>$/,k=/^("""((\\"|[^"])*)"""|"((\\"|[^"])*)")(@([a-z]+(-[a-z0-9]+)*)|\^\^(.+))?$/,l=/(("""((\\"|[^"])*)""")|("(\\"|[^"]|)*")|(<(\\>|[^>])*>)|\S)+/g,m=databankSeed=(new Date).getTime()%1e3,n=function(){return m+=1,"b"+m.toString(16)},o=function(){return databankSeed+=1,"data"+databankSeed.toString(16)},q={},r={},s=function(b,c){if("string"!=typeof b)return b;try{return a.rdf.resource(b,c)}catch(d){try{return a.rdf.blank(b,c)}catch(e){throw"Bad Triple: Subject "+b+" is not a resource: "+e}}},t=function(b,c){if("a"===b)return a.rdf.type;if("string"!=typeof b)return b;try{return a.rdf.resource(b,c)}catch(d){throw"Bad Triple: Property "+b+" is not a resource: "+d}},u=function(b,c){if("string"!=typeof b)return b;try{return a.rdf.resource(b,c)}catch(d){try{return a.rdf.blank(b,c)}catch(e){try{return a.rdf.literal(b,c)}catch(f){throw"Bad Triple: Object "+b+" is not a resource or a literal "+f}}}},w=function(a,b,c){var d;return"string"==typeof b?(d=b.substring(1),c[d]&&c[d]!==a?null:(c[d]=a,c)):b===a?c:null},x=function(b,c){if(void 0===b.union){if(void 0!==c.subject.type)return void 0===b.subjectIndex[c.subject]?[]:a.map(b.subjectIndex[c.subject],function(a){var b=c.exec(a);return null===b?null:{bindings:b,triples:[a]}});if("uri"===c.object.type||"bnode"===c.object.type)return void 0===b.objectIndex[c.object]?[]:a.map(b.objectIndex[c.object],function(a){var b=c.exec(a);return null===b?null:{bindings:b,triples:[a]}});if(void 0!==c.property.type)return void 0===b.propertyIndex[c.property]?[]:a.map(b.propertyIndex[c.property],function(a){var b=c.exec(a);return null===b?null:{bindings:b,triples:[a]}})}return a.map(b.triples(),function(a){var b=c.exec(a);return null===b?null:{bindings:b,triples:[a]}})},y=function(b,c,d){return a.map(b,function(b){var e=a.map(c,function(a){var c,d,e=!0;for(c in a.bindings)if(d=a.bindings[c],void 0!==b.bindings[c]&&b.bindings[c]!==d){e=!1;break}return e?a:null});return e.length>0?a.map(e,function(c){return{bindings:a.extend({},b.bindings,c.bindings),triples:P(b.triples.concat(c.triples))}}):d?b:null})},z=function(b,c){var d,e,f;void 0===c.filterExp||a.isFunction(c.filterExp)||(void 0===b.union?(d="string"==typeof c.filterExp.subject?"":c.filterExp.subject,e="string"==typeof c.filterExp.property?"":c.filterExp.property,f="string"==typeof c.filterExp.object?"":c.filterExp.object,void 0===b.queries[d]&&(b.queries[d]={}),void 0===b.queries[d][e]&&(b.queries[d][e]={}),void 0===b.queries[d][e][f]&&(b.queries[d][e][f]=[]),b.queries[d][e][f].push(c)):a.each(b.union,function(a,b){z(b,c)}))},A=function(b){b.length=0,b.matches=[],a.each(b.children,function(a,b){A(b)}),a.each(b.partOf,function(a,b){A(b)})},B=function(b,c){c.length>0&&(a.each(b.children,function(a,b){E(b,c)}),a.each(b.partOf,function(a,b){B(b,c)}),a.each(c,function(a,c){b.matches.push(c),Array.prototype.push.call(b,c.bindings)}))},C=function(a,b){var c,d,e,f,g,h,i,j=b.length,k={},l={},m={},n=[];for(c=0;c<a.length;c+=1)for(d=a[c].bindings,e=a[c].triples,l=m,f=0;j>f;f+=1)if(h=b[f],i=d[h],f===j-1)if(void 0===l[i]){for(k={bindings:{},triples:e},g=0;j>g;g+=1)k.bindings[b[g]]=d[b[g]];l[i]=k,n.push(k)}else k=l[i],k.triples=k.triples.concat(e);else void 0===l[i]&&(l[i]={}),l=l[i];return n},D=function(a,b){var c,d,e,f={},g=[];for(c=0;c<a.length;c+=1)d=a[c],void 0===f[d.bindings[b]]?(e={bindings:{node:d.bindings[b]},triples:d.triples},g.push(e),f[d.bindings[b]]=e):(e=f[d.bindings[b]],e.triples=e.triples.concat(d.triples));return g},E=function(b,c){var d;void 0===b.union?b.top||b.parent.top?d=b.alphaMemory:(c=c||b.parent.matches,d=a.isFunction(b.filterExp)?a.map(c,function(a,c){return b.filterExp.call(a.bindings,c,a.bindings,a.triples)?a:null}):void 0!==b.filterExp?y(c,b.alphaMemory,b.filterExp.optional):c):d=a.map(b.union,function(a){return a.matches}),void 0!==b.selections?d=C(d,b.selections):void 0!==b.navigate&&(d=D(d,b.navigate)),B(b,d)},F=function(a,b){var c;a.filterExp.optional?(A(a),E(a)):(c=a.top||a.parent.top?[b]:y(a.parent.matches,[b],!1),B(a,c))},G=function(a,b){var c,d=a.filterExp.exec(b);null!==d&&(c={triples:[b],bindings:d},a.alphaMemory.push(c),F(a,c))},H=function(b,c){b.alphaMemory.splice(a.inArray(c,b.alphaMemory),1),A(b),E(b)},I=function(b,c){a.each(b,function(a,b){G(b,c)})},J=function(b,c){a.each(b,function(a,b){H(b,c)})},K=function(b,c){var d=c.subject,e=c.property,f=c.object;void 0===b.union?(void 0!==b.queries[d]&&(void 0!==b.queries[d][e]&&(void 0!==b.queries[d][e][f]&&I(b.queries[d][e][f],c),void 0!==b.queries[d][e][""]&&I(b.queries[d][e][""],c)),void 0!==b.queries[d][""]&&(void 0!==b.queries[d][""][f]&&I(b.queries[d][""][f],c),void 0!==b.queries[d][""][""]&&I(b.queries[d][""][""],c))),void 0!==b.queries[""]&&(void 0!==b.queries[""][e]&&(void 0!==b.queries[""][e][f]&&I(b.queries[""][e][f],c),void 0!==b.queries[""][e][""]&&I(b.queries[""][e][""],c)),void 0!==b.queries[""][""]&&(void 0!==b.queries[""][""][f]&&I(b.queries[""][""][f],c),void 0!==b.queries[""][""][""]&&I(b.queries[""][""][""],c)))):a.each(b.union,function(a,b){K(b,c)})},L=function(b,c){var d=c.subject,e=c.property,f=c.object;void 0===b.union?(void 0!==b.queries[d]&&(void 0!==b.queries[d][e]&&(void 0!==b.queries[d][e][f]&&J(b.queries[d][e][f],c),void 0!==b.queries[d][e][""]&&J(b.queries[d][e][""],c)),void 0!==b.queries[d][""]&&(void 0!==b.queries[d][""][f]&&J(b.queries[d][""][f],c),void 0!==b.queries[d][""][""]&&J(b.queries[d][""][""],c))),void 0!==b.queries[""]&&(void 0!==b.queries[""][e]&&(void 0!==b.queries[""][e][f]&&J(b.queries[""][e][f],c),void 0!==b.queries[""][e][""]&&J(b.queries[""][e][""],c)),void 0!==b.queries[""][""]&&(void 0!==b.queries[""][""][f]&&J(b.queries[""][""][f],c),void 0!==b.queries[""][""][""]&&J(b.queries[""][""][""],c)))):a.each(b.union,function(a,b){L(b,c)})},M=function(b,c,d){var e,f,g=c[0],h={},i=[];if(d=d||{},0===c.length){for(e=0;e<b.length;e+=1)for(v in b[e])void 0===d[v]&&(d[v]=[]),a.isArray(d[v])&&d[v].push(b[e][v]);return[d]}for(e=0;e<b.length;e+=1)key=b[e][g],void 0===h[key]&&(h[key]=[]),h[key].push(b[e]);c=c.splice(1,1);for(v in h)f=a.extend({},d),f[g]=h[v][0][g],i=i.concat(M(h[v],c,f));return i},N=function(a,b,c){return void 0===r[a.id]&&(r[a.id]={}),void 0===r[a.id][b]?(r[a.id][b]=c,!1):!0},O=function(b,c,d,e){var f=r[b.id][c];a.isFunction(f[d])&&f[d].call(b,e),r[b.id][c]=void 0},P=function(a){for(var b=[],c=a.length,d=0;c>d;d++){for(var e=d+1;c>e;e++)a[d]===a[e]&&(e=++d);b.push(a[d])}return b};a.typedValue.types["http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral"]={regex:/^.*$/m,strip:!1,value:function(a){return a}},a.rdf=function(b){return new a.rdf.fn.init(b)},a.rdf.fn=a.rdf.prototype={rdfquery:"1.1",init:function(b){var c,d;if(b=b||{},this.parent=b.parent,this.union=b.union,this.top=void 0===this.parent&&void 0===this.union,void 0===this.union?this.databank=void 0===b.databank?void 0===this.parent?a.rdf.databank(b.triples,b):this.parent.databank:b.databank:(c=a.map(this.union,function(a){return a.databank}),c=P(c),this.databank=void 0!==c[1]?a.rdf.databank(void 0,{union:c}):c[0]),this.children=[],this.partOf=[],this.filterExp=b.filter,this.selections=b.distinct,this.navigate=b.navigate,this.alphaMemory=[],this.matches=[],this.length=0,void 0!==this.filterExp)a.isFunction(this.filterExp)||(z(this.databank,this),this.alphaMemory=x(this.databank,this.filterExp));else if(void 0!==b.nodes)for(this.alphaMemory=[],d=0;d<b.nodes.length;d+=1)this.alphaMemory.push({bindings:{node:b.nodes[d]},triples:[]});return E(this),this},base:function(a){return void 0===a?this.databank.base():(this.databank.base(a),this)},prefix:function(a,b){return void 0===b?this.databank.prefix(a):(this.databank.prefix(a,b),this)},add:function(b,c){var d,e;if(void 0!==b.rdfquery){if(b.top)return e=this.databank.add(b.databank),d=a.rdf({parent:this.parent,databank:e});if(this.top)return e=b.databank.add(this.databank),d=a.rdf({parent:b.parent,databank:e});if(void 0===this.union)return d=a.rdf({union:[this,b]}),this.partOf.push(d),b.partOf.push(d),d;this.union.push(b),b.partOf.push(this)}else"string"==typeof b&&(c=a.extend({},{base:this.base(),namespaces:this.prefix(),source:b},c),b=a.rdf.pattern(b,c)),b.isFixed()?this.databank.add(b.triple(),c):(d=this,this.each(function(a,e){var f=b.triple(e);null!==f&&d.databank.add(f,c)}));return this},remove:function(b,c){return"string"==typeof b&&(c=a.extend({},{base:this.base(),namespaces:this.prefix()},c),b=a.rdf.pattern(b,c)),b.isFixed()?this.databank.remove(b.triple(),c):(query=this,this.each(function(a,d){var e=b.triple(d);null!==e&&query.databank.remove(e,c)})),this},load:function(a,b){var c=this,b=b||{},d=b.success;return void 0!==d&&(b.success=function(){d.call(c)}),this.databank.load(a,b),this},except:function(b){return a.rdf({databank:this.databank.except(b.databank)})},where:function(b,c){var d,e,f,g;return c=c||{},"string"==typeof b&&(e=c.base||this.base(),f=a.extend({},this.prefix(),c.namespaces||{}),g=c.optional||!1,b=a.rdf.pattern(b,{namespaces:f,base:e,optional:g})),d=a.rdf(a.extend({},c,{parent:this,filter:b})),this.children.push(d),d},optional:function(b,c){return this.where(b,a.extend({},c||{},{optional:!0}))},about:function(a,b){return this.where(a+" ?property ?value",b)},filter:function(b,c){var d,e;return d="string"==typeof b?c.constructor===RegExp?function(){return c.test(this[b].value)}:function(){return"literal"===this[b].type?this[b].value===c:this[b]===c}:b,e=a.rdf({parent:this,filter:d}),this.children.push(e),e},node:function(b){var c,d;return"?"===b.toString().substring(0,1)?(c=b.toString().substring(1),d=a.rdf({parent:this,navigate:c})):("string"==typeof b&&(b=u(b,{namespaces:this.prefix(),base:this.base()})),d=a.rdf({parent:this,nodes:[b]})),this.children.push(d),d},find:function(a){return this.where("?node "+a+" ?object",{navigate:"object"})},back:function(a){return this.where("?subject "+a+" ?node",{navigate:"subject"})},group:function(b){return a.isArray(b)||(b=[b]),a(M(this,b))},select:function(a){var b,c,d=[];for(b=0;b<this.length;b+=1)if(void 0===a)d[b]=this[b];else for(d[b]={},c=0;c<a.length;c+=1)d[b][a[c]]=this[b][a[c]];return d},describe:function(a){var b,c,d,e=[];for(b=0;b<a.length;b+=1)if(d=a[b],"?"===d.substring(0,1))for(d=d.substring(1),c=0;c<this.length;c+=1)e.push(this[c][d]);else e.push(d);return this.databank.describe(e)},eq:function(a){return this.filter(function(b){return b===a})},reset:function(){for(var a=this;void 0!==a.parent;)a=a.parent;return a},end:function(){return this.parent},size:function(){return this.length},sources:function(){return a(a.map(this.matches,function(a){return[a.triples]}))},dump:function(b){var c=a.map(this.matches,function(a){return a.triples});return b=a.extend({namespaces:this.databank.namespaces,base:this.databank.base},b||{}),a.rdf.dump(c,b)},get:function(b){return void 0===b?a.makeArray(this):this[b]},each:function(b){return a.each(this.matches,function(a,c){b.call(c.bindings,a,c.bindings,c.triples)}),this},map:function(b){return a(a.map(this.matches,function(a,c){return b.call(a.bindings,c,a.bindings,a.triples)}))},jquery:function(){return a(this)}},a.rdf.fn.init.prototype=a.rdf.fn,a.rdf.gleaners=[],a.rdf.parsers={},a.rdf.dump=function(b,c){var d,e,f,g=a.extend({},a.rdf.dump.defaults,c||{}),h=g.format,i=g.serialize;if(e=a.rdf.parsers[h],void 0===e){f=[];for(p in a.rdf.parsers)f.push(p);throw"Unrecognised dump format: "+h+". Expected one of "+f.join(", ")}return d=e.dump(b,g),i?e.serialize(d):d},a.rdf.dump.defaults={format:"application/json",serialize:!1,indent:!1,namespaces:{}},a.fn.rdf=function(b){var c=[],b=b||function(){return this};return a(this)[0]&&9===a(this)[0].nodeType?a(this).children("*").rdf(b):a(this).length>0?(c=a(this).map(function(c,d){return a.map(a.rdf.gleaners,function(c){return c.call(a(d),{callback:b})})}),a.rdf({triples:c,namespaces:a(this).xmlns()})):a.rdf()},a.extend(a.expr[":"],{about:function(b,c,d){var e=a(b),f=d[3]?e.safeCurie(d[3]):null,g=!1;return a.each(a.rdf.gleaners,function(a,b){return g=b.call(e,{about:f}),g?null:void 0}),g},type:function(b,c,d){var e=a(b),f=d[3]?e.curie(d[3]):null,g=!1;return a.each(a.rdf.gleaners,function(a,b){return b.call(e,{type:f})?(g=!0,null):void 0}),g}}),a.rdf.databank=function(b,c){return new a.rdf.databank.fn.init(b,c)},a.rdf.databank.fn=a.rdf.databank.prototype={init:function(b,c){var d;if(b=b||[],c=c||{},this.id=o(),q[this.id]=this,void 0===c.union)for(this.queries={},this.tripleStore=[],this.subjectIndex={},this.propertyIndex={},this.objectIndex={},this.baseURI=c.base||a.uri.base(),this.namespaces=a.extend({},c.namespaces||{}),d=0;d<b.length;d+=1)this.add(b[d]);else this.union=c.union;return this},base:function(b){return void 0===this.union?void 0===b?this.baseURI:(this.baseURI=b,this):void 0===b?this.union[0].base():(a.each(this.union,function(a,c){c.base(b)}),this)},prefix:function(b,c){var d={};return void 0===this.union?void 0===b?this.namespaces:void 0===c?this.namespaces[b]:(this.namespaces[b]=c,this):void 0===c?(a.each(this.union,function(b,c){a.extend(d,c.prefix())}),void 0===b?d:d[b]):(a.each(this.union,function(a,d){d.prefix(b,c)}),this)},add:function(b,c){var d,e=c&&c.base||this.base(),f=a.extend({},this.prefix(),c&&c.namespaces||{}),g=c&&c.depth||a.rdf.databank.defaults.depth,h=c&&c.proxy||a.rdf.databank.defaults.proxy;return b===this?this:void 0!==b.subjectIndex?void 0===this.union?d=a.rdf.databank(void 0,{union:[this,b]}):(this.union.push(b),this):("string"==typeof b&&(b=a.rdf.triple(b,{namespaces:f,base:e,source:b})),void 0===this.union?(void 0===this.subjectIndex[b.subject]&&(this.subjectIndex[b.subject]=[],g>0&&"uri"===b.subject.type&&this.load(b.subject.value,{depth:g-1,proxy:h})),void 0===this.propertyIndex[b.property]&&(this.propertyIndex[b.property]=[],g>0&&this.load(b.property.value,{depth:g-1,proxy:h})),-1===a.inArray(b,this.subjectIndex[b.subject])&&(this.tripleStore.push(b),this.subjectIndex[b.subject].push(b),this.propertyIndex[b.property].push(b),("uri"===b.object.type||"bnode"===b.object.type)&&(void 0===this.objectIndex[b.object]&&(this.objectIndex[b.object]=[],g>0&&"uri"===b.object.type&&this.load(b.object.value,{depth:g-1,proxy:h})),this.objectIndex[b.object].push(b)),K(this,b))):a.each(this.union,function(a,c){c.add(b)}),this)},remove:function(b,c){var d,e,f,g=c&&c.base||this.base(),h=a.extend({},this.prefix(),c&&c.namespaces||{});return"string"==typeof b&&(b=a.rdf.triple(b,{namespaces:h,base:g,source:b})),this.tripleStore.splice(a.inArray(b,this.tripleStore),1),d=this.subjectIndex[b.subject],void 0!==d&&(d.splice(a.inArray(b,d),1),0===a(d).size()&&delete this.subjectIndex[b.subject]),e=this.propertyIndex[b.property],void 0!==e&&(e.splice(a.inArray(b,e),1),0===a(e).size()&&delete this.propertyIndex[b.property]),("uri"===b.object.type||"bnode"===b.object.type)&&(f=this.objectIndex[b.object],void 0!==f&&(f.splice(a.inArray(b,f),1),0===a(f).size()&&delete this.objectIndex[b.object])),L(this,b),this},except:function(b){var c=b.subjectIndex,d=[];return a.each(this.subjectIndex,function(b,e){var f=c[b];void 0===f?d=d.concat(e):a.each(e,function(b,c){-1===a.inArray(c,f)&&d.push(c)})}),a.rdf.databank(d)},triples:function(){var b=[];return void 0===this.union?b=this.tripleStore:(a.each(this.union,function(a,c){b=b.concat(c.triples().get())}),b=P(b)),a(b)},size:function(){return this.triples().length},describe:function(b){for(var c,d,e,f={},g=[];b.length>0;)if(d=b.pop(),void 0===f[d]){if(void 0===d.value&&(d=a.rdf.resource(d)),void 0!==this.subjectIndex[d])for(c=0;c<this.subjectIndex[d].length;c+=1)e=this.subjectIndex[d][c],g.push(e),"bnode"===e.object.type&&b.push(e.object);if(void 0!==this.objectIndex[d])for(c=0;c<this.objectIndex[d].length;c+=1)e=this.objectIndex[d][c],g.push(e),"bnode"===e.subject.type&&b.push(e.subject);f[d]=!0}return P(g)},dump:function(b){return b=a.extend({namespaces:this.namespaces,base:this.base},b||{}),a.rdf.dump(this.triples(),b)},load:function(b,c){var d,e,f,g,h,i,j=c&&c.format,k=c&&c.async||a.rdf.databank.defaults.async,l=c&&c.success||a.rdf.databank.defaults.success,m=c&&c.error||a.rdf.databank.defaults.error,n=c&&c.proxy||a.rdf.databank.defaults.proxy,o=c&&c.depth||a.rdf.databank.defaults.depth;if(f="string"==typeof b&&"http://"===b.substring(1,7)?a.uri(b):b,f.scheme)return N(this,f,{success:l,error:m})||(g='<script type="text/javascript" src="'+n+"?id="+this.id+"&amp;depth="+o+"&amp;url="+encodeURIComponent(f.resolve("").toString())+'"></script>',k?setTimeout("$('head').append('"+g+"')",0):a("head").append(g)),this;for(void 0===j&&("string"==typeof b?j="{"===b.substring(0,1)?"application/json":"<!DOCTYPE html"===b.substring(0,14)||"<html"===b.substring(0,5)?"application/xhtml+xml":"<?xml"===b.substring(0,5)||"<rdf:RDF"===b.substring(0,8)?"application/rdf+xml":"text/turtle":b.documentElement||b.ownerDocument?(i=b.documentElement?b.documentElement:b.ownerDocument.documentElement,j="html"===i.nodeName?"application/xhtml+xml":"application/rdf+xml"):j="application/json"),h=a.rdf.parsers[j],"string"==typeof b&&(b=h.parse(b)),e=h.triples.call(this,b),d=0;d<e.length;d+=1)this.add(e[d],c);return this},toString:function(){return"[Databank with "+this.size()+" triples]"}},a.rdf.databank.fn.init.prototype=a.rdf.databank.fn,a.rdf.databank.defaults={parse:!1,async:!0,success:null,error:null,depth:0,proxy:"http://www.jenitennison.com/rdfquery/proxy.php"},a.rdf.databank.load=function(a,b,c,d){void 0!==c&&q[a].load(c,d),O(q[a],b,void 0===c?"error":"success",d)},a.rdf.pattern=function(b,c,d,e){var g,h,i;if(void 0===d){if(e=c||{},h=a.trim(b).match(l),3!==h.length&&(4!==h.length||"."!==h[3]))throw"Bad Pattern: Couldn't parse string "+b;b=h[0],c=h[1],d=h[2],i=void 0===e.optional?a.rdf.pattern.defaults.optional:e.optional}return f[b]&&f[b][c]&&f[b][c][d]&&f[b][c][d][i]?f[b][c][d][i]:(g=new a.rdf.pattern.fn.init(b,c,d,e),f[g.subject]&&f[g.subject][g.property]&&f[g.subject][g.property][g.object]&&f[g.subject][g.property][g.object][g.optional]?f[g.subject][g.property][g.object][g.optional]:(void 0===f[g.subject]&&(f[g.subject]={}),void 0===f[g.subject][g.property]&&(f[g.subject][g.property]={}),void 0===f[g.subject][g.property][g.object]&&(f[g.subject][g.property][g.object]={}),f[g.subject][g.property][g.object][g.optional]=g,g))},a.rdf.pattern.fn=a.rdf.pattern.prototype={init:function(b,c,d,e){var f=a.extend({},a.rdf.pattern.defaults,e);return this.subject="?"===b.toString().substring(0,1)?b:s(b,f),this.property="?"===c.toString().substring(0,1)?c:t(c,f),this.object="?"===d.toString().substring(0,1)?d:u(d,f),this.optional=f.optional,this},fill:function(b){var c=this.subject,d=this.property,e=this.object;return"string"==typeof c&&b[c.substring(1)]&&(c=b[c.substring(1)]),"string"==typeof d&&b[d.substring(1)]&&(d=b[d.substring(1)]),"string"==typeof e&&b[e.substring(1)]&&(e=b[e.substring(1)]),a.rdf.pattern(c,d,e,{optional:this.optional})},exec:function(a){var b={};return b=w(a.subject,this.subject,b),null===b?null:(b=w(a.property,this.property,b),null===b?null:b=w(a.object,this.object,b))},isFixed:function(){return"string"!=typeof this.subject&&"string"!=typeof this.property&&"string"!=typeof this.object},triple:function(b){var c=this;return this.isFixed()||(c=this.fill(b)),c.isFixed()?a.rdf.triple(c.subject,c.property,c.object,{source:this.toString()}):null
},toString:function(){return this.subject+" "+this.property+" "+this.object}},a.rdf.pattern.fn.init.prototype=a.rdf.pattern.fn,a.rdf.pattern.defaults={base:a.uri.base(),namespaces:{},optional:!1},a.rdf.triple=function(b,c,d,f){var g,h,i;if(void 0===d){if(f=c,i=a.trim(b).match(l),3!==i.length&&(4!==i.length||"."!==i[3]))throw"Bad Triple: Couldn't parse string "+b;b=i[0],c=i[1],d=i[2]}return h=f&&f.graph||"",e[h]&&e[h][b]&&e[h][b][c]&&e[h][b][c][d]?e[h][b][c][d]:(g=new a.rdf.triple.fn.init(b,c,d,f),h=g.graph||"",e[h]&&e[h][g.subject]&&e[h][g.subject][g.property]&&e[h][g.subject][g.property][g.object]?e[h][g.subject][g.property][g.object]:(void 0===e[h]&&(e[h]={}),void 0===e[h][g.subject]&&(e[h][g.subject]={}),void 0===e[h][g.subject][g.property]&&(e[h][g.subject][g.property]={}),e[h][g.subject][g.property][g.object]=g,g))},a.rdf.triple.fn=a.rdf.triple.prototype={init:function(b,c,d,e){var f;return f=a.extend({},a.rdf.triple.defaults,e),this.subject=s(b,f),this.property=t(c,f),this.object=u(d,f),this.graph=void 0===f.graph?void 0:s(f.graph,f),this.source=f.source,this},isFixed:function(){return!0},triple:function(){return this},dump:function(){var a={},b=this.subject.value.toString(),c=this.property.value.toString();return a[b]={},a[b][c]=this.object.dump(),a},toString:function(){return this.subject+" "+this.property+" "+this.object+" ."}},a.rdf.triple.fn.init.prototype=a.rdf.triple.fn,a.rdf.triple.defaults={base:a.uri.base(),source:[document],namespaces:{}},a.rdf.resource=function(c,d){var e;return b[c]?b[c]:(e=new a.rdf.resource.fn.init(c,d),b[e]?b[e]:(b[e]=e,e))},a.rdf.resource.fn=a.rdf.resource.prototype={type:"uri",value:void 0,init:function(b,c){var d,e,f,g;if("string"==typeof b)if(d=j.exec(b),g=a.extend({},a.rdf.resource.defaults,c),null!==d)this.value=a.uri.resolve(d[1].replace(/\\>/g,">"),g.base);else if(":"===b.substring(0,1)){if(f=g.namespaces[""],void 0===f)throw"Malformed Resource: No namespace binding for default namespace in "+b;this.value=a.uri.resolve(f+b.substring(1))}else if(":"===b.substring(b.length-1)){if(e=b.substring(0,b.length-1),f=g.namespaces[e],void 0===f)throw"Malformed Resource: No namespace binding for prefix "+e+" in "+b;this.value=a.uri.resolve(f)}else try{this.value=a.curie(b,{namespaces:g.namespaces})}catch(h){throw"Malformed Resource: Bad format for resource "+h}else this.value=b;return this},dump:function(){return{type:"uri",value:this.value.toString()}},toString:function(){return"<"+this.value+">"}},a.rdf.resource.fn.init.prototype=a.rdf.resource.fn,a.rdf.resource.defaults={base:a.uri.base(),namespaces:{}},a.rdf.type=a.rdf.resource("<"+h+"type>"),a.rdf.label=a.rdf.resource("<"+i+"label>"),a.rdf.first=a.rdf.resource("<"+h+"first>"),a.rdf.rest=a.rdf.resource("<"+h+"rest>"),a.rdf.nil=a.rdf.resource("<"+h+"nil>"),a.rdf.subject=a.rdf.resource("<"+h+"subject>"),a.rdf.property=a.rdf.resource("<"+h+"property>"),a.rdf.object=a.rdf.resource("<"+h+"object>"),a.rdf.blank=function(b){var d;return c[b]?c[b]:(d=new a.rdf.blank.fn.init(b),c[d]?c[d]:(c[d]=d,d))},a.rdf.blank.fn=a.rdf.blank.prototype={type:"bnode",value:void 0,id:void 0,init:function(a){if("[]"===a)this.id=n(),this.value="_:"+this.id;else{if("_:"!==a.substring(0,2))throw"Malformed Blank Node: "+a+" is not a legal format for a blank node";this.id=a.substring(2),this.value=a}return this},dump:function(){return{type:"bnode",value:this.value}},toString:function(){return this.value}},a.rdf.blank.fn.init.prototype=a.rdf.blank.fn,a.rdf.literal=function(b,c){var e;return d[b]?d[b]:(e=new a.rdf.literal.fn.init(b,c),d[e]?d[e]:(d[e]=e,e))},a.rdf.literal.fn=a.rdf.literal.prototype={type:"literal",value:void 0,lang:void 0,datatype:void 0,init:function(b,c){var d,e,f=a.extend({},a.rdf.literal.defaults,c);if(e=a.safeCurie(f.datatype,{namespaces:f.namespaces}),void 0!==f.lang&&void 0!==f.datatype&&e.toString()!==h+"XMLLiteral")throw"Malformed Literal: Cannot define both a language and a datatype for a literal ("+b+")";if(void 0!==f.datatype)e=a.safeCurie(f.datatype,{namespaces:f.namespaces}),a.extend(this,a.typedValue(b.toString(),e)),e.toString()===h+"XMLLiteral"&&(this.lang=f.lang);else if(void 0!==f.lang)this.value=b.toString(),this.lang=f.lang;else if("boolean"==typeof b)a.extend(this,a.typedValue(b.toString(),g+"boolean"));else if("number"==typeof b)a.extend(this,a.typedValue(b.toString(),g+"double"));else if("true"===b||"false"===b)a.extend(this,a.typedValue(b,g+"boolean"));else if(a.typedValue.valid(b,g+"integer"))a.extend(this,a.typedValue(b,g+"integer"));else if(a.typedValue.valid(b,g+"decimal"))a.extend(this,a.typedValue(b,g+"decimal"));else if(a.typedValue.valid(b,g+"double")&&!/^\s*([\-\+]?INF|NaN)\s*$/.test(b))a.extend(this,a.typedValue(b,g+"double"));else{if(d=k.exec(b),null===d)throw"Malformed Literal: Couldn't recognise the value "+b;this.value=(d[2]||d[4]).replace(/\\"/g,'"').replace(/\\n/g,"\n").replace(/\\t/g,"	").replace(/\\r/g,"\r"),d[9]?(e=a.rdf.resource(d[9],f),a.extend(this,a.typedValue(this.value,e.value))):d[7]&&(this.lang=d[7])}return this},dump:function(){var a={type:"literal",value:this.value.toString()};return void 0!==this.lang?a.lang=this.lang:void 0!==this.datatype&&(a.datatype=this.datatype.toString()),a},toString:function(){var a='"'+this.value+'"';return void 0!==this.lang?a+="@"+this.lang:void 0!==this.datatype&&(a+="^^<"+this.datatype+">"),a}},a.rdf.literal.fn.init.prototype=a.rdf.literal.fn,a.rdf.literal.defaults={base:a.uri.base(),namespaces:{},datatype:void 0,lang:void 0}}(jQuery),function(a){a.rdf.parsers["application/json"]={parse:a.secureEvalJSON,serialize:a.toJSON,triples:function(b){var c,d,e,f,g,h,i,j,k=[];for(c in b){d="_:"===c.substring(0,2)?a.rdf.blank(c):a.rdf.resource("<"+c+">",{base:this.baseURI});for(e in b[c])for(f=a.rdf.resource("<"+e+">",{base:this.baseURI}),i=0;i<b[c][e].length;i+=1){if(g=b[c][e][i],"uri"===g.type)h=a.rdf.resource("<"+g.value+">",{base:this.baseURI});else if("bnode"===g.type)h=a.rdf.blank(g.value);else if(void 0!==g.datatype)h=a.rdf.literal(g.value,{datatype:g.datatype,base:this.baseURI});else{j={},void 0!==g.lang&&(j.lang=g.lang);var l="string"==typeof g.value?g.value.replace(/\"/g,'\\"'):g.value;j.base=this.baseURI,h=a.rdf.literal('"'+l+'"',j)}k.push(a.rdf.triple(d,f,h))}}return k},dump:function(a){var b,c,d,e,f={};for(b=0;b<a.length;b+=1)c=a[b],d=c.subject.value.toString(),e=c.property.value.toString(),void 0===f[d]&&(f[d]={}),void 0===f[d][e]&&(f[d][e]=[]),f[d][e].push(c.object.dump());return f}}}(jQuery),function(a){var b="http://www.w3.org/1999/02/22-rdf-syntax-ns#",c=function(a,b,c,d){var e,f=a.ownerDocument;return void 0!==b&&null!==b?f.createAttributeNS?(e=f.createAttributeNS(b,c),e.nodeValue=d,a.attributes.setNamedItemNS(e)):(e=f.createNode(2,c,b),e.nodeValue=d,a.attributes.setNamedItem(e)):(e=f.createAttribute(c),e.nodeValue=d,a.attributes.setNamedItem(e)),a},d=function(a,b,d){return"http://www.w3.org/XML/1998/namespace"===b||"http://www.w3.org/2000/xmlns/"===b||(d?c(a,"http://www.w3.org/2000/xmlns/","xmlns:"+d,b):c(a,void 0,"xmlns",b)),a},e=function(a,b){var c,e,f="",g=!1;return void 0!==a&&null!==a&&(/:/.test(b)&&(e=/([^:]+):/.exec(b)[1]),g=!0),document.implementation&&document.implementation.createDocument?(c=document.implementation.createDocument(a,b,null),g&&d(c.documentElement,a,e),c):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",f=void 0===e?' xmlns="'+a+'"':" xmlns:"+e+'="'+a+'"',c.loadXML("<"+b+f+"/>"),c)},f=function(a,b,c,d){var e,f=a.ownerDocument;return e=void 0!==b&&null!==b?f.createElementNS?f.createElementNS(b,c):f.createNode(1,c,b):f.createElement(c),-1!==d&&(g(a,"\n"),0===d?g(a,"\n"):g(a,"  ")),a.appendChild(e),e},g=function(a,b){var c,d=a.ownerDocument;return c=d.createTextNode(b),a.appendChild(c),a},h=function(a,b){var c,d,e;try{d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML("<temp>"+b+"</temp>")}catch(f){c=new DOMParser,d=c.parseFromString("<temp>"+b+"</temp>","text/xml")}for(e=0;e<d.documentElement.childNodes.length;e+=1)a.appendChild(d.documentElement.childNodes[e].cloneNode(!0));return a},i=function(i,j){var k,l,m,n,o,p,q,r,s,t,u,v=e(b,"rdf:RDF"),w=a.rdf.parsers["application/json"].dump(i),x=j.namespaces||{},y=j.indent||!1;for(k in x)d(v.documentElement,x[k],k);for(l in w){if(void 0!==w[l][a.rdf.type.value]){r=/(.+[#\/])([^#\/]+)/.exec(w[l][a.rdf.type.value][0].value),t=r[1],s=r[2];for(k in x)if(x[k].toString()===t){u=k;break}m=f(v.documentElement,t,u+":"+s,y?0:-1)}else m=f(v.documentElement,b,"rdf:Description",y?0:-1);/^_:/.test(l)?c(m,b,"rdf:nodeID",l.substring(2)):c(m,b,"rdf:about",l);for(n in w[l])if(n!==a.rdf.type.value.toString()||w[l][n].length>1){r=/(.+[#\/])([^#\/]+)/.exec(n),t=r[1],s=r[2];for(k in x)if(x[k].toString()===t){u=k;break}for(p=n===a.rdf.type.value.toString()?1:0;p<w[l][n].length;p+=1)q=w[l][n][p],o=f(m,t,u+":"+s,y?1:-1),"uri"===q.type?c(o,b,"rdf:resource",q.value):"literal"===q.type?void 0!==q.datatype?"http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral"===q.datatype?(c(o,b,"rdf:parseType","Literal"),y&&g(o,"\n    "),h(o,q.value),y&&g(o,"\n  ")):(c(o,b,"rdf:datatype",q.datatype),g(o,q.value)):void 0!==q.lang?(c(o,"http://www.w3.org/XML/1998/namespace","xml:lang",q.lang),g(o,q.value)):g(o,q.value):c(o,b,"rdf:nodeID",q.value.substring(2));y&&g(m,"\n")}}return y&&g(v.documentElement,"\n\n"),v},j=function(a){switch(a){case"http://www.w3.org/1999/02/22-rdf-syntax-ns":return"rdf";case"http://www.w3.org/XML/1998/namespace":return"xml";case"http://www.w3.org/2000/xmlns/":return"xmlns";default:throw"No default prefix mapped for namespace "+a}},k=function(a,b,c){var d;if(a.hasAttributeNS)return a.hasAttributeNS(b,c);try{return d=/:/.test(c)?/:(.+)$/.exec(c)[1]:c,null!==a.attributes.getQualifiedItem(d,b)}catch(e){return null!==a.getAttribute(j(b)+":"+c)}},l=function(a,b,c){var d;if(a.getAttributeNS)return a.getAttributeNS(b,c);try{return d=/:/.test(c)?/:(.+)$/.exec(c)[1]:c,a.attributes.getQualifiedItem(d,b).nodeValue}catch(e){return a.getAttribute(j(b)+":"+c)}},m=function(a){return a.localName||a.baseName},n=function(c,d){var e,f;return k(c,b,"about")?(e=l(c,b,"about"),f=a.rdf.resource("<"+e+">",{base:d})):k(c,b,"ID")?(e=l(c,b,"ID"),f=a.rdf.resource("<#"+e+">",{base:d})):k(c,b,"nodeID")?(e=l(c,b,"nodeID"),f=a.rdf.blank("_:"+e)):f=a.rdf.blank("[]"),f},o=function(c,d,e,f){var g,h,i,j,p,q,f,r,s,t,u,v,w,x,y,z=1,A=[],B={},C=[];for(f=l(c,"http://www.w3.org/XML/1998/namespace","lang")||f,e=l(c,"http://www.w3.org/XML/1998/namespace","base")||e,null!==f&&void 0!==f&&""!==f&&(B={lang:f}),g=n(c,e),!d||c.namespaceURI===b&&"Description"===m(c)||(i=a.rdf.type,p=a.rdf.resource("<"+c.namespaceURI+m(c)+">"),C.push(a.rdf.triple(g,i,p))),r=0;r<c.attributes.length;r+=1)h=c.attributes.item(r),void 0!==h.namespaceURI&&"http://www.w3.org/2000/xmlns/"!==h.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==h.namespaceURI&&"xmlns"!==h.prefix&&"xml"!==h.prefix&&(h.namespaceURI!==b?(i=a.rdf.resource("<"+h.namespaceURI+m(h)+">"),p=a.rdf.literal(B.lang?h.nodeValue:'"'+h.nodeValue.replace(/"/g,'\\"')+'"',B),C.push(a.rdf.triple(g,i,p))):"type"===m(h)&&(i=a.rdf.type,p=a.rdf.resource("<"+h.nodeValue+">",{base:e}),C.push(a.rdf.triple(g,i,p))));var D=f;for(r=0;r<c.childNodes.length;r+=1)if(h=c.childNodes[r],1===h.nodeType){if(h.namespaceURI===b&&"li"===m(h)?(i=a.rdf.resource("<"+b+"_"+z+">"),z+=1):i=a.rdf.resource("<"+h.namespaceURI+m(h)+">"),f=l(h,"http://www.w3.org/XML/1998/namespace","lang")||D,B=null!==f&&void 0!==f&&""!==f?{lang:f}:{},k(h,b,"resource"))j=l(h,b,"resource"),p=a.rdf.resource("<"+j+">",{base:e});else if(k(h,b,"nodeID"))j=l(h,b,"nodeID"),p=a.rdf.blank("_:"+j);else if(k(h,b,"parseType")){if(w=l(h,b,"parseType"),"Literal"===w){try{x=new XMLSerializer,j=x.serializeToString(h.getElementsByTagName("*")[0])}catch(E){for(j="",s=0;s<h.childNodes.length;s+=1)j+=h.childNodes[s].xml}p=a.rdf.literal(j,{datatype:b+"XMLLiteral"})}else if("Resource"===w)y=o(h,!1,e,f),y.length>0?(p=y[y.length-1].subject,C=C.concat(y)):p=a.rdf.blank("[]");else if("Collection"===w)if(h.getElementsByTagName("*").length>0){for(s=0;s<h.childNodes.length;s+=1)j=h.childNodes[s],1===j.nodeType&&A.push(j);for(t=a.rdf.blank("[]"),p=t,s=0;s<A.length;s+=1)j=A[s],y=o(j,!0,e,f),y.length>0?(v=y[y.length-1].subject,C=C.concat(y)):v=n(j),C.push(a.rdf.triple(t,a.rdf.first,v)),s===A.length-1?C.push(a.rdf.triple(t,a.rdf.rest,a.rdf.nil)):(u=a.rdf.blank("[]"),C.push(a.rdf.triple(t,a.rdf.rest,u)),t=u)}else p=a.rdf.nil}else if(k(h,b,"datatype"))j=h.childNodes[0].nodeValue?h.childNodes[0].nodeValue:"",p=a.rdf.literal(j,{datatype:l(h,b,"datatype")});else if(h.getElementsByTagName("*").length>0)for(s=0;s<h.childNodes.length;s+=1)j=h.childNodes[s],1===j.nodeType&&(y=o(j,!0,e,f),y.length>0?(p=y[y.length-1].subject,C=C.concat(y)):p=n(j));else h.childNodes.length>0?(j=h.childNodes[0].nodeValue,p=a.rdf.literal(B.lang?j:'"'+j.replace(/"/g,'\\"')+'"',B)):(y=o(h,!1,e,f),y.length>0?(p=y[y.length-1].subject,C=C.concat(y)):p=a.rdf.blank("[]"));C.push(a.rdf.triple(g,i,p)),k(h,b,"ID")&&(q=a.rdf.resource("<#"+l(h,b,"ID")+">",{base:e}),C.push(a.rdf.triple(q,a.rdf.subject,g)),C.push(a.rdf.triple(q,a.rdf.property,i)),C.push(a.rdf.triple(q,a.rdf.object,p)))}return C},p=function(c){var d,e=[];return c.documentElement.namespaceURI===b&&"RDF"===m(c.documentElement)?(d=l(c.documentElement,"http://www.w3.org/XML/1998/namespace","lang"),base=l(c.documentElement,"http://www.w3.org/XML/1998/namespace","base")||a.uri.base(),e=a.map(c.documentElement.childNodes,function(a){return 1===a.nodeType?o(a,!0,base,d):null})):e=o(c.documentElement,!0),e};a.rdf.parsers["application/rdf+xml"]={parse:function(a){var b;try{b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)}catch(c){var d=new DOMParser;b=d.parseFromString(a,"text/xml")}return b},serialize:function(a){return a.xml?a.xml.replace(/\s+$/,""):(serializer=new XMLSerializer,serializer.serializeToString(a))},triples:p,dump:i}}(jQuery),function(a){var b={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",xsd:"http://www.w3.org/2001/XMLSchema#",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},c=b.rdf+"XMLLiteral",d=a.fn.curie.defaults,e=["alternate","appendix","bookmark","cite","chapter","contents","copyright","first","glossary","help","icon","index","last","license","meta","next","p3pv1","prev","role","section","stylesheet","subsection","start","top","up"],f=/\s([^ =]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|([^ >]+))/g,g="[-A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�က0-F.0-9·̀-ͯ‿-⁀]",h="[A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣一-龥〇〡-〩_]",j=new RegExp("^"+h+g+"*$"),k=a.rdf.resource("<>"),l=function(a){var b,c,d="";if(!/&/.test(a))return a;for(;a.length>0;){if(b=/([^&]*)(&([^;]+);)(.*)/g.exec(a),null===b){d+=a;break}if(d+=b[1],c=b[3],a=b[4],"#"===c.charAt(0))d+="x"===c.charAt(1)?String.fromCharCode(parseInt(c.substring(2),16)):String.fromCharCode(parseInt(c.substring(1),10));else switch(c){case"amp":d+="&";break;case"nbsp":d+=String.fromCharCode(160);break;case"quot":d+='"';break;case"apos":d+="'";break;default:d+="&"+c+";"}}return d},m=function(c){var d,e,g,h,i,k,m,n,o={},p={};if(e=c[0],p[":length"]=0,e.attributes&&e.attributes.getNamedItemNS)for(m=e.attributes,d=0;d<m.length;d+=1)g=m[d],/^xmlns(:(.+))?$/.test(g.nodeName)&&""!==g.nodeValue?(n=/^xmlns(:(.+))?$/.exec(g.nodeName)[2]||"",!j.test(n)||"xml"===n&&g.nodeValue!==b.xml||g.nodeValue===b.xml&&"xml"!==n||"xmlns"===n||g.nodeValue===b.xmlns||(p[n]=a.uri(g.nodeValue),p[":length"]+=1)):/rel|rev|lang|xml:lang|about|href|src|resource|property|typeof|content|datatype/.test(g.nodeName)&&(o[g.nodeName]=null===g.nodeValue?void 0:g.nodeValue);else{for(h=/<[^>]+>/.exec(e.outerHTML),g=f.exec(h);null!==g;)i=g[1],k=g[2]||g[3]||g[4],/^xmlns/.test(i)&&"xmlns:"!==i&&""!==k?(n=/^xmlns(:(.+))?$/.exec(i)[2]||"",!j.test(n)||"xml"===n&&g.nodeValue!==b.xml||g.nodeValue===b.xml&&"xml"!==n||"xmlns"===n||g.nodeValue===b.xmlns||(p[n]=a.uri(k),p[":length"]+=1)):/about|href|src|resource|property|typeof|content|datatype|rel|rev|lang|xml:lang/.test(i)&&(o[i]=l(k)),g=f.exec(h);f.lastIndex=0}return{atts:o,namespaces:p}},n=function(a,b){var c=a[0].getAttribute(b);return null===c?void 0:c},o=function(b){return a.rdf.resource(b)},p=function(b,c,d,e){if("_:"===b.substring(0,2))return d?void 0:a.rdf.blank(b);try{return o(a.curie(b,e))}catch(f){return void 0}},q=function(b,c,d){var e=/^\[(.*)\]$/.exec(b),f=d.base||c.base();return e?p(e[1],c,!1,d):o(a.uri(b,f))},r=function(a,b,c,d){var e,f,g=[];for(a=a&&a.split?a.split(/[ \t\n\r\x0C]+/g):[],e=0;e<a.length;e+=1)""!==a[e]&&(f=p(a[e],b,c,d),void 0!==f&&g.push(f));return g},s=function(b,c,d){var e,f,g=[];for(c="uri"===c.type?c:a.rdf.resource(c,d),b=b&&b.split?b.split(/\s+/):[],e=0;e<b.length;e+=1)""!==b[e]&&(f=p(b[e],null,!1,d),f!==c&&g.push(b[e]));return g.reverse().join(" ")},t=function(b,c,e){var f,g,h,i;return c=c||{},h=c.atts||m(b).atts,f=void 0===e?void 0!==h.rel||void 0!==h.rev:e,g=h.resource,g=void 0===g?h.href:g,void 0===g?g=f?a.rdf.blank("[]"):g:(i=c.curieOptions||a.extend({},d,{namespaces:b.xmlns()}),g=q(g,b,i)),g},u=function(b,c,e){var f,g,h,i,j=!1;return c=c||{},g=c.atts||m(b).atts,h=c.curieOptions||a.extend({},d,{namespaces:b.xmlns(),base:b.base()}),f=void 0===e?void 0!==g.rel||void 0!==g.rev:e,void 0!==g.about&&(i=q(g.about,b,h)),void 0===i&&void 0!==g.src&&(i=q(g.src,b,h)),f||void 0!==i||void 0===g.resource||(i=q(g.resource,b,h)),f||void 0!==i||void 0===g.href||(i=q(g.href,b,h)),void 0===i&&(/^(head|body)$/i.test(b[0].nodeName)?i=k:void 0!==g["typeof"]?i=a.rdf.blank("[]"):1===b[0].parentNode.nodeType?(i=c.object||t(b.parent())||u(b.parent()).subject,j=!f&&void 0===g.property):i=k),{subject:i,skip:j}},v=function(a,b){var c;if(b=b||{},b.atts)c=b.atts.lang,c=c||b.atts["xml:lang"];else{c=a[0].getAttribute("lang");try{c=null===c||""===c?a[0].getAttribute("xml:lang"):c}catch(d){}c=null===c||""===c?void 0:c}return void 0===c&&(b.lang?c=b.lang:1===a[0].parentNode.nodeType&&(c=v(a.parent()))),c},w=function(a){switch(a){case"<":return"&lt;";case'"':return"&quot;";case"&":return"&amp;"}},x=function(b,c){var d,e,g,h,i,j,k="";return b.contents().each(function(){var b=a(this),l=b[0];if(1===l.nodeType){if(h=l.nodeName.toLowerCase(),k+="<"+h,l.outerHTML){for(j=/<[^>]+>/.exec(l.outerHTML),g=f.exec(j);null!==g;)/^jQuery/.test(g[1])||(k+=" "+g[1]+"=",k+=g[2]?g[3]:'"'+g[1]+'"'),g=f.exec(j);f.lastIndex=0}else for(e=l.attributes,d=0;d<e.length;d+=1)g=e.item(d),k+=" "+g.nodeName+'="',k+=g.nodeValue.replace(/[<"&]/g,w),k+='"';c||(i=b.xmlns(""),void 0!==i&&void 0===b.attr("xmlns")&&(k+=' xmlns="'+i+'"')),k+=">",k+=x(b,!0),k+="</"+h+">"}else 8===l.nodeType?(k+="<!--",k+=l.nodeValue,k+="-->"):k+=l.nodeValue}),k},y=function(b){var f,g,h,i,j,k,l,n,o,p,q,s,w,z,A,B,C,D,E,F,G,H,I=[],J=this.children();if(b=b||{},A=b.forward||[],B=b.backward||[],C=b.callback||function(){return this},E=m(this),F=E.atts,b.atts=F,G=b.namespaces||this.xmlns(),E.namespaces[":length"]>0){G=a.extend({},G);for(H in E.namespaces)":length"!==H&&(G[H]=E.namespaces[H])}if(b.curieOptions=a.extend({},d,{reserved:[],namespaces:G,base:this.base()}),D=a.extend({},b.curieOptions,{reserved:e}),g=u(this,b),i=v(this,b),g.skip)w=b.forward,z=b.backward,g=b.subject,h=b.object;else{if(g=g.subject,A.length>0||B.length>0){for(q=b.subject||u(this.parent()).subject,f=0;f<A.length;f+=1)p=a.rdf.triple(q,A[f],g,{source:this[0]}),p=C.call(p,this.get(0),p),void 0!==p&&null!==p&&(I=I.concat(p));for(f=0;f<B.length;f+=1)p=a.rdf.triple(g,B[f],q,{source:this[0]}),p=C.call(p,this.get(0),p),void 0!==p&&null!==p&&(I=I.concat(p))}for(h=t(this,b),n=r(F["typeof"],this,!1,b.curieOptions),f=0;f<n.length;f+=1)p=a.rdf.triple(g,a.rdf.type,n[f],{source:this[0]}),p=C.call(p,this.get(0),p),void 0!==p&&null!==p&&(I=I.concat(p));if(s=r(F.property,this,!0,b.curieOptions),s.length>0)for(j=F.datatype,k=F.content,l=this.text().replace(/"/g,'\\"'),void 0!==j&&""!==j?(j=a.curie(j,b.curieOptions),o=j.toString()===c?a.rdf.literal(x(this),{datatype:c}):void 0!==k?a.rdf.literal(k,{datatype:j}):a.rdf.literal(l,{datatype:j})):void 0!==k?o=void 0===i?a.rdf.literal('"'+k+'"'):a.rdf.literal(k,{lang:i}):0===J.length||""===j?(i=v(this,b),o=void 0===i?a.rdf.literal('"'+l+'"'):a.rdf.literal(l,{lang:i})):o=a.rdf.literal(x(this),{datatype:c}),f=0;f<s.length;f+=1)p=a.rdf.triple(g,s[f],o,{source:this[0]}),p=C.call(p,this.get(0),p),void 0!==p&&null!==p&&(I=I.concat(p));if(w=r(F.rel,this,!0,D),z=r(F.rev,this,!0,D),void 0!==F.resource||void 0!==F.href){if(void 0!==w)for(f=0;f<w.length;f+=1)p=a.rdf.triple(g,w[f],h,{source:this[0]}),p=C.call(p,this.get(0),p),void 0!==p&&null!==p&&(I=I.concat(p));if(w=[],void 0!==z)for(f=0;f<z.length;f+=1)p=a.rdf.triple(h,z[f],g,{source:this[0]}),p=C.call(p,this.get(0),p),void 0!==p&&null!==p&&(I=I.concat(p));z=[]}}return J.each(function(){I=I.concat(y.call(a(this),{forward:w,backward:z,subject:g,object:h||g,lang:i,namespaces:G,callback:C}))}),I},z=function(a){var b,c;return a&&void 0!==a.about?(c=m(this).atts,null===a.about?void 0!==c.property||void 0!==c.rel||void 0!==c.rev||void 0!==c["typeof"]:u(this,{atts:c}).subject.value===a.about):a&&void 0!==a.type?(b=n(this,"typeof"),void 0!==b?null===a.type?!0:this.curie(b)===a.type:!1):y.call(this,a)},A=1,B=function(d,e,f){var g,h,i;try{h=d.createCurie(f)}catch(j){f.toString()===c?(d.attr("xmlns:rdf",b.rdf),h="rdf:XMLLiteral"):(g=/^(.+[\/#])([^#]+)$/.exec(f),d.attr("xmlns:ns"+A,g[1]),h="ns"+A+":"+g[2],A+=1)}i=n(d,e),void 0!==i?-1===a.inArray(h,i.split(/\s+/))&&d.attr(e,i+" "+h):d.attr(e,h)},C=function(b,c,d){var e;e="bnode"===d.type?"[_:"+d.id+"]":a(b).base().relative(d.value),b.attr(c,e)},D=function(a,b){var c=u(a).subject;b!==c&&C(a,"about",b),a.removeData("rdfa.subject")},E=function(a,b){var c=t(a);b!==c&&C(a,"resource",b),a.removeData("rdfa.objectResource")},F=function(a,b){return a.wrapInner("<span></span>").children("span").attr("lang",b),a},G=function(b){var d,e,f,g,h,i,j,k,l,n,o,p,q,r=this.xmlns();if(h=this,q=m(this).atts,"string"==typeof b)b=a.rdf.triple(b,{namespaces:r,base:this.base()});else{if(b.rdfquery)return G.call(this,b.sources().get(0)),this;if(b.length){for(p=0;p<b.length;p+=1)G.call(this,b[p]);return this}}if(e=void 0!==q.rel||void 0!==q.rev,f=e||void 0!==q.property||void 0!==q["typeof"],"literal"!==b.object.type)i=u(this,{atts:q},!0).subject,k=t(this,{atts:q},!0),g=!f&&void 0===q.resource,j=i===b.subject,l=k===b.object,b.property===a.rdf.type?j?B(this,"typeof",b.object.value):f?(h=this.wrapInner("<span />").children("span"),B(h,"typeof",b.object.value),k!==b.subject&&D(h,b.subject)):(B(this,"typeof",b.object.value),D(this,b.subject)):j?l?B(this,"rel",b.property.value):g||!f?(B(this,"rel",b.property.value),E(this,b.object)):(h=this.wrap("<span />").parent(),B(h,"rev",b.property.value),D(h,b.object)):i===b.object?k===b.subject?B(this,"rev",b.property.value):g||!f?(B(this,"rev",b.property.value),E(this,b.subject)):(h=this.wrap("<span />").parent(),B(h,"rel",b.property.value),D(h,b.subject)):l?f?(h=this.wrapInner("<span />").children("span"),B(h,"rev",b.property.value),E(h,b.subject),h=h.wrapInner("<span />").children("span"),D(h,b.object),h=this):(D(this,b.subject),B(this,"rel",b.property.value)):k===b.subject?f?(h=this.wrapInner("<span />").children("span"),B(h,"rel",this.property.value),E(h,b.object),h=h.wrapInner("<span />").children("span"),D(h,k),h=this):(D(this,b.object),B(this,"rev",b.property.value)):f?(h=this.wrapInner("<span />").children("span"),B(h,"rel",b.property.value),D(h,b.subject),E(h,b.object),h.children("*").length>0&&(h=this.wrapInner("<span />").children("span"),D(h,i)),h=this):(B(h,"rel",b.property.value),D(this,b.subject),E(this,b.object),this.children("*").length>0&&(h=this.wrapInner("<span />").children("span"),D(h,i),h=this));else if(i=u(this,{atts:q}).subject,k=t(this,{atts:q}),j=i===b.subject,d=this.text()!==b.object.value,void 0!==q.property){if(o=q.content,l=void 0!==o?o===b.object.value:!d,!j||!l)return h=this.wrapInner("<span />").children("span"),G.call(h,b);B(this,"property",b.property.value)}else{if(k===b.subject)return h=this.wrapInner("<span />").children("span"),G.call(h,b);B(this,"property",b.property.value),D(this,b.subject),d&&(b.object.datatype&&b.object.datatype.toString()===c?this.html(b.object.value):this.attr("content",b.object.value)),n=v(this),b.object.lang?n!==b.object.lang&&(this.attr("lang",b.object.lang),d&&F(this,n)):b.object.datatype?B(this,"datatype",b.object.datatype):(d||this.attr("datatype",""),void 0!==n&&(this.attr("lang",""),d&&F(this,n)))}return this.parents().andSelf().trigger("rdfChange"),h},H=function(a){var b,c,d,e,f,g=this.xmlns();if(b=m(this).atts,a.length){for(i=0;i<a.length;i+=1)H.call(this,a[i]);return this}return hasRelation=void 0!==b.rel||void 0!==b.rev,hasRDFa=hasRelation||void 0!==b.property||void 0!==b["typeof"],hasRDFa&&(void 0!==a.property&&(void 0!==b.property&&(c=s(b.property,a.property,{namespaces:g}),""===c?this.removeAttr("property"):this.attr("property",c)),void 0!==b.rel&&(d=s(b.rel,a.property,{namespaces:g}),""===d?this.removeAttr("rel"):this.attr("rel",d)),void 0!==b.rev&&(e=s(b.rev,a.property,{namespaces:g}),""===e?this.removeAttr("rev"):this.attr("rev",e))),void 0!==a.type&&void 0!==b["typeof"]&&(f=s(b["typeof"],a.type,{namespaces:g}),""===f?this.removeAttr("typeof"):this.attr("typeof",f)),b.property===this.attr("property")&&b.rel===this.attr("rel")&&b.rev===this.attr("rev")&&b["typeof"]===this.attr("typeof"))?H.call(this.parent(),a):(this.parents().andSelf().trigger("rdfChange"),this)};a.fn.rdfa=function(b){if(void 0===b){var c=a.map(a(this),function(b){return y.call(a(b))});return a.rdf({triples:c})}return a(this).each(function(){G.call(a(this),b)}),this},a.fn.removeRdfa=function(b){return a(this).each(function(){H.call(a(this),b)}),this},a.rdf.gleaners.push(z)}(jQuery),function(a){var b=1;a.rdf.ruleset=function(b,c){return new a.rdf.ruleset.fn.init(b,c)},a.rdf.ruleset.fn=a.rdf.ruleset.prototype={init:function(b,c){var d,e=a.extend({},a.rdf.ruleset.defaults,c);for(b=b||[],this.baseURI=e.base,this.namespaces=a.extend({},e.namespaces),this.rules=[],d=0;d<b.length;d+=1)this.add.apply(this,b[d]);return this},base:function(a){return void 0===a?this.baseURI:(this.baseURI=a,this)},prefix:function(a,b){return void 0===a?this.namespaces:void 0===b?this.namespaces[a]:(this.namespaces[a]=b,this)},size:function(){return this.rules.length},add:function(b,c){var d;return void 0===c&&b.rules?this.rules=this.rules.concat(b.rules):(d=void 0===c&&b.lhs?b:a.rdf.rule(b,c,{namespaces:this.prefix(),base:this.base()}),-1===a.inArray(d,this.rules)&&this.rules.push(d)),this},run:function(b,c){var d,e,f,g=a.extend({limit:50},c),h=g.limit;do{for(f=b.size(),d=0;d<this.rules.length;d+=1)e=this.rules[d],e.run(b);h-=1}while(b.size()>f&&h>0);return this}},a.rdf.ruleset.fn.init.prototype=a.rdf.ruleset.fn,a.rdf.ruleset.defaults={base:a.uri.base(),namespaces:{}},a.rdf.rule=function(b,c,d){return new a.rdf.rule.fn.init(b,c,d)},a.rdf.rule.fn=a.rdf.rule.prototype={init:function(b,c,d){var e=a.extend({},a.rdf.rule.defaults,d),f=[],g=!1;return"string"==typeof b&&(b=[b]),"string"==typeof c&&(c=[c]),this.lhs=a.map(b,function(b){return a.isArray(b)?[b]:a.isFunction(b)?b:(b=a.rdf.pattern(b,e),"string"==typeof b.subject&&f.push(b.subject),"string"==typeof b.property&&f.push(b.property),"string"==typeof b.object&&f.push(b.object),b)}),f=a.unique(f),this.rhs=a.isFunction(c)?c:a.map(c,function(b){if(b=a.rdf.pattern(b,e),"string"==typeof b.subject&&-1===a.inArray(b.subject,f)||"string"==typeof b.property&&-1===a.inArray(b.property,f)||"string"==typeof b.object&&-1===a.inArray(b.object,f))throw"Bad Rule: Right-hand side of the rule contains a reference to an unbound wildcard";return("bnode"===b.subject.type||"bnode"===b.property.type||"bnode"===b.object.type)&&(g=!0),b}),this.rhsBlanks=g,this.cache={},this},run:function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.rdf({databank:c}),s=a.extend({limit:50},d),t=s.limit,u=this.rhsBlanks;for(void 0===this.cache[c.id]&&(this.cache[c.id]={}),g=0;g<this.lhs.length;g+=1)e=this.lhs[g],r=a.isArray(e)?r.filter.apply(r,e):a.isFunction(e)?r.filter.call(r,e):r.where(this.lhs[g]);do{for(f=r.length,o=r.sources(),g=0;f>g;g+=1){for(p=o[g],q=!0,n=this.cache[c.id],h=0;h<p.length;h+=1)void 0===n[p[h]]?n[p[h]]={}:h===p.length-1&&(q=!1),n=n[p[h]];if(q)if(m=r.eq(g),u){for(h=0;h<this.rhs.length;h+=1)i=this.rhs[h],j=i.subject,k=i.property,l=i.object,"bnode"===j.type&&(j=a.rdf.blank(""+j+b)),"bnode"===k.type&&(k=a.rdf.blank(""+k+b)),"bnode"===l.type&&(l=a.rdf.blank(""+l+b)),i=a.rdf.pattern(j,k,l),m.add(i);b+=1}else if(a.isFunction(this.rhs))for(var v=m.map(this.rhs),w=0;w<v.length;w++)v[w]instanceof a.rdf.triple&&r.add(v[w]);else for(h=0;h<this.rhs.length;h+=1)m.add(this.rhs[h])}t-=1}while(r.length>f&&t>0);return this}},a.rdf.rule.fn.init.prototype=a.rdf.rule.fn,a.rdf.rule.defaults={base:a.uri.base(),namespaces:{}},a.extend(a.rdf.databank.fn,{reason:function(a,b){return a.run(this,b),this}}),a.extend(a.rdf.fn,{reason:function(a,b){return a.run(this.databank,b),this}})}(jQuery),function(){var a=this,b=a.jQuery,c=a.Backbone,d=a._,e=a.VIE=function(a){this.config=a?a:{},this.services={},this.jQuery=b,this.entities=new this.Collection([],{vie:this}),this.Entity.prototype.entities=this.entities,this.Entity.prototype.entityCollection=this.Collection,this.Entity.prototype.vie=this,this.Namespaces.prototype.vie=this,this.namespaces=new this.Namespaces(this.config.baseNamespace?this.config.baseNamespace:"http://viejs.org/ns/",{owl:"http://www.w3.org/2002/07/owl#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",schema:"http://schema.org/",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",dbpedia:"http://dbpedia.org/ontology/",dbprop:"http://dbpedia.org/property/",skos:"http://www.w3.org/2004/02/skos/core#",xsd:"http://www.w3.org/2001/XMLSchema#",sioc:"http://rdfs.org/sioc/ns#",dcterms:"http://purl.org/dc/terms/"}),this.Type.prototype.vie=this,this.Types.prototype.vie=this,this.Attribute.prototype.vie=this,this.Attributes.prototype.vie=this,this.types=new this.Types,this.types.add("owl:Thing"),this.config.classic===!0&&(this.RDFa=new this.ClassicRDFa(this),this.RDFaEntities=new this.ClassicRDFaEntities(this),this.EntityManager=new this.ClassicEntityManager(this),this.cleanup=function(){this.entities.reset()})};if(e.prototype.use=function(a,b){if(!b&&!a.name)throw new Error("Please provide a name for the service!");return a.vie=this,a.name=b?b:a.name,a.init&&a.init(),this.services[a.name]=a,this},e.prototype.service=function(a){if(!this.hasService(a))throw"Undefined service "+a;return this.services[a]},e.prototype.hasService=function(a){return this.services[a]?!0:!1},e.prototype.getServicesArray=function(){return d.map(this.services,function(a){return a})},e.prototype.load=function(a){return a||(a={}),a.vie=this,new this.Loadable(a)},e.prototype.save=function(a){return a||(a={}),a.vie=this,new this.Savable(a)},e.prototype.remove=function(a){return a||(a={}),a.vie=this,new this.Removable(a)},e.prototype.analyze=function(a){return a||(a={}),a.vie=this,new this.Analyzable(a)},e.prototype.find=function(a){return a||(a={}),a.vie=this,new this.Findable(a)},e.prototype.loadSchema=function(a,c){if(c=c?c:{},!a)throw new Error("Please provide a proper URL");var d=this;return b.getJSON(a).success(function(a){try{e.Util.loadSchemaOrg(d,a,c.baseNS),c.success&&c.success.call(d)}catch(b){return c.error.call(d,b),void 0}}).error(function(b,e){c.error&&c.error.call(d,"Could not load schema from URL ("+a+"): "+e)}),this},e.prototype.getTypedEntityClass=function(a){var b=this.types.get(a);
if(!b)throw new Error("Unknown type "+a);return this.typeEntityClasses[a.id]||(this.typeEntityClasses[a.id]=this.Entity.extend({defaults:{"@type":a}})),this.typeEntityClasses[a.id]},e.prototype.typeEntityClasses={},"object"==typeof exports&&(exports.VIE=e,b||(b=require("jquery")),c||(c=require("backbone"),c.$=b),d||(d=require("underscore")._)),e.prototype.Able=function(){this.init=function(a,c){return this.options=a,this.services=a.from||a.using||a.to||[],this.vie=a.vie,this.methodName=c,this.deferred=b.Deferred(),this.resolve=this.deferred.resolve,this.resolveWith=this.deferred.resolveWith,this.reject=this.deferred.reject,this.rejectWith=this.deferred.rejectWith,this.success=this.done=this.deferred.done,this.fail=this.deferred.fail,this.then=this.deferred.then,this.always=this.deferred.always,this.from=this.using,this.to=this.using,this},this.using=function(a){var b=this;return a=d.isArray(a)?a:[a],d.each(a,function(a){var c="string"==typeof a?b.vie.service(a):a;b.services.push(c)}),this},this.execute=function(){var a=this;return d(this.services).each(function(b){b[a.methodName](a)}),this}},e.prototype.Loadable=function(a){this.init(a,"load")},e.prototype.Loadable.prototype=new e.prototype.Able,e.prototype.Savable=function(a){this.init(a,"save")},e.prototype.Savable.prototype=new e.prototype.Able,e.prototype.Removable=function(a){this.init(a,"remove")},e.prototype.Removable.prototype=new e.prototype.Able,e.prototype.Analyzable=function(a){this.init(a,"analyze")},e.prototype.Analyzable.prototype=new e.prototype.Able,e.prototype.Findable=function(a){this.init(a,"find")},e.prototype.Findable.prototype=new e.prototype.Able,e.Util={isReference:function(a){var b=new RegExp("^\\<([^\\>]*)\\>$");return b.exec(a)?!0:!1},toReference:function(a,b){if(d.isArray(a))return d.map(a,function(a){return this.toReference(a)},this);if(!d.isString(a))return a;var c=a;return"_:"===a.substring(0,2)?c=a:b&&b.isCurie(a)?(c=b.uri(a),c==="<"+b.base()+a+">"&&(c="<"+a+">")):b&&!b.isUri(a)&&(c="<"+a+">"),c},fromReference:function(a,b){return b&&!b.isUri(a)?a:a.substring(1,a.length-1)},toCurie:function(a,b,c){if(e.Util.isCurie(a,c))return a;var d=":";for(var f in c.toObj())if(1===a.indexOf(c.get(f))){var g=new RegExp("^<?"+c.get(f));return""===f&&(d=""),(b?"[":"")+a.replace(g,f+d).replace(/>$/,"")+(b?"]":"")}throw new Error("No prefix found for URI '"+a+"'!")},isCurie:function(a,b){if(e.Util.isUri(a))return!1;try{return e.Util.toUri(a,b),!0}catch(c){return!1}},toUri:function(a,b){if(e.Util.isUri(a))return a;var c=":";for(var d in b.toObj())if(""!==d&&(0===a.indexOf(d+":")||0===a.indexOf("["+d+":"))){var f=new RegExp("^\\[{0,1}"+d+c);return"<"+a.replace(f,b.get(d)).replace(/\]{0,1}$/,"")+">"}if(-1===a.indexOf(c))return"<"+b.base()+a+">";throw new Error("No prefix found for CURIE '"+a+"'!")},isUri:function(a){return"string"==typeof a&&0===a.search(/^<.+>$/)},mapAttributeNS:function(a,b){var c=a;return b.isUri(a)||0===a.indexOf("@")||(b.isCurie(a)?c=b.uri(a):b.isUri(a)||(c=-1===a.indexOf(":")?"<"+b.base()+a+">":"<"+a+">")),c},rdf2Entities:function(a,c){if("function"!=typeof b.rdf)return e.Util._rdf2EntitiesNoRdfQuery(a,c);var f={};try{var g=c instanceof b.rdf?c.base(a.vie.namespaces.base()):b.rdf().base(a.vie.namespaces.base()).load(c,{});if(a.rules){var h=b.rdf.ruleset();for(var i in a.vie.namespaces.toObj())""!==i&&h.prefix(i,a.vie.namespaces.get(i));for(var j=0;j<a.rules.length;j++)if(a.rules.hasOwnProperty(j)){var k=a.rules[j];h.add(k.left,k.right)}g=g.reason(h,10)}g.where("?subject ?property ?object").each(function(){function b(a){if("string"==typeof a.value){if(a.lang){var b={toString:function(){return this["@value"]},"@value":a.value.replace(/^"|"$/g,""),"@language":a.lang};return b}return a.value}return"uri"===a.type?a.toString():a.value}var c=this.subject.toString();f[c]||(f[c]={"@subject":c,"@context":a.vie.namespaces.toObj(!0),"@type":[]});var d,e=this.property.toString();try{d=a.vie.namespaces.curie(e)}catch(g){d=e}f[c][d]=f[c][d]||[],f[c][d].push(b(this.object))}),d(f).each(function(a){a["@type"]=a["@type"].concat(a["rdf:type"]),delete a["rdf:type"],d(a).each(function(b,c){1===b.length&&(a[c]=b[0])})})}catch(l){return[]}var m=[];return b.each(f,function(){try{var b=new a.vie.Entity(this);m.push(b)}catch(c){}}),m},getPreferredLangForPreferredProperty:function(a,b,c){var e,f,g;return f=[],d.each(c,function(c){d.each(b,function(b,h){e=null,"string"==typeof b&&a.get(b)?(e=d.flatten([a.get(b)]),d(e).each(function(a){var b,d,e,g,h;return g=e=h=0,b=a["@language"],"string"!=typeof a||a.indexOf("@")!==a.length-3&&a.indexOf("@")!==a.length-5||(b=a.replace(/(^\"*|\"*@)..(..)?$/g,"")),g+=b?b===c?h:20:10,d=a.toString(),d=d.replace(/(^\"*|\"*@..$)/g,""),f.push({score:g,value:d})})):"object"==typeof b&&a.get(b.property)&&(g=d.flatten([a.get(b.property)]),g=d(g).map(function(a){return a.isEntity?a.getSubject():a}),f.push({score:h,value:b.makeLabel(g)}))})}),f=d(f).sortBy(function(a){return a.score}),f.length?f[0].value:"n/a"},_rdf2EntitiesNoRdfQuery:function(a,b){var c=[];return d.forEach(b,function(a,b){var e={};e["@subject"]="<"+b+">",d.forEach(a,function(a,b){b="<"+b+">",d.forEach(a,function(a){return"uri"===a.type&&(a.value="<"+a.value+">"),e[b]&&!d.isArray(e[b])&&(e[b]=[e[b]]),d.isArray(e[b])?(e[b].push(a.value),void 0):(e[b]=a.value,void 0)})}),c.push(e)}),c},loadSchemaOrg:function(a,b,c){if(!b)throw new Error("Please load the schema.json file.");a.types.remove("<http://schema.org/Thing>");var e=c?c:a.namespaces.base();a.namespaces.base(c);var f={DataType:"xsd:anyType",Boolean:"xsd:boolean",Date:"xsd:date",DateTime:"xsd:dateTime",Time:"xsd:time",Float:"xsd:float",Integer:"xsd:integer",Number:"xsd:anySimpleType",Text:"xsd:string",URL:"xsd:anyURI"},g=function(c,d){for(var e=a.types.add(d,[{id:"value",range:f[d]}]),h=0;h<c.length;h++){var i=a.types.get(c[h])?a.types.get(c[h]):g.call(a,b.datatypes[c[h]].supertypes,c[h]);e.inherit(i)}return e};for(var h in b.datatypes)if(!a.types.get(h)){var i=b.datatypes[h].supertypes;g.call(a,i,h)}var j=function(a){var b={};return a.label&&(b.label=a.label),a.url&&(b.url=a.url),a.comment&&(b.comment=a.comment),a.metadata&&(b=d.extend(b,a.metadata)),b},k=function(a){var c=[];return d.each(b.types[a].specific_properties,function(a){var d=b.properties[a];c.push({id:d.id,range:d.ranges,min:d.min,max:d.max,metadata:j(d)})}),c},l=function(c,d,e,f){for(var g=a.types.add(d,e,f),h=0;h<c.length;h++){var i=a.types.get(c[h])?a.types.get(c[h]):l.call(a,b.types[c[h]].supertypes,c[h],k.call(a,c[h]),j(b.types[c[h]]));g.inherit(i)}return"Thing"!==d||g.isof("owl:Thing")||g.inherit("owl:Thing"),g};d.each(b.types,function(b){if(!a.types.get(b.id)){var c=b.supertypes,d=j(b);l.call(a,c,b.id,k.call(a,b.id),d)}}),a.namespaces.base(e)},getEntityTypeUnion:function(a){var b=a.vie;return new b.Type("Union").inherit(a.get("@type"))},getFormSchemaForType:function(a,b){var c={};return d.each(a.attributes.toArray(),function(a){var b=e.Util.toCurie(a.id,!1,a.vie.namespaces);c[b]=e.Util.getFormSchemaForAttribute(a)}),d.each(c,function(a,d){a.type||delete c[d],"URL"===a.type&&(a.type="Text",a.dataType="url"),"List"!==a.type||a.listType||delete c[d],b||("NestedModel"===a.type||"NestedModel"===a.listType)&&delete c[d]}),c},getFormSchemaForAttribute:function(a){var b=a.range[0],c={},d=function(b){switch(b){case"xsd:anySimpleType":case"xsd:float":case"xsd:integer":return"Number";case"xsd:string":return"Text";case"xsd:date":return"Date";case"xsd:dateTime":return"DateTime";case"xsd:boolean":return"Checkbox";case"xsd:anyURI":return"URL";default:var c=a.vie.types.get(b);return c?c.attributes.get("value")?d(c.attributes.get("value").range[0]):"NestedModel":null}};return c.title=e.Util.toCurie(a.id,!1,a.vie.namespaces),a.min>0&&(c.validators=["required"]),a.max>1?(c.type="List",c.listType=d(b),"NestedModel"===c.listType&&(c.nestedModelType=b),c):(c.type=d(b),"NestedModel"===c.type&&(c.nestedModelType=b),c)},getFormSchema:function(a){if(!a||!a.isEntity)return{};var b=e.Util.getEntityTypeUnion(a),c=e.Util.getFormSchemaForType(b,!0);return d.each(c,function(b,d){("NestedModel"===b.type||"NestedModel"===b.listType)&&(c[d].model=a.vie.getTypedEntityClass(b.nestedModelType))}),c},xsdDateTime:function(a){function b(a){var b=a.toString();return b.length<2?"0"+b:b}var c=a.getFullYear(),d=b(a.getMonth()+1),e=b(a.getDate()),f=b(a.getHours()),g=b(a.getMinutes()),h=b(a.getSeconds());return c+"-"+d+"-"+e+"T"+f+":"+g+":"+h},extractLanguageString:function(a,b,c){var f,g,h,i,j;if(a&&"string"!=typeof a){for(b=d.isArray(b)?b:[b],c=d.isArray(c)?c:[c],f=0;f<b.length;f++)for(var k=0;k<c.length;k++){var l=c[k];if(g=b[f],a.has(g))for(h=a.get(g),h=d.isArray(h)?h:[h],i=0;i<h.length;i++)if(j=h[i],j=j.isEntity?e.Util.extractLanguageString(j,b,l):"string"==typeof j?j:"",j&&j.indexOf("@"+l)>-1)return j.replace(/"/g,"").replace(/@[a-z]+/,"").trim()}for(f=0;f<b.length;f++)if(g=b[f],a.has(g))for(h=a.get(g),h=d.isArray(h)?h:[h],i=0;i<h.length;i++)if(j=h[i],j.isEntity&&(j=e.Util.extractLanguageString(j,b,[])),j&&"string"==typeof j&&-1===j.indexOf("@"))return j.replace(/"/g,"").replace(/@[a-z]+/,"").trim()}return void 0},transformationRules:function(a){var c=[{left:["?subject a dbpedia:Person","?subject rdfs:label ?label"],right:function(a){return function(){return[b.rdf.triple(this.subject.toString(),"a","<"+a.base()+"Person>",{namespaces:a.toObj()}),b.rdf.triple(this.subject.toString(),"<"+a.base()+"name>",this.label,{namespaces:a.toObj()})]}}(a.vie.namespaces)},{left:["?subject a foaf:Person","?subject rdfs:label ?label"],right:function(a){return function(){return[b.rdf.triple(this.subject.toString(),"a","<"+a.base()+"Person>",{namespaces:a.toObj()}),b.rdf.triple(this.subject.toString(),"<"+a.base()+"name>",this.label,{namespaces:a.toObj()})]}}(a.vie.namespaces)},{left:["?subject a dbpedia:Place","?subject rdfs:label ?label"],right:function(a){return function(){return[b.rdf.triple(this.subject.toString(),"a","<"+a.base()+"Place>",{namespaces:a.toObj()}),b.rdf.triple(this.subject.toString(),"<"+a.base()+"name>",this.label.toString(),{namespaces:a.toObj()})]}}(a.vie.namespaces)},{left:["?subject a dbpedia:City","?subject rdfs:label ?label","?subject dbpedia:abstract ?abs","?subject dbpedia:country ?country"],right:function(a){return function(){return[b.rdf.triple(this.subject.toString(),"a","<"+a.base()+"City>",{namespaces:a.toObj()}),b.rdf.triple(this.subject.toString(),"<"+a.base()+"name>",this.label.toString(),{namespaces:a.toObj()}),b.rdf.triple(this.subject.toString(),"<"+a.base()+"description>",this.abs.toString(),{namespaces:a.toObj()}),b.rdf.triple(this.subject.toString(),"<"+a.base()+"containedIn>",this.country.toString(),{namespaces:a.toObj()})]}}(a.vie.namespaces)}];return c},getAdditionalRules:function(a){var c={Work:"CreativeWork",Film:"Movie",TelevisionEpisode:"TVEpisode",TelevisionShow:"TVSeries",Website:"WebPage",Painting:"Painting",Sculpture:"Sculpture",Event:"Event",SportsEvent:"SportsEvent",MusicFestival:"Festival",FilmFestival:"Festival",Place:"Place",Continent:"Continent",Country:"Country",City:"City",Airport:"Airport",Station:"TrainStation",Hospital:"GovernmentBuilding",Mountain:"Mountain",BodyOfWater:"BodyOfWater",Company:"Organization",Person:"Person"},e=[];return d.each(c,function(c,d){var f={left:["?subject a dbpedia:"+d,"?subject rdfs:label ?label"],right:function(a){return function(){return[b.rdf.triple(this.subject.toString(),"a","<"+a.base()+c+">",{namespaces:a.toObj()}),b.rdf.triple(this.subject.toString(),"<"+a.base()+"name>",this.label.toString(),{namespaces:a.toObj()})]}}(a.vie.namespaces)};e.push(f)}),e}},e.prototype.Entity=c.Model.extend({idAttribute:"@subject",isEntity:!0,defaults:{"@type":"owl:Thing"},initialize:function(a,b){return a||(a={}),b||(b={}),this.id=this["@subject"]=a["@subject"]?this.toReference(a["@subject"]):a["@subject"]=this.cid.replace("c","_:bnode"),this},schema:function(){return e.Util.getFormSchema(this)},get:function(a){a=e.Util.mapAttributeNS(a,this.vie.namespaces);var b=c.Model.prototype.get.call(this,a);return b=d.isArray(b)?b:[b],0===b.length?void 0:(b=d.map(b,function(b){return void 0!==b&&"@type"===a?(this.vie.types.get(b)||this.vie.types.add(b).inherit("owl:Thing"),this.vie.types.get(b)):void 0!==b&&this.vie.entities.get(b)?this.vie.entities.get(b):b},this),b=1===b.length?b[0]:b)},has:function(a){return a=e.Util.mapAttributeNS(a,this.vie.namespaces),c.Model.prototype.has.call(this,a)},hasRelations:function(){var a=!1;return d.each(this.attributes,function(b){b&&b.isCollection&&(a=!0)}),a},set:function(a,b,f){if(!a)return this;if(a["@subject"]&&(a["@subject"]=this.toReference(a["@subject"])),d.isString(a)){var g={};return g[a]=b,this.set(g,f)}b||(b={}),b.validate!==!1&&b.silent!==!0&&(b.validate=!0),a.attributes&&(a=a.attributes);var h;d.each(a,function(b,c){var d=e.Util.mapAttributeNS(c,this.vie.namespaces);c!==d&&(delete a[c],a[d]=b)},this),d.each(a,function(c,e){if(c&&-1===e.indexOf("@"))if(c.isCollection)c.each(function(a){this.vie.entities.addOrUpdate(a)},this);else if(c.isEntity)this.vie.entities.addOrUpdate(c),h=new this.vie.Collection(c,{vie:this.vie,predicate:e}),a[e]=h;else if(d.isArray(c)){if(this.attributes[e]&&this.attributes[e].isCollection){var f=this.attributes[e].addOrUpdate(c);a[e]=this.attributes[e],a[e].reset(f)}}else if(c["@value"]);else if(d.isObject(c)&&!d.isDate(c)){var g=new this.vie.Entity(c,b);this.vie.entities.addOrUpdate(g),h=new this.vie.Collection(c,{vie:this.vie,predicate:e}),a[e]=h}},this);var i=c.Model.prototype.set.call(this,a,b);return b&&b.ignoreChanges&&(this.changed={},this._previousAttributes=d.clone(this.attributes)),i},unset:function(a,b){return a=e.Util.mapAttributeNS(a,this.vie.namespaces),c.Model.prototype.unset.call(this,a,b)},validate:function(a,b){if(!b||b.validate!==!1){var c=this.get("@type");if(c){if(d.isArray(c)){var e=[];if(d.each(c,function(c){var d=this.validateByType(c,a,b);d&&e.push(d)},this),d.isEmpty(e))return;return d.flatten(e)}return this.validateByType(c,a,b)}}},validateByType:function(a,b){var c={max:"<%= property %> cannot contain more than <%= num %> items",min:"<%= property %> must contain at least <%= num %> items",required:"<%= property %> is required"};if(a.attributes){var e=function(a,b,e){return{property:a.id,constraint:b,message:d.template(c[b],d.extend({property:a.id},e))}},f=function(a,b){return!b[a.id]||d.isEmpty(b[a.id])?e(a,"required",{}):void 0},g=function(a,b){return b&&b[a.id]&&(b[a.id].isCollection||d.isArray(b[a.id]))?b[a.id].length>a.max?e(a,"max",{num:a.max}):void 0:void 0},h=[];if(d.each(a.attributes.list(),function(a){var c;a.max&&-1!=a.max&&(c=g(a,b),c&&h.push(c)),a.min&&a.min>0&&(c=f(a,b),c&&h.push(c))}),!d.isEmpty(h))return h}},isNew:function(){return"_:bnode"===this.getSubjectUri().substr(0,7)?!0:!1},hasChanged:function(a){return this.markedChanged?!0:c.Model.prototype.hasChanged.call(this,a)},forceChanged:function(a){this.markedChanged=a?!0:!1},getSubject:function(){return"undefined"==typeof this.id&&(this.id=this.attributes[this.idAttribute]),"string"==typeof this.id?"http://"===this.id.substr(0,7)||"urn:"===this.id.substr(0,4)?this.toReference(this.id):this.id:this.cid.replace("c","_:bnode")},getSubjectUri:function(){return this.fromReference(this.getSubject())},isReference:function(a){return e.Util.isReference(a)},toReference:function(a){return e.Util.toReference(a,this.vie.namespaces)},fromReference:function(a){return e.Util.fromReference(a,this.vie.namespaces)},as:function(a){if("JSON"===a)return this.toJSON();if("JSONLD"===a)return this.toJSONLD();throw new Error("Unknown encoding "+a)},toJSONLD:function(){var a={};return d.each(this.attributes,function(b,c){var e=this.get(c);b instanceof this.vie.Collection&&(e=b.map(function(a){return a.getSubject()})),"@type"===c&&(e=d.isArray(e)?d.map(e,function(a){return a.toString()}):e.toString()),a[c]=e},this),a["@subject"]=this.getSubject(),a},setOrAdd:function(a,b,c){return d.isString(a)&&b?this._setOrAddOne(a,b,c):d.isObject(a)&&d.each(a,function(a,c){this._setOrAddOne(c,a,b)},this),this},_setOrAddOne:function(a,b,f){if(a&&b){if(f=f?f:{},a=e.Util.mapAttributeNS(a,this.vie.namespaces),d.isArray(b))return d.each(b,function(c){this._setOrAddOne(a,b[c],f)},this),void 0;"@type"===a&&b instanceof this.vie.Type&&(b=b.id);var g={},h=c.Model.prototype.get.call(this,a);if(h)if(h.isCollection){if(b.isCollection)b.each(function(a){h.add(a)});else if(b.isEntity)h.add(b);else{if(!d.isObject(b))throw new Error("you cannot add a literal to a collection of entities!");b=new this.vie.Entity(b),h.add(b)}this.trigger("change:"+a,this,b,{})}else{if(!d.isArray(h)){var i=[h];return i.push(b),g[a]=i,this.set(g,f)}if(b.isCollection)b.each(function(c){this._setOrAddOne(a,b.at(c).getSubject(),f)},this);else if(b.isEntity)this._setOrAddOne(a,b.getSubject(),f);else if(d.isObject(b))b=new this.vie.Entity(b),this._setOrAddOne(a,b,f);else{var j=h.slice(0);j.push(b),this.set(a,j)}}else g[a]=b,this.set(g,f)}},hasType:function(a){return a=this.vie.types.get(a),this.hasPropertyValue("@type",a)},hasPropertyValue:function(a,b){var c=this.get(a);return d.isObject(b)||(b=this.vie.entities.get(b)),d.isArray(c)?-1!==c.indexOf(b):c===b},isof:function(a){var b=this.get("@type");if(void 0===b)return!1;b=d.isArray(b)?b:[b],a=this.vie.types.get(a)?this.vie.types.get(a):new this.vie.Type(a);var c=!1;return d.each(b,function(b){this.vie.types.get(b).isof(a)&&(c=!0)},this),c},addTo:function(a,b){if(a instanceof this.vie.Collection)return b?a.addOrUpdate(this):a.add(this),this;throw new Error("Please provide a proper collection of type VIE.Collection as argument!")}}),e.prototype.Collection=c.Collection.extend({model:e.prototype.Entity,initialize:function(a,b){if(!b||!b.vie)throw new Error("Each collection needs a VIE reference");this.vie=b.vie,this.predicate=b.predicate},canAdd:function(){return!0},get:function(a){return null===a?null:(a=a.getSubject?a.getSubject():a,"string"==typeof a&&0===a.indexOf("_:")?2===a.indexOf("bnode")?(a=a.replace("_:bnode","c"),this._byId[a]):this._byId["<"+a+">"]:this._byId[a]?this._byId[a]:(a=this.toReference(a),this._byId[a]))},addOrUpdate:function(a,c){c=c||{};var e,f=this;if(d.isArray(a)){var g=[];return d.each(a,function(a){g.push(f.addOrUpdate(a,c))}),g}if(void 0===a)throw new Error("No model given");if(d.isString(a)&&(a={"@subject":a,id:a}),a.isEntity||(a=new this.model(a)),a.id&&this.get(a.id)&&(e=this.get(a.id)),this.get(a.cid)&&(e=this.get(a.cid)),e){var h={};return d.each(a.attributes,function(g,i){if(!e.has(i))return h[i]=g,!0;if("@subject"===i&&a.isNew()&&!e.isNew())return!0;if(e.get(i)===g)return!0;var j=e.attributes[i],k=g;return j instanceof f.vie.Collection?!0:c.overrideAttributes?(h[i]=g,!0):("@context"===i?h[i]=b.extend(!0,{},j,k):(j=b.isArray(j)?j:[j],k=b.isArray(k)?k:[k],h[i]=d.uniq(j.concat(k)),h[i]=1===h[i].length?h[i][0]:h[i]),void 0)}),d.isEmpty(h)||e.set(h,c.updateOptions),e}return this.add(a,c.addOptions),a},isReference:function(a){return e.Util.isReference(a)},toReference:function(a){return e.Util.toReference(a,this.vie.namespaces)},fromReference:function(a){return e.Util.fromReference(a,this.vie.namespaces)},isCollection:!0}),e.prototype.Type=function(a,c,d){if(void 0===a||"string"!=typeof a)throw"The type constructor needs an 'id' of type string! E.g., 'Person'";if(this.id=this.vie.namespaces.isUri(a)?a:this.vie.namespaces.uri(a),this.vie.types.get(this.id))throw new Error("The type "+this.id+" is already defined!");this.supertypes=new this.vie.Types,this.subtypes=new this.vie.Types,this.attributes=new this.vie.Attributes(this,c?c:[]),this.metadata=d?d:{},this.isof=function(a){if(a instanceof e.prototype.Type||(a=this.vie.types.get(a)?this.vie.types.get(a):new this.vie.Type(a)),a)return a.subsumes(this.id);throw new Error("No valid type given")},this.subsumes=function(a){if(a=this.vie.types.get(a)){if(this.id===a.id)return!0;for(var b=this.subtypes.list(),c=0;c<b.length;c++){var d=b[c];if(d&&(d.id===a.id||d.subsumes(a)))return!0}return!1}throw new Error("No valid type given")},this.inherit=function(a){if("string"==typeof a)this.inherit(this.vie.types.get(a));else if(a instanceof this.vie.Type){a.subtypes.addOrOverwrite(this),this.supertypes.addOrOverwrite(a);try{this.attributes.list()}catch(c){throw a.subtypes.remove(this),this.supertypes.remove(a),c}}else{if(!b.isArray(a))throw new Error("Wrong argument in VIE.Type.inherit()");for(var d=0,e=a.length;e>d;d++)this.inherit(a[d])}return this},this.hierarchy=function(){for(var a={id:this.id,subtypes:[]},b=this.subtypes.list(),c=0,d=b.length;d>c;c++){var e=this.vie.types.get(b[c]);a.subtypes.push(e.hierarchy())}return a},this.instance=function(a,b){var c=this.vie.getTypedEntityClass(this);return new c(a,b)},this.toString=function(){return this.id}},e.prototype.Types=function(){this._types={},this.add=function(a,b,c){if(d.isArray(a))return d.each(a,function(a){this.add(a)},this),this;if(this.get(a))throw new Error("Type '"+a+"' already registered.");if("string"==typeof a){var e=new this.vie.Type(a,b,c);return this._types[e.id]=e,e}if(a instanceof this.vie.Type)return this._types[a.id]=a,a;throw new Error("Wrong argument to VIE.Types.add()!")},this.addOrOverwrite=function(a,b){return this.get(a)&&this.remove(a),this.add(a,b)},this.get=function(a){if(!a)return void 0;if("string"==typeof a){var b=this.vie.namespaces.isUri(a)?a:this.vie.namespaces.uri(a);return this._types[b]}return a instanceof this.vie.Type?this.get(a.id):void 0},this.remove=function(a){var b=this.get(a);if(!b)return this;if(!b||b.subsumes("owl:Thing"))return this;delete this._types[b.id];for(var c=b.subtypes.list(),d=0;d<c.length;d++){var e=c[d];1===e.supertypes.list().length?this.remove(e):e.supertypes.remove(b.id)}return b},this.toArray=this.list=function(){var a=[];for(var b in this._types)a.push(this._types[b]);return a},this.sort=function(a,c){var d=this;if(a=b.isArray(a)?a:[a],c=c?!0:!1,0===a.length)return[];var e,f,g=[a[0]];for(e=1,f=a.length;f>e;e++){var h=a[e],i=d.get(h);if(i)for(var j=0;j<g.length;j++){if(i.subsumes(g[j])){g.splice(j,0,h);break}j===g.length-1&&g.push(h)}}for(e=0;e<g.length;e++)g.lastIndexOf(g[e])!==e&&(g.splice(e,1),e--);return c||g.reverse(),g}},e.prototype.Attribute=function(a,b,c,e,f,g){if(void 0===a||"string"!=typeof a)throw new Error("The attribute constructor needs an 'id' of type string! E.g., 'Person'");if(void 0===b)throw new Error("The attribute constructor of "+a+" needs 'range'.");if(void 0===c)throw new Error("The attribute constructor of "+a+" needs a 'domain'.");this._domain=c,this.id=this.vie.namespaces.isUri(a)?a:this.vie.namespaces.uri(a),this.range=d.isArray(b)?b:[b],e=e?e:0,this.min=e>0?e:0,f=f?f:1,-1===f&&(f=Number.MAX_VALUE),this.max=f>=this.min?f:this.min,this.metadata=g?g:{},this.applies=function(a){this.vie.types.get(a)&&(a=this.vie.types.get(a));for(var b=0,c=this.range.length;c>b;b++){var d=this.vie.types.get(this.range[b]);if(void 0===d&&"string"==typeof a){if(a===this.range[b])return!0}else if(a.isof(this.range[b]))return!0}return!1}},e.prototype.Attributes=function(a,c){this._local={},this._attributes={},this.domain=a,this.add=function(a,b,c,e,f){if(d.isArray(a))return d.each(a,function(a){this.add(a)},this),this;if(this.get(a))throw new Error("Attribute '"+a+"' already registered for domain "+this.domain.id+"!");if("string"==typeof a){var g=new this.vie.Attribute(a,b,this.domain,c,e,f);return this._local[g.id]=g,g}if(a instanceof this.vie.Attribute)return a.domain=this.domain,a.vie=this.vie,this._local[a.id]=a,a;throw new Error("Wrong argument to VIE.Types.add()!")},this.remove=function(a){var b=this.get(a);if(b.id in this._local)return delete this._local[b.id],b;throw new Error("The attribute "+a+" is inherited and cannot be removed from the domain "+this.domain.id+"!")},this.get=function(a){if("string"==typeof a){var b=this.vie.namespaces.isUri(a)?a:this.vie.namespaces.uri(a);return this._inherit()._attributes[b]}if(a instanceof this.vie.Attribute)return this.get(a.id);throw new Error("Wrong argument in VIE.Attributes.get()")},this._inherit=function(){var a,c,e,f,g,h=b.extend(!0,{},this._local),i=d.map(this.domain.supertypes.list(),function(a){return a.attributes}),j={},k={};for(a=0,f=i.length;f>a;a++){var l=i[a].list();for(c=0,g=l.length;g>c;c++)e=l[c].id,e in h||(e in j||e in k?(k[e]||(k[e]={range:[],mins:[],maxs:[],metadatas:[]}),e in j&&(k[e].range=b.merge(k[e].range,j[e].range),k[e].mins=b.merge(k[e].mins,[j[e].min]),k[e].maxs=b.merge(k[e].maxs,[j[e].max]),k[e].metadatas=b.merge(k[e].metadatas,[j[e].metadata]),delete j[e]),k[e].range=b.merge(k[e].range,l[c].range),k[e].mins=b.merge(k[e].mins,[l[c].min]),k[e].maxs=b.merge(k[e].maxs,[l[c].max]),k[e].metadatas=b.merge(k[e].metadatas,[l[c].metadata]),k[e].range=d.uniq(k[e].range),k[e].mins=d.uniq(k[e].mins),k[e].maxs=d.uniq(k[e].maxs),k[e].metadatas=d.uniq(k[e].metadatas)):j[e]=l[c])}b.extend(h,j);for(e in k){for(var m=k[e].range,n=k[e].mins,o=k[e].maxs,p=k[e].metadatas,q=[],r=0,s=m.length;s>r;r++){var t=this.vie.types.get(m[r]),u=!1;if(t)for(c=0;s>c;c++)if(c!==r){var v=this.vie.types.get(m[c]);if(v&&v.isof(t)){u=!0;break}}u||q.push(m[r])}var w=d.max(n),x=d.min(o);if(!(x>=w&&x>=0&&w>=0))throw new Error("This inheritance is not allowed because of an invalid minCount/maxCount pair!");h[e]=new this.vie.Attribute(e,q,this,w,x,p[0])}return this._attributes=h,this},this.toArray=this.list=function(a){var b=[],c=this._inherit()._attributes;for(var d in c)(!a||c[d].applies(a))&&b.push(c[d]);return b},c=d.isArray(c)?c:[c],d.each(c,function(a){this.add(a.id,a.range,a.min,a.max,a.metadata)},this)},e.prototype.Namespaces)throw new Error("ERROR: VIE.Namespaces is already defined. Please check your VIE installation!");e.prototype.Namespaces=function(a,b){if(!a)throw new Error("Please provide a base namespace!");if(this._base=a,this._namespaces=b?b:{},"object"!=typeof this._namespaces||d.isArray(this._namespaces))throw new Error("If you want to initialise VIE namespace prefixes, please provide a proper object!")},e.prototype.Namespaces.prototype.base=function(a){if(a){if("string"==typeof a)return this.removeNamespace(a),this._base=a,this._base;throw new Error("Please provide a valid namespace!")}return this._base},e.prototype.Namespaces.prototype.add=function(a,c){if("object"==typeof a){for(var d in a)this.add(d,a[d]);return this}if(""===a)return this.base(c),this;if(this.contains(a)&&c!==this._namespaces[a])throw new Error("ERROR: Trying to register namespace prefix mapping ("+a+","+c+")!"+"There is already a mapping existing: '("+a+","+this.get(a)+")'!");return b.each(this._namespaces,function(b,d){if(d===c&&b!==a)throw new Error("ERROR: Trying to register namespace prefix mapping ("+a+","+c+")!"+"There is already a mapping existing: '("+b+","+c+")'!")}),this._namespaces[a]=c,this},e.prototype.Namespaces.prototype.addOrReplace=function(a,b){if("object"==typeof a){for(var c in a)this.addOrReplace(c,a[c]);return this}return this.remove(a),this.removeNamespace(b),this.add(a,b)},e.prototype.Namespaces.prototype.get=function(a){return""===a?this.base():this._namespaces[a]},e.prototype.Namespaces.prototype.getPrefix=function(a){var c;return 0===a.indexOf("<")&&(a=a.substring(1,a.length-1)),b.each(this._namespaces,function(b,d){0===a.indexOf(d)&&(c=b),0===a.indexOf(b+":")&&(c=b)}),c},e.prototype.Namespaces.prototype.contains=function(a){return a in this._namespaces},e.prototype.Namespaces.prototype.containsNamespace=function(a){return void 0!==this.getPrefix(a)},e.prototype.Namespaces.prototype.update=function(a,b){return this.remove(a),this.add(a,b)},e.prototype.Namespaces.prototype.updateNamespace=function(a,b){return this.removeNamespace(a),this.add(a,b)},e.prototype.Namespaces.prototype.remove=function(a){return a&&delete this._namespaces[a],this},e.prototype.Namespaces.prototype.removeNamespace=function(a){var b=this.getPrefix(a);return b&&delete this._namespaces[b],this},e.prototype.Namespaces.prototype.toObj=function(a){return a?b.extend({},this._namespaces):b.extend({"":this._base},this._namespaces)},e.prototype.Namespaces.prototype.curie=function(a,b){return e.Util.toCurie(a,b,this)},e.prototype.Namespaces.prototype.isCurie=function(a){return e.Util.isCurie(a,this)},e.prototype.Namespaces.prototype.uri=function(a){return e.Util.toUri(a,this)},e.prototype.Namespaces.prototype.isUri=e.Util.isUri,e.prototype.ClassicRDFa=function(a){this.vie=a},e.prototype.ClassicRDFa.prototype={readEntities:function(a){var b=[],c=this.vie.RDFaEntities.getInstances(a);return d.each(c,function(a){b.push(a.toJSONLD())}),b},findPredicateElements:function(a,b,c){return this.vie.services.rdfa.findPredicateElements(a,b,c)},getPredicate:function(a){return this.vie.services.rdfa.getElementPredicate(a)},getSubject:function(a){return this.vie.services.rdfa.getElementSubject(a)}},e.prototype.ClassicRDFaEntities=function(a){this.vie=a},e.prototype.ClassicRDFaEntities.prototype={getInstances:function(a){this.vie.services.rdfa||this.vie.use(new this.vie.RdfaService);var b=null,c=!1;for(this.vie.load({element:a}).from("rdfa").execute().done(function(a){b=a,c=!0});!c;);return b},getInstance:function(a){var b=this.getInstances(a);return b&&b.length?b.pop():null}},e.prototype.ClassicEntityManager=function(a){this.vie=a,this.entities=this.vie.entities},e.prototype.ClassicEntityManager.prototype={getBySubject:function(a){return this.vie.entities.get(a)},getByJSONLD:function(a){if("string"==typeof a)try{a=b.parseJSON(a)}catch(c){return null}return this.vie.entities.addOrUpdate(a)},initializeCollection:function(){}},function(){e.prototype.DBPediaService=function(a){var c={name:"dbpedia",namespaces:{owl:"http://www.w3.org/2002/07/owl#",yago:"http://dbpedia.org/class/yago/",foaf:"http://xmlns.com/foaf/0.1/",georss:"http://www.georss.org/georss/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",dbpedia:"http://dbpedia.org/ontology/",dbprop:"http://dbpedia.org/property/",dcelements:"http://purl.org/dc/elements/1.1/"},rules:[]};this.options=b.extend(!0,c,a?a:{}),this.vie=null,this.name=this.options.name,b.ajaxSetup({converters:{"text application/rdf+json":function(a){return JSON.parse(a)}},timeout:6e4})},e.prototype.DBPediaService.prototype={init:function(){for(var a in this.options.namespaces){var c=this.options.namespaces[a];this.vie.namespaces.add(a,c)}return this.rules=b.extend([],e.Util.transformationRules(this)),this.rules=b.merge(this.rules,this.options.rules?this.options.rules:[]),this.connector=new this.vie.DBPediaConnector(this.options),this},load:function(a){var b=this,c=a instanceof this.vie.Loadable;if(!c)throw new Error("Invalid Loadable passed");var f=function(c){c="string"==typeof c?JSON.parse(c):c,d.defer(function(){try{var f=e.Util.rdf2Entities(b,c);f=d.isArray(f)?f:[f],d.each(f,function(a){a.set("DBPediaServiceLoad",e.Util.xsdDateTime(new Date))}),f=1===f.length?f[0]:f,a.resolve(f)}catch(g){a.reject(g)}})},g=function(b){a.reject(b)},h=a.options.entity?a.options.entity:a.options.entities;if(h){h=d.isArray(h)?h:[h];for(var i=[],j=0;j<h.length;j++){var k="string"==typeof h[j]?h[j]:h[j].id;i.push(k)}this.connector.load(i,f,g)}else a.reject([]);return this}},e.prototype.DBPediaConnector=function(a){this.options=a,this.baseUrl="http://dbpedia.org/sparql?default-graph-uri=http%3A%2F%2Fdbpedia.org&timeout=0"},e.prototype.DBPediaConnector.prototype={load:function(a,c,e,f){f||(f={});var g=this.baseUrl+"&format="+encodeURIComponent("application/rdf+json")+"&query=";if(d.isArray(a)){for(var h="",i="",j=0;j<a.length;j++){var k=/^<.+>$/.test(a[j])?a[j]:"<"+a[j]+">";j>0&&(h+=" .",i+=" UNION "),h+=" "+k+" ?prop"+j+" ?val"+j,i+=" { "+k+" ?prop"+j+" ?val"+j+" }"}g+=encodeURIComponent("CONSTRUCT {"+h+" } WHERE {"+i+" }")}else a=/^<.+>$/.test(a)?a:"<"+a+">",g+=encodeURIComponent("CONSTRUCT { "+a+" ?prop ?val } WHERE { "+a+" ?prop ?val }");var l=f.format||"application/rdf+json";return"undefined"!=typeof exports&&"undefined"!=typeof process?this._loadNode(g,c,e,f,l):(b.ajax({success:function(a){c(a)
},error:e,type:"GET",url:g,accepts:{"application/rdf+json":"application/rdf+json"}}),this)},_loadNode:function(a,b,c,d,e){var f=require("request"),g=f({method:"GET",uri:a,headers:{Accept:e}},function(a,d,e){return 200!==d.statusCode?c(e):(b(JSON.parse(e)),void 0)});return g.end(),this}}}(),function(){e.prototype.OpenCalaisService=function(a){var c={name:"opencalais",url:["http://api.opencalais.com/enlighten/rest/"],timeout:6e4,namespaces:{opencalaisc:"http://s.opencalais.com/1/pred/",opencalaiscr:"http://s.opencalais.com/1/type/er/",opencalaiscm:"http://s.opencalais.com/1/type/em/e/"},rules:[]};this.options=b.extend(!0,c,a?a:{}),this.vie=null,this.name=this.options.name,b.ajaxSetup({converters:{"text application/rdf+json":function(a){return JSON.parse(a)}},timeout:this.options.timeout})},e.prototype.OpenCalaisService.prototype={init:function(){for(var a in this.options.namespaces){var c=this.options.namespaces[a];this.vie.namespaces.add(a,c)}this.rules=b.extend([],e.Util.transformationRules(this)),this.rules=b.merge(this.rules,this.options.rules?this.options.rules:[]),this.connector=new this.vie.OpenCalaisConnector(this.options)},analyze:function(a){var c=this,f=a instanceof this.vie.Analyzable;if(!f)throw"Invalid Analyzable passed";var g=a.options.element?a.options.element:b("body"),h=c._extractText(g);if(h.length>0){var i=function(b){d.defer(function(){var d=e.Util.rdf2Entities(c,b);a.resolve(d)})},j=function(b){a.reject(b)};this.connector.analyze(h,i,j)}else console.warn("No text found in element."),a.resolve([])},_extractText:function(a){if(a.get(0)&&a.get(0).tagName&&("TEXTAREA"==a.get(0).tagName||"INPUT"==a.get(0).tagName&&a.attr("type","text")))return a.get(0).val();var c=a.text().replace(/\s+/g," ").replace(/\0\b\n\r\f\t/g,"");return b.trim(c)}},e.prototype.OpenCalaisConnector=function(a){this.options=a,this.baseUrl=d.isArray(a.url)?a.url:[a.url],this.enhancerUrlPrefix="/"},e.prototype.OpenCalaisConnector.prototype={analyze:function(a,c,e,f){if(f||(f={urlIndex:0}),f.urlIndex>=this.baseUrl.length)return e("Could not connect to the given OpenCalais endpoints! Please check for their setup!"),void 0;var g=this.baseUrl[f.urlIndex].replace(/\/$/,"");g+=this.enhancerUrlPrefix;var h=f.format||"application/rdf+json",i=function(a,b,c,e,f){return function(){console.error("OpenCalais connection error",arguments),a.analyze(b,c,e,d.extend(f,{urlIndex:f.urlIndex+1}))}}(this,a,c,e,f),j=this._prepareData(a);return"undefined"!=typeof exports&&"undefined"!=typeof process?this._analyzeNode(g,j,c,i,f,h):(b.ajax({success:function(a,b,d){var e=d.responseText.replace(/<!--[\s\S]*?-->/g,"");c(e)},error:i,type:"POST",url:g,data:j,accept:"text/plain"}),void 0)},_analyzeNode:function(a,b,c,d,e,f){var g=require("request"),h=g({method:"POST",uri:a,body:b,headers:{Accept:f}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});h.end()},_prepareData:function(a){return{licenseID:this.options.api_key,calculareRelevanceScore:"true",enableMetadataType:"GenericRelations,SocialTags",contentType:"text/html",content:a}}}}(),function(){e.prototype.RdfaRdfQueryService=function(a){var c={name:"rdfardfquery",namespaces:{},rules:[]};this.options=b.extend(!0,c,a?a:{}),this.views=[],this.vie=null,this.name=this.options.name},e.prototype.RdfaRdfQueryService.prototype={init:function(){for(var a in this.options.namespaces){var c=this.options.namespaces[a];this.vie.namespaces.add(a,c)}this.rules=b.extend([],e.Util.transformationRules(this)),this.rules=b.merge(this.rules,this.options.rules?this.options.rules:[])},analyze:function(a){return this.load(a)},load:function(a){var c=this,d=a instanceof this.vie.Loadable||a instanceof this.vie.Analyzable;if(!d)throw new Error("Invalid Loadable/Analyzable passed");var f=a.options.element?a.options.element:b(document);try{var g=b(f).find("[about],[typeof]").rdfa();b.each(b(f).xmlns(),function(a,b){c.vie.namespaces.addOrReplace(a,b.toString())});var h=e.Util.rdf2Entities(this,g);a.resolve(h)}catch(i){a.reject(i)}},save:function(a){var c=a instanceof this.vie.Savable;c||a.reject("Invalid Savable passed"),a.options.element||a.reject("Unable to write entity to RDFa, no element given"),a.options.entity||a.reject("Unable to write to RDFa, no entity given"),b.rdf||a.reject("No rdfQuery found.");var d=a.options.entity,e=[],f=d.get("@type");f=b.isArray(f)?f[0]:f,f=f.id,e.push(d.getSubject()+" a "+f),b(a.options.element).rdfa(e),a.resolve()}}}(),function(){e.prototype.RdfaService=function(a){var c={name:"rdfa",namespaces:{},subjectSelector:"[about],[typeof],[src],html",predicateSelector:"[property],[rel]",rules:[],bnodePrefix:"_a"};this.options=b.extend(!0,c,a?a:{}),this.bnodes=0,this.views=[],this.templates={},this.datatypeReaders={"<http://www.w3.org/2001/XMLSchema#boolean>":function(a){return"true"===a||1===a||a===!0?!0:!1},"<http://www.w3.org/2001/XMLSchema#dateTime>":function(a){return new Date(a)},"<http://www.w3.org/2001/XMLSchema#integer>":function(a){return parseInt(a,10)}},this.datatypeWriters={"<http://www.w3.org/2001/XMLSchema#dateTime>":function(a){return d.isDate(a)?a.toISOString():a}},this.vie=null,this.name=this.options.name},e.prototype.RdfaService.prototype={init:function(){for(var a in this.options.namespaces){var c=this.options.namespaces[a];this.vie.namespaces.add(a,c)}this.rules=b.merge([],e.Util.transformationRules(this)),this.rules=b.merge(this.rules,this.options.rules?this.options.rules:[])},analyze:function(a){return this.load(a)},load:function(a){var c=a instanceof this.vie.Loadable||a instanceof this.vie.Analyzable;if(!c)throw new Error("Invalid Loadable/Analyzable passed");var d;if(a.options.element)d=a.options.element;else{if("undefined"==typeof document)return a.resolve([]);d=b(document)}var e=this.readEntities(d);a.resolve(e)},save:function(a){var b=a instanceof this.vie.Savable;if(!b)throw"Invalid Savable passed";if(!a.options.element)throw"Unable to write entity to RDFa, no element given";if(!a.options.entity)throw"Unable to write to RDFa, no entity given";this._writeEntity(a.options.entity,a.options.element),a.resolve()},readEntities:function(a){var c=this,d=this.xmlns(a);for(var e in d)this.vie.namespaces.addOrReplace(e,d[e]);var f=[];return b(this.options.subjectSelector,a).add(b(a).filter(this.options.subjectSelector)).each(function(){var a=c._readEntity(b(this));a&&f.push(a)}),f},_readEntity:function(a){var c=this.getElementSubject(a),e=this._getElementType(a),f=this._readEntityPredicates(c,a,!1);if(b.isEmptyObject(f))return null;var g=this.vie;d.each(f,function(a,b){if(d.isArray(a)){var c=new this.vie.Collection([],{vie:g,predicate:b});d.each(a,function(a){var b=g.entities.addOrUpdate({"@subject":a});c.addOrUpdate(b)}),f[b]=c}},this),f["@subject"]=c,e&&(f["@type"]=e);var h=new this.vie.Entity(f);return h=this.vie.entities.addOrUpdate(h,{updateOptions:{silent:!0,ignoreChanges:!0}}),this._registerEntityView(h,a),h},_writeEntity:function(a,c){var d=this;return this.findPredicateElements(this.getElementSubject(c),c,!0).each(function(){var c=b(this),e=d.getElementPredicate(c);if(!a.has(e))return!0;var f=a.get(e);return f&&f.isCollection?!0:f===d.readElementValue(e,c)?!0:(d.writeElementValue(e,c,f),void 0)}),!0},_getViewForElement:function(a,c){var d;return b.each(this.views,function(){return b(this.el).get(0)===a.get(0)?c&&!this.template?!0:(d=this,!1):void 0}),d},_registerEntityView:function(a,c,d){if(c.length){var e=this,f=this._getViewForElement(c);return f?(a.hasRelations()&&!f.collectionsChecked&&this._registerEntityCollectionViews(a,c,f),f):(f=new this.vie.view.Entity({model:a,el:c,tagName:c.get(0).nodeName,vie:this.vie,service:this.name}),this.views.push(f),d&&b(c).find(this.options.predicateSelector).add(b(c).filter(this.options.predicateSelector)).each(function(){var c=b(this).attr("rel");c&&a.set(c,new e.vie.Collection([],{vie:e.vie,predicate:c}))}),this._registerEntityCollectionViews(a,c,f),f)}},_registerEntityCollectionViews:function(a,c,e){var f=this;d.each(a.attributes,function(d,g){var h=a.fromReference(a.get(g));h&&h.isCollection&&(b.each(f.getElementByPredicate(g,c),function(){f._registerCollectionView(h,b(this),a)}),e.collectionsChecked=!0)})},setTemplate:function(a,b,c){var e;c||(c=b,b="default"),a=this.vie.namespaces.isUri(a)?a:this.vie.namespaces.uri(a),e=d.isFunction(c)?c:this.getElementTemplate(c),this.templates[a]||(this.templates[a]={}),this.templates[a][b]=e,d.each(this.views,function(c){c instanceof this.vie.view.Collection&&c.collection.predicate===b&&(c.templates[a]=e)},this)},getTemplate:function(a,b){return b||(b="default"),a=this.vie.namespaces.isUri(a)?a:this.vie.namespaces.uri(a),this.templates[a]?this.templates[a][b]:void 0},_getElementTemplates:function(a,c,e){var f={},g=c.get("@type");if(g&&g.attributes&&g.attributes.get(e)){var h=g.attributes.get(e);if(d.each(h.range,function(a){var b=this.getTemplate(a,e);if(b){var c=this.vie.types.get(a);f[c.id]=b}},this),!d.isEmpty(f))return f}var i=this;if(b("[typeof]",a).each(function(){var a=b(this),c=a.attr("typeof");if(c=i.vie.namespaces.isUri(c)?c:i.vie.namespaces.uri(c),!f[c]){var d=i.getElementTemplate(a);f[c]=d,f["<http://www.w3.org/2002/07/owl#Thing>"]=d}}),d.isEmpty(f)){var j=a.children(":first-child");j.length&&(f["<http://www.w3.org/2002/07/owl#Thing>"]=i.getElementTemplate(j))}return f},getElementTemplate:function(a){d.isString(a)&&(a=b.trim(a));var c=this;return function(d,e){var f=b(a).clone(!1);void 0!==f.attr("about")&&f.attr("about",""),f.find("[about]").attr("about","");var g=c.findPredicateElements(g,f,!1).each(function(){var a=b(this),e=c.getElementPredicate(a);return d.has(e)&&d.get(e).isCollection?!0:(c.writeElementValue(null,a,""),void 0)});e(f)}},_registerCollectionView:function(a,b,c){var d=this._getViewForElement(b,!0);return d?d:(d=new this.vie.view.Collection({owner:c,collection:a,model:a.model,el:b,templates:this._getElementTemplates(b,c,a.predicate),service:this}),this.views.push(d),d)},_getElementType:function(a){var c;return b(a).attr("typeof")!==this.options.attributeExistenceComparator?(c=b(a).attr("typeof"),c&&-1!==c.indexOf("://")?"<"+c+">":c):null},_generatebnodeId:function(){var a=this.options.bnodePrefix+":"+this.bnodes;return this.bnodes++,a},getElementSubject:function(a){var c=this;if("undefined"!=typeof document&&a===document)return document.baseURI;var d,e=null;return b(a).closest(this.options.subjectSelector).each(function(){if(e=this,b(this).attr("about")!==c.options.attributeExistenceComparator)return d=b(this).attr("about"),!0;if(b(this).attr("src")!==c.options.attributeExistenceComparator)return d=b(this).attr("src"),!0;if(b(this).attr("typeof")!==c.options.attributeExistenceComparator){var a=b(this);return a.data("vie-bnode")?(d=a.data("vie-bnode"),!0):(d=c._generatebnodeId(),a.data("vie-bnode",d),!0)}"HTML"===b(this).get(0).nodeName&&b("base",this).each(function(){d=b(this).attr("href")})}),d?"object"==typeof d?d:0===d.indexOf("_:")?d:0===d.indexOf("<")?d:"<"+d+">":void 0},setElementSubject:function(a,c){return b(c).attr("src")?b(c).attr("src",a):b(c).attr("about",a)},getElementPredicate:function(a){var c;return a=b(a),c=a.attr("property"),c||(c=a.attr("rel")),c},getElementBySubject:function(a,c){var d=this;return b(c).find(this.options.subjectSelector).add(b(c).filter(this.options.subjectSelector)).filter(function(){return d.getElementSubject(b(this))!==a?!1:!0})},getElementByPredicate:function(a,c){var d=this,e=this.getElementSubject(c);return b(c).find(this.options.predicateSelector).add(b(c).filter(this.options.predicateSelector)).filter(function(){var c=d.getElementPredicate(b(this));return d.vie.namespaces.curie(c)!==d.vie.namespaces.curie(a)?!1:d.getElementSubject(this)!==e?!1:!0})},_readEntityPredicates:function(a,c,d){var e=this,f={};return this.findPredicateElements(a,c,!0).each(function(){var a=b(this),c=e.getElementPredicate(a);if(""!==c){var g=e.readElementValue(c,a);(null!==g||d)&&(f[c]=g)}}),"HTML"!==b(c).get(0).tagName&&b(c).parent("[rev]").each(function(){var a=b(this).attr("rev");a&&(f[b(this).attr("rev")]=e.getElementSubject(this))}),f},findSubjectElements:function(a){return b("[about]",a)},findPredicateElements:function(a,c,d){var e=this;return b(c).find(this.options.predicateSelector).add(b(c).filter(this.options.predicateSelector)).filter(function(){return e.getElementSubject(this)!==a?!1:d?!0:b(this).parents("[property]").length?!1:!0})},parseElementValue:function(a,b){if(!b.attr("datatype"))return a;var c=this.vie.namespaces.uri(b.attr("datatype"));return this.datatypeReaders[c]?this.datatypeReaders[c](a):a},generateElementValue:function(a,b){if(!b.attr("datatype"))return a;var c=this.vie.namespaces.uri(b.attr("datatype"));return this.datatypeWriters[c]?this.datatypeWriters[c](a):a},readElementValue:function(a,c){var d=c.attr("content");if(d)return this.parseElementValue(d,c);var e=c.attr("resource");if(e)return["<"+e+">"];var f=c.attr("href");if(f&&c.attr("rel")===a)return["<"+f+">"];if(c.attr("rel")){var g=[],h=this;return b(c).children(this.options.subjectSelector).each(function(){g.push(h.getElementSubject(this,!0))}),g}return this.parseElementValue(c.html(),c)},writeElementValue:function(a,b,c){c=this.generateElementValue(c,b),d.isArray(c)&&c.length>0&&(c=c[0]);var e=b.attr("content");if(e)return b.attr("content",c),void 0;var f=b.attr("resource");f&&b.attr("resource",c),b.html(c)},xmlns:function(a){var c;if(a)c=b(a);else{if("undefined"==typeof document)return{};c=b(document)}c=c.add(c.parents());var d={};return c.each(function(a,b){if(b.attributes)for(a=0;a<b.attributes.length;a+=1){var c=b.attributes[a];if(/^xmlns(:(.+))?$/.test(c.nodeName)){var e=/^xmlns(:(.+))?$/.exec(c.nodeName)[2]||"",f=c.nodeValue;(""===e||""!==f)&&(d[e]=c.nodeValue)}}}),d}}}(),function(){var a=["http://demo.iks-project.eu/stanbolfull","http://dev.iks-project.eu/stanbolfull"];e.prototype.StanbolService=function(c){var d={name:"stanbol",url:a,timeout:2e4,namespaces:{semdeski:"http://www.semanticdesktop.org/ontologies/2007/01/19/nie#",semdeskf:"http://www.semanticdesktop.org/ontologies/2007/03/22/nfo#",skos:"http://www.w3.org/2004/02/skos/core#",foaf:"http://xmlns.com/foaf/0.1/",opengis:"http://www.opengis.net/gml/",dbpedia:"http://dbpedia.org/ontology/",dbprop:"http://dbpedia.org/property/",owl:"http://www.w3.org/2002/07/owl#",geonames:"http://www.geonames.org/ontology#",enhancer:"http://fise.iks-project.eu/ontology/",entityhub:"http://www.iks-project.eu/ontology/rick/model/",entityhub2:"http://www.iks-project.eu/ontology/rick/query/",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",dcterms:"http://purl.org/dc/terms/",schema:"http://schema.org/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#"},rules:[{left:["?subject a <http://fise.iks-project.eu/ontology/EntityAnnotation>","?subject enhancer:entity-type ?type","?subject enhancer:confidence ?confidence","?subject enhancer:entity-reference ?entity","?subject dcterms:relation ?relation","?relation a <http://fise.iks-project.eu/ontology/TextAnnotation>","?relation enhancer:selected-text ?selected-text","?relation enhancer:selection-context ?selection-context","?relation enhancer:start ?start","?relation enhancer:end ?end"],right:["?entity a ?type","?entity enhancer:hasTextAnnotation ?relation","?entity enhancer:hasEntityAnnotation ?subject"]}],enhancer:{chain:"default"},entityhub:{site:void 0}};this.options=b.extend(!0,d,c?c:{}),this.vie=null,this.name=this.options.name},e.prototype.StanbolService.prototype={init:function(){for(var a in this.options.namespaces){var c=this.options.namespaces[a];this.vie.namespaces.add(a,c)}this.rules=b.extend([],e.Util.transformationRules(this)),this.rules=b.merge(this.rules,this.options.rules?this.options.rules:[]),this.connector=new this.vie.StanbolConnector(this.options),this.vie.types.addOrOverwrite("enhancer:EntityAnnotation",[]).inherit("owl:Thing"),this.vie.types.addOrOverwrite("enhancer:TextAnnotation",[]).inherit("owl:Thing"),this.vie.types.addOrOverwrite("enhancer:Enhancement",[]).inherit("owl:Thing")},analyze:function(a){var c=this,f=a instanceof this.vie.Analyzable;if(!f)throw"Invalid Analyzable passed";var g=a.options.element?a.options.element:b("body"),h=c._extractText(g);if(h.length>0){var i=function(b){d.defer(function(){var d=e.Util.rdf2Entities(c,b);c.vie.entities.addOrUpdate(d),a.resolve(d)})},j=function(b){a.reject(b)},k={chain:a.options.chain?a.options.chain:c.options.enhancer.chain};this.connector.analyze(h,i,j,k)}else a.resolve([])},find:function(a){var b=a instanceof this.vie.Findable;if(!b)throw"Invalid Findable passed";var c=this;a.options.term||a.reject([]);var f=a.options.term,g="undefined"==typeof a.options.limit?20:a.options.limit,h="undefined"==typeof a.options.offset?0:a.options.offset,i=function(b){d.defer(function(){var d=e.Util.rdf2Entities(c,b);a.resolve(d)})},j=function(b){a.reject(b)};a.options.site=a.options.site?a.options.site:c.options.entityhub.site;var k=this.vie;if(a.options.properties){var l=a.options.properties;a.options.ldPath=d(l).map(function(a){return k.namespaces.isCurie(a)?k.namespaces.uri(a)+";":a}).join("")}if(a.options.field&&k.namespaces.isCurie(m)){var m=a.options.field;a.options.field=k.namespaces.uri(m)}this.connector.find(f,g,h,i,j,a.options)},load:function(a){var b=a instanceof this.vie.Loadable;if(!b)throw"Invalid Loadable passed";var c=this,f=a.options.entity;f||a.resolve([]);var g=function(b){d.defer(function(){var f=e.Util.rdf2Entities(c,b);d.each(f,function(a){c.vie.entities.addOrUpdate(a)}),a.resolve(f)})},h=function(b){a.reject(b)},i={site:a.options.site?a.options.site:c.options.entityhub.site,local:a.options.local};this.connector.load(f,g,h,i)},save:function(a){var b=a instanceof this.vie.Savable;if(!b)throw"Invalid Savable passed";var c=this,f=a.options.entity;f||a.reject("StanbolConnector: No entity to save!");var g=function(b){d.defer(function(){var d=e.Util.rdf2Entities(c,b);a.resolve(d)})},h=function(b){a.reject(b)},i={site:a.options.site?a.options.site:c.options.entityhub.site,local:a.options.local};this.connector.save(f,g,h,i)},_extractText:function(a){if(a.get(0)&&a.get(0).tagName&&("TEXTAREA"==a.get(0).tagName||"INPUT"==a.get(0).tagName&&a.attr("type","text")))return a.get(0).val();var c=a.text().replace(/\s+/g," ").replace(/\0\b\n\r\f\t/g,"");return b.trim(c)}},e.prototype.StanbolConnector=function(c){var e={url:a,timeout:2e4,enhancer:{urlPostfix:"/enhancer",chain:"default"},entityhub:{site:void 0,urlPostfix:"/entityhub",local:!1},sparql:{urlPostfix:"/sparql"},contenthub:{urlPostfix:"/contenthub",index:"contenthub"},ontonet:{urlPostfix:"/ontonet"},factstore:{urlPostfix:"/factstore"},rules:{urlPostfix:"/rules"},cmsadapter:{urlPostfix:"/cmsadapter"}};this.options=b.extend(!0,e,c?c:{}),this.options.url=d.isArray(this.options.url)?this.options.url:[this.options.url],this._init(),this.baseUrl=d.isArray(c.url)?c.url:[c.url]},e.prototype.StanbolConnector.prototype={_init:function(){var a=this;return b.ajaxSetup({converters:{"text application/rdf+json":function(a){return JSON.parse(a)}},timeout:a.options.timeout}),this},_iterate:function(a){if(a){if(a.urlIndex>=this.options.url.length)return a.error.call(this,"Could not connect to the given Stanbol endpoints! Please check for their setup!"),void 0;var b=function(a,b){return function(){b.urlIndex=b.urlIndex+1,a._iterate(b)}}(this,a);return"undefined"!=typeof exports&&"undefined"!=typeof process?a.methodNode.call(this,a.url.call(this,a.urlIndex,a.args.options),a.args,a.success,b):a.method.call(this,a.url.call(this,a.urlIndex,a.args.options),a.args,a.success,b)}},analyze:function(a,b,c,d){d=d?d:{};var e=this;e._iterate({method:e._analyze,methodNode:e._analyzeNode,url:function(a,b){var c=b.chain?b.chain:this.options.enhancer.chain,d=this.options.url[a].replace(/\/$/,"");return d+=this.options.enhancer.urlPostfix+"/chain/"+c.replace(/\/$/,"")},args:{text:a,format:d.format||"application/rdf+json",options:d},success:b,error:c,urlIndex:0})},_analyze:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"POST",data:c.text,dataType:c.format,contentType:"text/plain",accepts:{"application/rdf+json":"application/rdf+json"}})},_analyzeNode:function(a,b,c,d){var e=require("request"),f=e({method:"POST",uri:a,body:b.text,headers:{Accept:b.format,"Content-Type":"text/plain"}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},load:function(a,b,c,d){var e=this;d=d?d:{},d.uri=a.replace(/^</,"").replace(/>$/,""),e._iterate({method:e._load,methodNode:e._loadNode,success:b,error:c,url:function(a,b){var c=b.site?b.site:this.options.entityhub.site;c=c?"/"+c:"s";var d=b.local,e=this.options.url[a].replace(/\/$/,"")+this.options.entityhub.urlPostfix;return e+=d?"/entity?id="+encodeURIComponent(b.uri):"/site"+c+"/entity?id="+encodeURIComponent(b.uri)},args:{format:d.format||"application/rdf+json",options:d},urlIndex:0})},_load:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"GET",dataType:c.format,contentType:"text/plain",accepts:{"application/rdf+json":"application/rdf+json"}})},_loadNode:function(a,b,c,d){var e=require("request"),f=e({method:"GET",uri:a,body:b.text,headers:{Accept:b.format}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},find:function(a,b,c,d,e,f){f=f?f:{};var g=this;return a&&""!==a?(c=c?c:0,b=b?b:10,g._iterate({method:g._find,methodNode:g._findNode,success:d,error:e,url:function(a,b){var c=b.site?b.site:this.options.entityhub.site;c=c?"/"+c:"s";var d=b.local,e=this.options.url[a].replace(/\/$/,"")+this.options.entityhub.urlPostfix;return e+=d?"/sites/find":"/site"+c+"/find"},args:{term:a,offset:c,limit:b,format:f.format||"application/rdf+json",options:f},urlIndex:0}),void 0):(e("No term given!"),void 0)},_find:function(a,c,d,e){var f={name:c.term,limit:c.limit,offset:c.offset};b.ajax({success:d,error:e,url:a,type:"POST",data:b.param(f),dataType:c.format,contentType:"application/x-www-form-urlencoded",accepts:{"application/rdf+json":"application/rdf+json"}})},_findNode:function(a,b,c,d){var e=require("request"),f=e({method:"POST",uri:a,body:"name="+b.term+"&limit="+b.limit+"&offset="+b.offset,headers:{Accept:b.format}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},lookup:function(a,b,c,d){d=d?d:{};var e=this;a=a.replace(/^</,"").replace(/>$/,""),d.uri=a,d.create=d.create?d.create:!1,e._iterate({method:e._lookup,methodNode:e._lookupNode,success:b,error:c,url:function(a,b){var c=this.options.url[a].replace(/\/$/,"")+this.options.entityhub.urlPostfix;return c+="/lookup?id="+encodeURIComponent(b.uri)+"&create="+b.create},args:{format:d.format||"application/rdf+json",options:d},urlIndex:0})},_lookup:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"GET",dataType:c.format,contentType:"text/plain",accepts:{"application/rdf+json":"application/rdf+json"}})},_lookupNode:function(a,b,c,d){var e=require("request"),f=e({method:"GET",uri:a,body:b.text,headers:{Accept:b.format}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},referenced:function(a,b,c){c=c?c:{};var e=this,f=function(b){d.isArray(b)||(b=JSON.parse(b));for(var c=[],e=0,f=b.length;f>e;e++)c.push(b[e].replace(/.+\/(.+?)\/?$/,"$1"));return a(c)};e._iterate({method:e._referenced,methodNode:e._referencedNode,success:f,error:b,url:function(a){var b=this.options.url[a].replace(/\/$/,"");return b+=this.options.entityhub.urlPostfix+"/sites/referenced"},args:{options:c},urlIndex:0})},_referenced:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"GET",accepts:{"application/rdf+json":"application/rdf+json"}})},_referencedNode:function(a,b,c,d){var e=require("request"),f=e({method:"GET",uri:a,headers:{Accept:b.format}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},sparql:function(a,b,c,d){d=d?d:{};var e=this;e._iterate({method:e._sparql,methodNode:e._sparqlNode,success:b,error:c,url:function(a){var b=this.options.url[a].replace(/\/$/,"");return b+=this.options.sparql.urlPostfix.replace(/\/$/,"")},args:{query:a,options:d},urlIndex:0})},_sparql:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"POST",data:"query="+c.query,contentType:"application/x-www-form-urlencoded"})},_sparqlNode:function(a,b,c,d){var e=require("request"),f=e({method:"POST",uri:a,body:JSON.stringify({query:b.query}),headers:{Accept:b.format}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},ldpath:function(a,b,c,e,f){f=f?f:{};var g=this;b=d.isArray(b)?b:[b];for(var h="",i=0;i<b.length;i++)h+="&context="+b[i];g._iterate({method:g._ldpath,methodNode:g._ldpathNode,success:c,error:e,url:function(a,b){var c=b.site?b.site:this.options.entityhub.site;c=c?"/"+c:"s";var d=b.local,e=this.options.url[a].replace(/\/$/,"")+this.options.entityhub.urlPostfix;return d||(e+="/site"+c),e+="/ldpath"},args:{ldpath:a,context:h,format:f.format||"application/rdf+json",options:f},urlIndex:0})},_ldpath:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"POST",data:"ldpath="+c.ldpath+c.context,contentType:"application/x-www-form-urlencoded",dataType:c.format,accepts:{"application/rdf+json":"application/rdf+json"}})},_ldpathNode:function(a,b,c,d){var e=require("request"),f=e({method:"POST",uri:a,body:"ldpath="+b.ldpath+b.context,headers:{Accept:b.format}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},uploadContent:function(a,b,c,d){d=d?d:{};var e=this;e._iterate({method:e._uploadContent,methodNode:e._uploadContentNode,success:b,error:c,url:function(a,b){var c=this.options.url[a].replace(/\/$/,"");c+=this.options.contenthub.urlPostfix.replace(/\/$/,"");var d=b.index?b.index:this.options.contenthub.index;return c+="/"+d.replace(/\/$/,""),c+="/store"},args:{content:a,options:d},urlIndex:0})},_uploadContent:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"POST",data:c.content,contentType:"text/plain"})},_uploadContentNode:function(a,b,c,d){var e=require("request"),f=e({method:"POST",uri:a,body:b.content,headers:{Accept:"application/rdf+xml","Content-Type":"text/plain"}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},createFactSchema:function(a,b,c,d,e){e=e?e:{};var f=this;e.url=a,f._iterate({method:f._createFactSchema,methodNode:f._createFactSchemaNode,success:c,error:d,url:function(a,b){var c=this.options.url[a].replace(/\/$/,"");return c+=this.options.factstore.urlPostfix.replace(/\/$/,""),c+="/facts/"+encodeURIComponent(b.url)},args:{url:a,schema:b,options:e},urlIndex:0})},_createFactSchema:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"PUT",data:c.schema,contentType:"application/json",dataType:"application/json"})},_createFactSchemaNode:function(a,b,c,d){var e=require("request"),f=e({method:"PUT",uri:a,body:b.schema,headers:{Accept:"application/json","Content-Type":"application/json"}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},createFact:function(a,b,c,d){d=d?d:{};var e=this;e._iterate({method:e._createFact,methodNode:e._createFactNode,success:b,error:c,url:function(a){var b=this.options.url[a].replace(/\/$/,"");return b+=this.options.factstore.urlPostfix.replace(/\/$/,""),b+="/facts"},args:{fact:a,options:d},urlIndex:0})},_createFact:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"POST",data:c.fact,contentType:"application/json",dataType:"application/json"})},_createFactNode:function(a,b,c,d){var e=require("request"),f=e({method:"POST",uri:a,body:b.fact,headers:{Accept:"application/json","Content-Type":"application/json"}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()},queryFact:function(a,b,c,d){d=d?d:{};var e=this;e._iterate({method:e._queryFact,methodNode:e._queryFactNode,success:b,error:c,url:function(a){var b=this.options.url[a].replace(/\/$/,"");return b+=this.options.factstore.urlPostfix.replace(/\/$/,""),b+="/query"},args:{query:a,options:d},urlIndex:0})},_queryFact:function(a,c,d,e){b.ajax({success:d,error:e,url:a,type:"POST",data:c.query,contentType:"application/json",dataType:"application/json"})},_queryFactNode:function(a,b,c,d){var e=require("request"),f=e({method:"POST",uri:a,body:b.query,headers:{Accept:"application/json","Content-Type":"application/json"}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()}}}(),function(){e.prototype.ZemantaService=function(a){var c={name:"zemanta",url:["http://api.zemanta.com/services/rest/0.0/"],timeout:2e4,namespaces:{zemanta:"http://s.zemanta.com/ns#"},rules:[{left:["?subject a zemanta:Recognition","?subject zemanta:object ?object","?object owl:sameAs ?entity"],right:["?entity zemanta:hasEntityAnnotation ?subject"]}],api_key:void 0};this.options=b.extend(!0,c,a?a:{}),this.vie=null,this.name=this.options.name,b.ajaxSetup({converters:{"text application/rdf+json":function(a){return JSON.parse(a)}},timeout:this.options.timeout})},e.prototype.ZemantaService.prototype={init:function(){for(var a in this.options.namespaces){var c=this.options.namespaces[a];this.vie.namespaces.add(a,c)}this.rules=b.extend([],e.Util.transformationRules(this)),this.rules=b.merge(this.rules,this.options.rules?this.options.rules:[]),this.connector=new this.vie.ZemantaConnector(this.options),this.vie.types.addOrOverwrite("zemanta:Recognition",[]).inherit("owl:Thing")},analyze:function(a){var c=this,f=a instanceof this.vie.Analyzable;if(!f)throw"Invalid Analyzable passed";var g=a.options.element?a.options.element:b("body"),h=c._extractText(g);if(h.length>0){var i=function(b){d.defer(function(){var d=e.Util.rdf2Entities(c,b);a.resolve(d)})},j=function(b){a.reject(b)},k={};this.connector.analyze(h,i,j,k)}else a.resolve([])},_extractText:function(a){return b(a).wrap("<div>").parent().html()}},e.prototype.ZemantaConnector=function(a){var c={url:["http://api.zemanta.com/services/rest/0.0/"],timeout:2e4,api_key:void 0};this.options=b.extend(!0,c,a?a:{}),this.options.url=d.isArray(this.options.url)?this.options.url:[this.options.url],this._init(),this.baseUrl=d.isArray(a.url)?a.url:[a.url]},e.prototype.ZemantaConnector.prototype={_init:function(){var a=this;return b.ajaxSetup({converters:{"text application/rdf+json":function(a){return JSON.parse(a)}},timeout:a.options.timeout}),this},_iterate:function(a){if(a){if(a.urlIndex>=this.options.url.length)return a.error.call(this,"Could not connect to the given Zemanta endpoints! Please check for their setup!"),void 0;var b=function(a,b){return function(){b.urlIndex=b.urlIndex+1,a._iterate(b)}}(this,a);return"undefined"!=typeof exports&&"undefined"!=typeof process?a.methodNode.call(this,a.url.call(this,a.urlIndex,a.args.options),a.args,a.success,b):a.method.call(this,a.url.call(this,a.urlIndex,a.args.options),a.args,a.success,b)}},analyze:function(a,b,c,d){d=d?d:{};var e=this;e._iterate({method:e._analyze,methodNode:e._analyzeNode,success:b,error:c,url:function(a){var b=this.options.url[a].replace(/\/$/,"");return b},args:{text:a,format:d.format||"rdfxml",options:d},urlIndex:0})},_analyze:function(a,c,d,e){b.ajax({success:function(a,b,c){var e=c.responseText.replace(/<z:signature>.*?<\/z:signature>/,"");d(e)},error:e,url:a,type:"POST",dataType:"xml",data:{method:"zemanta.suggest",text:c.text,format:c.format,api_key:this.options.api_key,return_rdf_links:c.options.return_rdf_links},contentType:"text/plain",accepts:{"application/rdf+json":"application/rdf+json"}})},_analyzeNode:function(a,b,c,d){var e=require("request"),f=e({method:"POST",uri:a,body:b.text,headers:{Accept:b.format,"Content-Type":"text/plain"}},function(a,b,e){try{c({results:JSON.parse(e)})}catch(f){d(f)}});f.end()}}}(),e.prototype.view||(e.prototype.view={}),e.prototype.view.Collection=c.View.extend({initialize:function(){if(this.templates=this.options.templates,this.service=this.options.service,!this.service)throw"No RDFa service provided to the Collection View";this.owner=this.options.owner,this.definition=this.options.definition,this.entityViews={},this.listenTo(this.collection,"add",this.addItem),this.listenTo(this.collection,"remove",this.removeItem),this.listenTo(this.collection,"reset",this.refreshItems),this.collection.each(function(a){this.registerItem(a,this.collection)
},this)},canAdd:function(a){return d.isEmpty(this.templates)?!1:a&&!this.templates[a]?!1:this.collection.canAdd(a)},addItem:function(a,b){if(b===this.collection){var c,e=a.get("@type");if(d.isArray(e)?d.each(e,function(a){this.canAdd(a.id)&&(c=a.id)},this):this.canAdd(e.id)&&(c=e.id),c){var f=this;this.templates[c](a,function(c){var d=f.service._registerEntityView(a,c,!0),e=d.render().$el;a.id&&f.service.setElementSubject(a.getSubjectUri(),e);var g=b.indexOf(a);if(0===g)f.$el.prepend(e);else{var h=b.at(g-1),i=f.entityViews[h.cid];i?i.$el.after(e):f.$el.append(e)}f.findReverseRelations(a,e),f.trigger("add",d),f.entityViews[a.cid]=d,e.show()},this)}}},findReverseRelations:function(a,c){var d=this.service;c.parent("[rev]").each(function(){var c=b(this).attr("rev"),e={};e[c]=new d.vie.Collection([],{vie:d.vie,predicate:c});var f=d.vie.entities.get(d.getElementSubject(this));f&&e[c].addOrUpdate(f),a.set(e)})},registerItem:function(a){var b=this.service.getElementBySubject(a.id,this.el);if(b){var c=this.service._registerEntityView(a,b);this.entityViews[a.cid]=c}},removeItem:function(a){this.entityViews[a.cid]&&(this.trigger("remove",this.entityViews[a.cid]),b(this.entityViews[a.cid].el).remove(),delete this.entityViews[a.cid])},refreshItems:function(a){d.each(this.entityViews,function(a){b(a.el).remove()}),this.entityViews={},a.forEach(function(b){this.addItem(b,a)},this)}}),e.prototype.view||(e.prototype.view={}),e.prototype.view.Entity=c.View.extend({initialize:function(a){this.service=a.service?a.service:"rdfa",this.vie=a.vie,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:@subject",this.renderAbout)},render:function(){return this.vie.save({element:this.el,entity:this.model}).to(this.service).execute(),this},renderAbout:function(){this.vie.service(this.service).setElementSubject(this.model.getSubjectUri(),this.el)}});var a=this;!function(b){a.XDomainRequest&&b.ajaxTransport(function(a){if(a.crossDomain&&a.async){a.timeout&&(a.xdrTimeout=a.timeout,delete a.timeout);var c;return{send:function(d,e){function f(a,d,f,g){c.onload=c.onerror=c.ontimeout=b.noop,c=void 0,e(a,d,f,g)}if(c=new XDomainRequest,a.dataType){var g="header_Accept="+encodeURIComponent(a.dataType)+"&header_Content-Type=text/plain";a.url=a.url+(-1===a.url.indexOf("?")?"?":"&")+g}c.open(a.type,a.url),c.onload=function(){f(200,"OK",{text:c.responseText},"Content-Type: "+c.contentType)},c.onerror=function(){f(404,"Not Found")},a.xdrTimeout&&(c.ontimeout=function(){f(0,"timeout")},c.timeout=a.xdrTimeout),c.send(a.hasContent&&a.data||null)},abort:function(){c&&(c.onerror=b.noop(),c.abort())}}}})}(b)}(this);