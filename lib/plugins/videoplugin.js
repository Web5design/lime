// Generated by CoffeeScript 1.3.3
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  window.VideoPlugin = (function(_super) {

    __extends(VideoPlugin, _super);

    function VideoPlugin() {
      return VideoPlugin.__super__.constructor.apply(this, arguments);
    }

    VideoPlugin.prototype.init = function() {
      var annotation, _i, _len, _ref, _results;
      this.name = 'VideoPlugin';
      console.info("Initialize " + this.name);
      _ref = this.lime.annotations;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        annotation = _ref[_i];
        if (annotation.resource.value.indexOf("dbpedia.org/resource/Schladming") > 0) {
          _results.push(this.handleAnnotation(annotation));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    VideoPlugin.prototype.handleAnnotation = function(annotation) {
      var _this = this;
      return annotation.entityPromise.done(function() {
        var nonConcept, widget;
        nonConcept = annotation.getDescription();
        nonConcept = nonConcept.replace("No description found.", "");
        if (nonConcept.length >= 3) {
          widget = _this.lime.allocateWidgetSpace(_this, {
            thumbnail: "img/youtube.png",
            title: "" + (annotation.getLabel()) + " Videos",
            type: "VideoWidget",
            sortBy: function() {
              return 10000 * annotation.start + annotation.end;
            }
          });
          widget.annotation = annotation;
          jQuery(widget).bind('activate', function(e) {
            return _this.showAbstractInModalWindow(annotation, _this.getModalContainer());
          });
          annotation.widgets[_this.name] = widget;
          jQuery(annotation).bind("becomeActive", function(e) {
            return annotation.widgets[_this.name].setActive();
          });
          return jQuery(annotation).bind("becomeInactive", function(e) {
            return annotation.widgets[_this.name].setInactive();
          });
        }
      });
    };

    VideoPlugin.prototype.showAbstractInModalWindow = function(annotation, outputElement) {
      var modalContent, result, url, videoList;
      modalContent = $(outputElement);
      modalContent.css("width", "600px");
      modalContent.css("height", "auto");
      /* the videoList represents a result of a quary liek this to the CMF:
              PREFIX mao: <http://www.w3.org/ns/ma-ont#>
              SELECT DISTINCT ?video
              WHERE {
                ?video a <http://www.w3.org/ns/ma-ont#VideoTrack> .
                ?video mao:description ?text .
                ?video mao:locator ?url .
                ?video mao:hasKeyword <http://dbpedia.org/resource/Sledding> .
              }
              ORDER BY ?video
      */

      videoList = [
        {
          description: "Nachtrodeln auf der ca. 6,3 km langen Rodelbahn von der Bergstation der Hochwurzen Gipfelbahn bis zur Talstation in Rohrmoos. Mit 4 sch??nen urigen H??tten - H...",
          duration: "95.0",
          locator: "https://www.youtube.com/watch?v=tzBRpNI1Mck",
          title: "Nachtrodeln Schladming - Rohrmoos Hochwurzen Schlittenfahren",
          img: "http://i.ytimg.com/vi/tzBRpNI1Mck/0.jpg"
        }, {
          description: "Hochwurzen 1850 m.",
          duration: "596.0",
          locator: "https://www.youtube.com/watch?v=AXgZ98Z9EFw",
          title: "Schladming- rodeln-Puzanje 2012.AVI",
          img: "http://i.ytimg.com/vi/AXgZ98Z9EFw/0.jpg"
        }, {
          description: "Rodeln vom Feinsten auf der Hochwurzen ( Planai / Schladming). Musste Video leider auf 10min k??rzen. Fahrt dauerte 12min!",
          duration: "600.0",
          locator: "https://www.youtube.com/watch?v=zOzeGapneoY",
          title: "Rodeln Hochwurzen",
          img: "http://i.ytimg.com/vi/zOzeGapneoY/0.jpg"
        }, {
          description: "Ein Ausschnitt aus der Helmkamera vom Rodeln im J??nner 2013. Kamerafahrt wurde nicht von mir gemacht...Ich bin der gefilmte =) Musik: Ski or die - Snowboard ...",
          duration: "55.0",
          locator: "https://www.youtube.com/watch?v=AWK9lkChVpA",
          title: "Rodelbahn Hochwurzen, Sturz (Helmkamera)",
          img: "http://i.ytimg.com/vi/AWK9lkChVpA/0.jpg"
        }
      ];
      url = videoList[0].locator;
      url = url.split('=')[1];
      console.log("videoList -", videoList);
      /*
          <iframe width="560" height="315" style="margin: 0 auto; display: block;" src="http://www.youtube.com/embed/#{url}" frameborder="0" allowfullscreen>
                        <p>Your browser does not support iframes.</p>
                    </iframe>
      
      
        <embed id="embededVideo1" class="embededVideo" src="http://www.youtube.com/embed/#{url}" style="width: 600px; height: 450px; position: relative; display: none;"></embed>
                          <embed id="embededVideo2" class="embededVideo" src="http://www.youtube.com/embed/#{url}" style="width: 600px; height: 450px; position: relative; display: none;"></embed>
                          <embed id="embededVideo3" class="embededVideo" src="http://www.youtube.com/embed/#{url}" style="width: 600px; height: 450px; position: relative; display: none;"></embed>
                          <embed id="embededVideo4" class="embededVideo" src="http://www.youtube.com/embed/#{url}" style="width: 600px; height: 450px; position: relative; display: none;"></embed>
      */

      result = "<div id=\"videoWidgetExpanded\" style=\"border: 1px dotted lightgray; position: relative; width: 600px; height: 600px;\">\n   <div id=\"videoArea\" style=\"left: 0px; top: 0px; width: 600px; position: relative; height: 450px; background-color: #f16f6f; float: left;\">\n   <iframe id=\"embededVideo\" width=\"600\" height=\"450\" style=\"margin: 0 auto; display: block;\" src=\"http://www.youtube.com/embed/" + url + "\" frameborder=\"0\" allowfullscreen>\n   <p>Your browser does not support iframes.</p>\n   </iframe>\n   </div>\n   <div id=\"videoList\" style=\"background-color: #0a0a0a; position: relative; float: left; width: 600px; height: 150px;\">\n       <div id=\"video1\" style=\"border: 1px solid black; position: relative; float: left; width: 148px; height: 148px; background-color: #9b9393; background-repeat: no-repeat; background-position: center center; background-size: cover; background-image: url('" + videoList[0].img + "');\">\n           <div id=\"expandedwidget-videoicon1\" style=\"position: absolute; z-index: 900; width: 50px; height: 50px; bottom: 0px; left: 0px; background-repeat: no-repeat; background-position: center center; background-image: url('img/youtube_gr.png'); background-size: cover;\" class=\"expandedwidget-videoicon\"></div>\n       </div>\n       <div id=\"video2\" style=\"border: 1px solid black; position: relative; float: left; width: 148px; height: 148px; background-color: #9b9393; background-image: url('" + videoList[1].img + "'); background-repeat: no-repeat; background-position: center center; background-size: cover;\">\n           <div id=\"expandedwidget-videoicon2\" style=\"width: 50px; height: 50px; bottom: 0px; background-repeat: no-repeat; background-position: center center; background-image: url('img/youtube.png'); background-size: cover; position: absolute; z-index: 900; left: 0px;\" class=\"expandedwidget-videoicon\"></div>\n       </div>\n       <div id=\"video3\" style=\"border: 1px solid black; position: relative; float: left; width: 148px; height: 148px; background-color: #9b9393; background-repeat: no-repeat; background-position: center center; background-size: cover; background-image: url('" + videoList[2].img + "');\">\n           <div id=\"expandedwidget-videoicon3\" style=\"width: 50px; height: 50px; bottom: 0px; background-repeat: no-repeat; background-position: center center; background-image: url('img/youtube.png'); background-size: cover; position: absolute; z-index: 900; left: 0px;\" class=\"expandedwidget-videoicon\"></div>\n       </div>\n       <div id=\"video4\" style=\"border: 1px solid black; position: relative; float: left; width: 148px; height: 148px; background-color: #9b9393; background-repeat: no-repeat; background-position: center center; background-size: cover; background-image: url('" + videoList[3].img + "');\">\n           <div id=\"expandedwidget-videoicon4\" style=\"width: 50px; height: 50px; bottom: 0px; background-repeat: no-repeat; background-position: center center; background-image: url('img/youtube.png'); background-size: cover; position: absolute; z-index: 900; left: 0px;\" class=\"expandedwidget-videoicon\"></div>\n       </div>\n   </div>\n</div>";
      modalContent.append(result);
      $("#video1").click(function() {
        url = videoList[0].locator;
        url = url.split('=')[1];
        $("#embededVideo").empty();
        $("#embededVideo").attr('src', "http://www.youtube.com/embed/" + url);
        $(".expandedwidget-videoicon").css("background-image", "url('img/youtube.png')");
        return $("#expandedwidget-videoicon1").css("background-image", "url('img/youtube_gr.png')");
      });
      $("#video2").click(function() {
        url = videoList[1].locator;
        url = url.split('=')[1];
        $("#embededVideo").empty();
        $("#embededVideo").attr('src', "http://www.youtube.com/embed/" + url);
        $(".expandedwidget-videoicon").css("background-image", "url('img/youtube.png')");
        return $("#expandedwidget-videoicon2").css("background-image", "url('img/youtube_gr.png')");
      });
      $("#video3").click(function() {
        url = videoList[2].locator;
        url = url.split('=')[1];
        $("#embededVideo").empty();
        $("#embededVideo").attr('src', "http://www.youtube.com/embed/" + url);
        $(".expandedwidget-videoicon").css("background-image", "url('img/youtube.png')");
        return $("#expandedwidget-videoicon3").css("background-image", "url('img/youtube_gr.png')");
      });
      $("#video4").click(function() {
        url = videoList[3].locator;
        url = url.split('=')[1];
        $("#embededVideo").empty();
        $("#embededVideo").attr('src', "http://www.youtube.com/embed/" + url);
        $(".expandedwidget-videoicon").css("background-image", "url('img/youtube.png')");
        return $("#expandedwidget-videoicon4").css("background-image", "url('img/youtube_gr.png')");
      });
      return console.log("videoList -", videoList);
    };

    return VideoPlugin;

  })(window.LimePlugin);

}).call(this);
