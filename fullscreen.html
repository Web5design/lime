<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">
		<title>ConnectMe Player</title>
		<script src="lib/underscoreJS/underscore.min.js"></script>
		<script src="lib/jquery/jquery-1.7.1.js"></script>

		<script type="text/javascript" src="lib/backboneJS/backbone.js"></script>
		<script type="text/javascript" src="lib/rdfquery/latest/jquery.rdfquery.debug.js"></script>
		<script type="text/javascript" src="lib/vie/vie-2.0.0.debug.js"></script>
		<script type="text/javascript" src="lib/iscroll/iscroll.js"></script>
		<!-- Plugin dependencies -->
		<!-- <meta name="viewport" content="initial-scale=1.0, user-scalable=no"> -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=weather"></script>
		<!--<script src="https://maps.gstatic.com/cat_js/intl/en_us/mapfiles/api-3/9/13b/%7Bmain,weather%7D.js" type="text/javascript"></script>
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCo9Wug3Lw6-PrVu9Y44lHLaWUvnFZ5_fQ&sensor=false"></script>
		<script src="https://maps.gstatic.com/intl/en_us/mapfiles/api-3/9/13b/main.js" type="text/javascript"></script>  -->
		<link rel="stylesheet" href='css/hoverbox.css' type="text/css" media="screen, projection" />
		<link href="css/video-js1.css" rel="stylesheet">
		<!--[if lte IE 7]>
		<link rel="stylesheet" href='css/ie_fixes.css' type="text/css" media="screen, projection" />
		<![endif]-->
		<script src="lib/videojs/video1.js"></script>

		<!-- CDN-hosted versions disabled for now for extra speed -->
		<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>-->
		<!--<link rel=stylesheet href="http://vjs.zencdn.net/3.2/video-js.css" type="text/css">
		<script src="http://vjs.zencdn.net/3.2/video.js"></script>-->
		<script type="text/javascript" src="src/utils.js"></script>
		<!-- The extended player -->
		<script src="lib/lime.js"></script>
		<!-- plugins -->
		<script src="lib/plugins/geonamesmapplugin.js"></script>
		<script src="lib/plugins/dbpediainfoplugin.js"></script>
		<script src="lib/plugins/googleweatherplugin.js"></script>
		<script src="lib/plugins/annotationmodalwindow.js"></script>
		<script src="lib/plugins/lsiimageplugin.js"></script>
        <script src="lib/plugins/youtubeplugin.js"></script>
		<script src="lib/plugins/businessplugin.js"></script>
        <!--
		<script src="lib/plugins/googledirectionplugin.js"></script>
		-->
		<!-- settings -->
		<script src="lib/settings/admin.js"></script>
		<script src="lib/settings/statistics.js"></script>
		<script src="lib/settings/usersettings.js"></script>
		<script src="lib/settings/help.js"></script>

		<link href="css/full-screen.css" rel="stylesheet">
		<script type="text/javascript" src="lib/jquery/jquery-ui-1.8.21.min.js"></script>
		<script type="text/javascript" src="http://www.websnapr.com/js/websnapr.js"></script>
		<script type="text/javascript">
		/*	document.body.addEventListener('touchmove', function(event) {
				event.preventDefault();
			}, false); */
		</script>
		<script type="text/javascript" language="javascript">
			/*
			 VIDEO1: https://s3-eu-west-1.amazonaws.com/yoo.120/connectme/6306_519_20120508125738_standard.mp4
			 VIDEO2: https://s3-eu-west-1.amazonaws.com/yoovis-videos/6256_519_connectme_volksbuehne_heldenmp4_standardmpeg_20120427015958_standard.mp4
			 */
			$(document).ready(function() {
                var desiredHeight = window.innerHeight;
                var desiredWidth = window.innerWidth;
                var headerHeight = $("#header").height();
                if (window.innerWidth < desiredHeight)
                    desiredHeight = window.innerWidth * 80 / 100;
                desiredHeight = desiredHeight - headerHeight;

				var local = JSON.parse(UTILS.getParameterByName('local') || 'false');
				var videoUrl = UTILS.getParameterByName('videoUrl');
				var cmfurl = UTILS.getParameterByName('cmfUrl').replace(/\/$/, '') + '/' || "http://connectme.salzburgresearch.at/CMF/";
				var lang = UTILS.getParameterByName('lang') || 'en';
				var cmf = new CMF(cmfurl);

				var getAnnotations = function(cb) {
					if (local) {
						jQuery.getJSON('annotations.json', function(res) {
							console.info('annotation JSON', res.results.bindings);
							cb(false, res.results.bindings);
						});
					} else {
						cmf.getAnnotationsForVideoOrLocator(videoUrl, cb);
					}
				};
				var getLocators = function(cb) {
					if (local) {
						var locators = [{
							"source" : "videos/6306_519_20120508125738_ogg.ogv",
							"type" : "video/ogv"
						}, {
							"source" : "videos/6306_519_20120508125738_standard.mp4",
							"type" : "video/mp4"
						}, {
							"source" : "videos/6306_519_20120508125738_webm.webm",
							"type" : "video/webm"
						}];
						cb(false, locators);
					} else {
						cmf.getLocatorsForVideoOrLocator(videoUrl, cb);
					}
				};
				getLocators(function(err, locators) {
					console.info("locators", locators);
					if (err || locators.length == 0) {
						console.error("Error getting video locators", err, locators);
						alert("Error getting video locators for " + videoUrl);
						return
					}

					getAnnotations(function(err, annotations) {
						annotations = _(annotations).map(function(ann) {
							return new Annotation(ann);
						});
						console.info("Annotations", annotations);
						window.lime = LimePlayer = new LIMEPlayer({
							video : locators,
							// activeWidgetTypes: ['DbpediaInfoWidget'],
							local : local,
							annotations : annotations,
							containerDiv : "mainwrapper",
							videoPlayerSize : {
								"width" : desiredWidth,
								"height" : desiredHeight
							},
							vPlayer : "VideoJS",
							// annotFrameworkURL:"http://connectme.salzburgresearch.at/CMF/",
							annotFrameworkURL : cmfurl,
							plugins : {
								AnnotationModalWindow : {},
								DBPediaInfoPlugin : {
									preferredContainer : {
										element : jQuery('#widget-container-2'),
										orientation : 'horizontal'
									}
								},
								GeoNamesMapPlugin : {
									preferredContainer : {
										element : jQuery('#widget-container-2'),
										orientation : 'horizontal'
									}
								},
								GoogleWeatherPlugin : {
									preferredContainer : {
										element : jQuery('#widget-container-2'),
										orientation : 'horizontal'
									}
								},
							     BusinessPlugin : {
									preferredContainer : {
										element : jQuery('#widget-container-2'),
										orientation : 'horizontal'
									}
								},
								YoutubePlugin : {
									preferredContainer : {
										element : jQuery('#widget-container-2'),
										orientation : 'horizontal'
									}
								},
								/* GoogleDirectionPlugin : {
									preferredContainer : {
										element : jQuery('#widget-container-2'),
										orientation : 'horizontal'
									}
								},
								*/
								/*
								 LSIImagePlugin: {
								 preferredContainer: {element:jQuery('#widget-container-2'), orientation:'horizontal'}
								 },*/
								HelpPlugin : {},
								StatisticsPlugin : {},
								UserSettingsPlugin : {}
							},
							// plugins:[TestPlugin, LDPlugin, AnnotationOverlays],
							fullscreenLayout : {
								"AnnotationNorth" : 50,
								"AnnotationWest" : 300,
								"AnnotationSouth" : 50,
								"AnnotationEast" : 300
							},
							widgetContainers : [{
								element : jQuery('#widget-container-2'),
								orientation : 'horizontal'
							}, {
								element : jQuery('#widget-container-1'),
								orientation : 'horizontal'
							}],
							annotationsVisible : true,
							preferredLanguage : lang
						});
						console.log(LimePlayer);
					});
				})

			
			});

		</script>
		<script type="text/javascript">
			var myScroll;
			function iScrollloaded() {
				myScroll = new iScroll('wrapper', { checkDOMChanges: true });
			}
			document.addEventListener('touchmove', function(event) {
				event.preventDefault();
			}, false);			
			
			/* * * * * * * *
			 *
			 * Use this for high compatibility (iDevice + Android)
			 *
			 */
			/* document.addEventListener('DOMContentLoaded', function() {
				setTimeout(iScrollloaded, 200);
			}, false); */
			/*
			* * * * * * * */

			/* * * * * * * *
			*
			* Use this for iDevice only
			*
			*/
			//document.addEventListener('DOMContentLoaded', loaded, false);
			/*
			* * * * * * * */

			/* * * * * * * *
			*
			* Use this if nothing else works
			*
			*/
		
			window.addEventListener('load', setTimeout(function () { 
				console.log("window.load event")
				iScrollloaded(); 
				}, 200), false);
			/*
			 * * * * * * * */

		</script>

	</head>

	<body>

		<div id="header" class="header" align="left">
			<a href="./" style="float: left"><img src="img/connectme_logo_web.png" width="204" height="40" border="0"/></a>
			<div class="settings" style="position: relative; float:left;">
				<!-- <div class="stats" style="float: left;"> <img src="img/statistics.png" style="width: 40px; height: 40px; float: left;" /> </div>
				<div class="usersettings" style="float: left;"> <img src="img/settings.png" style="width: 40px; height: 40px; float: left;" /> </div>
				<!--	<div class="admin" style="float: left;"> <img src="img/admin.png" style="width: 30px; height: 30px; float: left;" /> </div> -->
				<div class="help" style="float: left;">
					<img src="img/help.png" style="width: 36px; height: 35px; float: left;" />
				</div>
			</div>
			<div>
				<img  class="slideoutbutton" src="img/slideout.png" style="width: 40px; height: 40px; float: right; margin-right: 15px;" />
			</div>
		</div>

		<div text-align="center" id="container">
			<div id="widget-container-1" class="widget-container horizontal">
				&nbsp;
			</div>
			<div id="wrapper" data="only for mobile devices">
				<div id="widget-container-2" class="widget-container horizontal"></div>
			</div>
			<div class="mainwrapper" id="mainwrapper" align="center" ></div>
			<!--
			<div id="widget-container-1" class="widget-container vertical">&nbsp;</div>
			<div class="mainwrapper" id="mainwrapper" align="center">
			</div>
			<div id="widget-container-2" class="widget-container vertical"> &nbsp;</div> -->

		</div>

		</div>

		<div id="modalWindow">
			<!--	<div id="textDialogCanvas" style="width: inherit; height: inherit; -moz-border-radius: 5px; border-radius: 5px;  background-color: black; color: white; font: 22px 'Trebuchet MS', sans-serif;"> -->
			<a href="#" class="close" role="button"><img src="img/close-icon.png" style="width: 22px; height: 22px;"/></a>
			<div id="textDialogContent" style=" width: 98%; height: 95%; margin:0px auto;  background-color: black; overflow:hidden;">

			</div>
			<!-- </div> -->
		</div>
		<!-- Mask to cover the whole screen -->
		<div id="mask"></div>

		<!-- Attache widget container toggle logic -->
		<script type="text/javascript" language="javascript">
			slideOut = true;
			//$("#widget-container-2").css('right',slideRight + "px" );
			//$("div .lime-widget").css('right',slideRight + "px" );
			console.log("i should be folded");
			$(".slideoutbutton").click(function(e) {
				if (slideOut) {
					slideRight = $("div .lime-widget").width();
					slideRight = 10 - slideRight;
					//$("#widget-container-2").css('right',slideRight + "px" );
					$("div .lime-widget").css('right', slideRight + "px");

					// change buttn image to src="img/slidein.png"
					$(".slideoutbutton").attr('src', "img/slidein.png");
				} else {
					// $("#widget-container-2").css('right', 0 );
					$("div .lime-widget").css('right', 0);
					// change button image to src="img/slideout.png"
					$(".slideoutbutton").attr('src', "img/slideout.png");
				}
				slideOut = !slideOut;
				console.log("toggle");

			});

		</script>

		<!-- Video player resize to full window width+ height -->
		<script type="text/javascript" language="javascript">
		window.onload = function() {
			desiredHeight = window.innerHeight;
			if (window.innerWidth < desiredHeight)
				desiredHeight = window.innerWidth * 80 / 100;
			$("#video_player").css("height", desiredHeight * 95 / 100);
			$("#video_player").css("width", window.innerWidth);
			headerHeight = $("#header").height();			
			$("#wrapper").css("height", window.innerHeight - 39 - headerHeight);
		}
		</script>

		<script type="text/javascript" language="javascript">
			window.onresize = function() {
				desiredHeight = window.innerHeight;
				if (window.innerWidth < desiredHeight)
					desiredHeight = window.innerWidth * 80 / 100;

				$("#video_player").css("height", desiredHeight - $("#header").height());
				$("#video_player").css("width", window.innerWidth);
				$(".slideoutbutton").trigger('click');
				$(".slideoutbutton").trigger('click');
				headerHeight = $("#header").height();
				$("#wrapper").css("height", window.innerHeight - 39 - headerHeight);

			};
		</script>
		
		<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36834976-1']);
  _gaq.push(['_setDomainName', 'connectme.at']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
	</body>
</html>
